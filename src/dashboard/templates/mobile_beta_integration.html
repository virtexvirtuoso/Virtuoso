<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Beta Analysis - Mobile Dashboard</title>
    
    <!-- Chart.js for charting -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Mobile-optimized styles -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0c1a2b;
            color: #ffbf00;
            padding: 16px;
        }
        
        .section {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid rgba(255, 191, 0, 0.2);
        }
        
        .overview-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .metric-card {
            background: rgba(255, 191, 0, 0.1);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #ff9900;
        }
        
        .metric-label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .chart-container {
            position: relative;
            height: 250px;
            margin-bottom: 20px;
        }
        
        .beta-table {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 191, 0, 0.2);
        }
        
        th {
            background: rgba(255, 191, 0, 0.1);
            font-size: 12px;
        }
        
        .risk-high { color: #ef4444; }
        .risk-medium { color: #f59e0b; }
        .risk-low { color: #10b981; }
        
        .insights {
            display: grid;
            gap: 12px;
        }
        
        .insight-card {
            background: rgba(255, 191, 0, 0.05);
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid #ff9900;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            opacity: 0.6;
        }
        
        .error {
            color: #ef4444;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="section">
            <h2>Bitcoin Beta Analysis</h2>
            <p style="opacity: 0.8; font-size: 14px;">7-Day Risk Analysis</p>
        </div>
        
        <div id="content" class="loading">Loading beta analysis...</div>
    </div>

    <script>
        // API configuration
        const API_BASE = window.location.protocol + '//' + window.location.hostname + ':8003/api/dashboard';
        
        // Chart instances
        let charts = {};
        
        // Load beta dashboard data
        async function loadBetaDashboard() {
            try {
                const response = await fetch(`${API_BASE}/mobile/beta-dashboard`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    renderDashboard(data);
                } else {
                    showError('Failed to load beta analysis');
                }
            } catch (error) {
                showError('Network error: ' + error.message);
            }
        }
        
        // Render the dashboard
        function renderDashboard(data) {
            const content = document.getElementById('content');
            content.classList.remove('loading');
            
            content.innerHTML = `
                <!-- Overview Metrics -->
                <div class="section">
                    <div class="overview-grid">
                        <div class="metric-card">
                            <div class="metric-value">${data.overview.market_beta.toFixed(2)}</div>
                            <div class="metric-label">Market Beta</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${data.overview.btc_dominance}%</div>
                            <div class="metric-label">BTC Dominance</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${data.overview.avg_portfolio_beta.toFixed(2)}</div>
                            <div class="metric-label">Avg Portfolio β</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${data.overview.total_assets}</div>
                            <div class="metric-label">Assets Tracked</div>
                        </div>
                    </div>
                </div>
                
                <!-- Time Series Chart -->
                <div class="section">
                    <h3>Beta Trend (7 Days)</h3>
                    <div class="chart-container">
                        <canvas id="timeSeriesChart"></canvas>
                    </div>
                </div>
                
                <!-- Risk Distribution Chart -->
                <div class="section">
                    <h3>Portfolio Risk Distribution</h3>
                    <div class="chart-container">
                        <canvas id="riskChart"></canvas>
                    </div>
                </div>
                
                <!-- Beta Table -->
                <div class="section">
                    <h3>Asset Beta Coefficients</h3>
                    <div class="beta-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Beta</th>
                                    <th>Corr</th>
                                    <th>24h %</th>
                                    <th>Risk</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.beta_table.map(row => `
                                    <tr>
                                        <td>${row.symbol}</td>
                                        <td>${row.beta.toFixed(2)}</td>
                                        <td>${row.correlation.toFixed(2)}</td>
                                        <td class="${row.change_24h >= 0 ? 'risk-low' : 'risk-high'}">
                                            ${row.change_24h >= 0 ? '+' : ''}${row.change_24h.toFixed(2)}%
                                        </td>
                                        <td class="risk-${row.risk_color}">${row.risk_category}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Performance Scatter -->
                <div class="section">
                    <h3>Risk vs Return Analysis</h3>
                    <div class="chart-container">
                        <canvas id="scatterChart"></canvas>
                    </div>
                </div>
                
                <!-- Insights -->
                <div class="section">
                    <h3>Trading Insights</h3>
                    <div class="insights">
                        ${data.insights.high_risk_opportunities.length > 0 ? `
                            <div class="insight-card">
                                <strong>High Risk Opportunities:</strong><br>
                                ${data.insights.high_risk_opportunities.join(', ')}
                            </div>
                        ` : ''}
                        ${data.insights.safe_performers.length > 0 ? `
                            <div class="insight-card">
                                <strong>Safe Performers:</strong><br>
                                ${data.insights.safe_performers.join(', ')}
                            </div>
                        ` : ''}
                        ${data.insights.avoid_list.length > 0 ? `
                            <div class="insight-card">
                                <strong>Consider Avoiding:</strong><br>
                                ${data.insights.avoid_list.join(', ')}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            // Render charts
            setTimeout(() => {
                renderTimeSeriesChart(data.charts.time_series.data);
                renderRiskDistributionChart(data.charts.risk_distribution.data);
                renderScatterChart(data.charts.performance_scatter.data);
            }, 100);
        }
        
        // Render time series chart
        function renderTimeSeriesChart(data) {
            const ctx = document.getElementById('timeSeriesChart').getContext('2d');
            
            const datasets = Object.keys(data).map((symbol, index) => ({
                label: symbol,
                data: data[symbol].map(point => ({
                    x: point.date,
                    y: point.beta
                })),
                borderColor: `hsl(${index * 60}, 70%, 50%)`,
                backgroundColor: 'transparent',
                tension: 0.1
            }));
            
            charts.timeSeries = new Chart(ctx, {
                type: 'line',
                data: { datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#ffbf00' }
                        }
                    },
                    scales: {
                        x: {
                            type: 'category',
                            ticks: { color: '#ffbf00' },
                            grid: { color: 'rgba(255, 191, 0, 0.1)' }
                        },
                        y: {
                            ticks: { color: '#ffbf00' },
                            grid: { color: 'rgba(255, 191, 0, 0.1)' }
                        }
                    }
                }
            });
        }
        
        // Render risk distribution chart
        function renderRiskDistributionChart(data) {
            const ctx = document.getElementById('riskChart').getContext('2d');
            
            charts.risk = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.map(d => d.category),
                    datasets: [{
                        data: data.map(d => d.percentage),
                        backgroundColor: data.map(d => d.color),
                        borderColor: '#0c1a2b',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#ffbf00' }
                        }
                    }
                }
            });
        }
        
        // Render scatter chart
        function renderScatterChart(data) {
            const ctx = document.getElementById('scatterChart').getContext('2d');
            
            charts.scatter = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Assets',
                        data: data.map(d => ({
                            x: d.beta,
                            y: d.performance,
                            label: d.symbol
                        })),
                        backgroundColor: data.map(d => 
                            d.performance > 0 ? 'rgba(16, 185, 129, 0.6)' : 'rgba(239, 68, 68, 0.6)'
                        ),
                        borderColor: data.map(d => 
                            d.performance > 0 ? '#10b981' : '#ef4444'
                        ),
                        pointRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    const point = data[context.dataIndex];
                                    return `${point.symbol}: β=${point.beta}, Perf=${point.performance}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Beta (Risk)',
                                color: '#ffbf00'
                            },
                            ticks: { color: '#ffbf00' },
                            grid: { color: 'rgba(255, 191, 0, 0.1)' }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '24h Performance %',
                                color: '#ffbf00'
                            },
                            ticks: { color: '#ffbf00' },
                            grid: { color: 'rgba(255, 191, 0, 0.1)' }
                        }
                    }
                }
            });
        }
        
        // Show error message
        function showError(message) {
            document.getElementById('content').innerHTML = `
                <div class="error">${message}</div>
            `;
        }
        
        // Auto-refresh every 60 seconds
        setInterval(loadBetaDashboard, 60000);
        
        // Initial load
        loadBetaDashboard();
    </script>
</body>
</html>