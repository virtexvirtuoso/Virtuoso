<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Library Comparison - Live Data</title>

    <!-- Load all libraries -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <!-- 2025 Modern Alternatives -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix@2.0.1/dist/chartjs-chart-matrix.min.js"></script>
    <script src="https://unpkg.com/highcharts@11.2.0/highcharts.js"></script>
    <script src="https://unpkg.com/highcharts@11.2.0/modules/heatmap.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Dark.js"></script>
    <script src="https://unpkg.com/billboard.js@3.17.0/dist/billboard.pkgd.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/billboard.js@3.17.0/dist/billboard.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'IBM Plex Mono', monospace;
            background: #0a0a0a;
            color: #f5f5f5;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(135deg, #1e3a8a 0%, #be123c 100%);
            border-radius: 12px;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header p {
            color: #d1d5db;
            font-size: 14px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .chart-container:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #fbbf24;
        }

        .chart-stats {
            display: flex;
            gap: 16px;
            font-size: 12px;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .stat-label {
            color: #9ca3af;
            font-size: 10px;
            text-transform: uppercase;
        }

        .stat-value {
            color: #10b981;
            font-weight: 600;
        }

        .chart-wrapper {
            width: 100%;
            height: 400px;
            position: relative;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 400px;
            color: #9ca3af;
        }

        .pros-cons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .comparison-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
        }

        .comparison-card h3 {
            color: #fbbf24;
            margin-bottom: 12px;
            font-size: 16px;
        }

        .comparison-card ul {
            list-style: none;
            font-size: 13px;
            line-height: 1.8;
        }

        .comparison-card li {
            padding-left: 20px;
            position: relative;
        }

        .comparison-card li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #10b981;
        }

        .comparison-card li.con::before {
            content: "‚úó";
            color: #ef4444;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fbbf24;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä Chart Library Comparison - Live Correlation Data</h1>
        <p>Real-time correlation matrix rendered with 5 different libraries</p>
    </div>

    <div class="grid">
        <!-- Plotly (Current) -->
        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title">Plotly.js (Current)</div>
                <div class="chart-stats">
                    <div class="stat">
                        <span class="stat-label">Bundle</span>
                        <span class="stat-value" id="plotly-size">3.0 MB</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Render</span>
                        <span class="stat-value" id="plotly-time">-</span>
                    </div>
                </div>
            </div>
            <div class="chart-wrapper">
                <div id="plotly-chart" class="loading">
                    <span class="spinner"></span>Loading...
                </div>
            </div>
        </div>

        <!-- ECharts -->
        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title">Apache ECharts</div>
                <div class="chart-stats">
                    <div class="stat">
                        <span class="stat-label">Bundle</span>
                        <span class="stat-value" id="echarts-size">400 KB</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Render</span>
                        <span class="stat-value" id="echarts-time">-</span>
                    </div>
                </div>
            </div>
            <div class="chart-wrapper">
                <div id="echarts-chart" class="loading">
                    <span class="spinner"></span>Loading...
                </div>
            </div>
        </div>

        <!-- D3.js -->
        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title">D3.js</div>
                <div class="chart-stats">
                    <div class="stat">
                        <span class="stat-label">Bundle</span>
                        <span class="stat-value" id="d3-size">70 KB</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Render</span>
                        <span class="stat-value" id="d3-time">-</span>
                    </div>
                </div>
            </div>
            <div class="chart-wrapper">
                <div id="d3-chart" class="loading">
                    <span class="spinner"></span>Loading...
                </div>
            </div>
        </div>

        <!-- ApexCharts -->
        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title">ApexCharts</div>
                <div class="chart-stats">
                    <div class="stat">
                        <span class="stat-label">Bundle</span>
                        <span class="stat-value" id="apex-size">280 KB</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Render</span>
                        <span class="stat-value" id="apex-time">-</span>
                    </div>
                </div>
            </div>
            <div class="chart-wrapper">
                <div id="apex-chart" class="loading">
                    <span class="spinner"></span>Loading...
                </div>
            </div>
        </div>

        <!-- Custom Canvas -->
        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title">Custom Canvas</div>
                <div class="chart-stats">
                    <div class="stat">
                        <span class="stat-label">Bundle</span>
                        <span class="stat-value" id="canvas-size">5 KB</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Render</span>
                        <span class="stat-value" id="canvas-time">-</span>
                    </div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="canvas-chart" class="loading"></canvas>
            </div>
        </div>

        <!-- Chart.js (2025 Popular) -->
        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title">Chart.js ‚≠ê Most Popular</div>
                <div class="chart-stats">
                    <div class="stat">
                        <span class="stat-label">Bundle</span>
                        <span class="stat-value" id="chartjs-size">60 KB</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Render</span>
                        <span class="stat-value" id="chartjs-time">-</span>
                    </div>
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="chartjs-chart" class="loading"></canvas>
            </div>
        </div>

        <!-- Highcharts (Premium) -->
        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title">Highcharts üíé Premium</div>
                <div class="chart-stats">
                    <div class="stat">
                        <span class="stat-label">Bundle</span>
                        <span class="stat-value" id="highcharts-size">300 KB</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Render</span>
                        <span class="stat-value" id="highcharts-time">-</span>
                    </div>
                </div>
            </div>
            <div class="chart-wrapper">
                <div id="highcharts-chart" class="loading">
                    <span class="spinner"></span>Loading...
                </div>
            </div>
        </div>

        <!-- amCharts 5 (Beautiful) -->
        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title">amCharts 5 ‚ú® Stunning</div>
                <div class="chart-stats">
                    <div class="stat">
                        <span class="stat-label">Bundle</span>
                        <span class="stat-value" id="amcharts-size">300 KB</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Render</span>
                        <span class="stat-value" id="amcharts-time">-</span>
                    </div>
                </div>
            </div>
            <div class="chart-wrapper">
                <div id="amcharts-chart" class="loading">
                    <span class="spinner"></span>Loading...
                </div>
            </div>
        </div>

        <!-- Billboard.js (Lightweight) -->
        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title">Billboard.js üéØ Simple</div>
                <div class="chart-stats">
                    <div class="stat">
                        <span class="stat-label">Bundle</span>
                        <span class="stat-value" id="billboard-size">70 KB</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Render</span>
                        <span class="stat-value" id="billboard-time">-</span>
                    </div>
                </div>
            </div>
            <div class="chart-wrapper">
                <div id="billboard-chart" class="loading">
                    <span class="spinner"></span>Loading...
                </div>
            </div>
        </div>
    </div>

    <div class="pros-cons">
        <div class="comparison-card">
            <h3>üèÜ Recommended: Apache ECharts</h3>
            <ul>
                <li>Best performance/features balance</li>
                <li>Beautiful defaults</li>
                <li>87% smaller than Plotly</li>
                <li>Rich built-in interactions</li>
                <li class="con">Documentation can be confusing</li>
            </ul>
        </div>

        <div class="comparison-card">
            <h3>‚ö° Fastest: Custom Canvas</h3>
            <ul>
                <li>Smallest bundle (99.8% smaller!)</li>
                <li>Maximum performance</li>
                <li>Full control</li>
                <li class="con">Most development time</li>
                <li class="con">Build all features yourself</li>
            </ul>
        </div>

        <div class="comparison-card">
            <h3>üé® Most Flexible: D3.js</h3>
            <ul>
                <li>Ultimate customization</li>
                <li>Industry standard</li>
                <li>Small core library</li>
                <li class="con">Steeper learning curve</li>
                <li class="con">More code to write</li>
            </ul>
        </div>
    </div>

    <script>
        // Fetch live correlation data
        async function fetchCorrelationData() {
            const response = await fetch('/api/correlation/matrix');
            const data = await response.json();
            return data;
        }

        // Render all charts
        async function renderAllCharts() {
            const data = await fetchCorrelationData();
            const matrix = data.correlation_matrix || data.correlations;
            const symbols = data.symbols;

            // Render each chart
            await renderPlotly(matrix, symbols);
            await renderECharts(matrix, symbols);
            await renderD3(matrix, symbols);
            await renderApex(matrix, symbols);
            await renderCanvas(matrix, symbols);
            await renderChartJS(matrix, symbols);
            await renderHighcharts(matrix, symbols);
            await renderAmCharts(matrix, symbols);
            await renderBillboard(matrix, symbols);
        }

        // 1. Plotly
        async function renderPlotly(matrix, symbols) {
            const start = performance.now();

            const zValues = [];
            const cleanSymbols = symbols.map(s => s.replace('USDT', ''));

            symbols.forEach(symbol1 => {
                const row = [];
                symbols.forEach(symbol2 => {
                    row.push(matrix[symbol1]?.[symbol2] || 0);
                });
                zValues.push(row);
            });

            const data = [{
                z: zValues,
                x: cleanSymbols,
                y: cleanSymbols,
                type: 'heatmap',
                colorscale: [[0, '#3b82f6'], [0.5, '#6b7280'], [1, '#ef4444']],
                hovertemplate: '<b>%{y} - %{x}</b><br>%{z:.2f}<extra></extra>'
            }];

            const layout = {
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent',
                font: { color: '#f5f5f5', size: 10 },
                margin: { l: 60, r: 40, t: 10, b: 60 },
                height: 400
            };

            Plotly.newPlot('plotly-chart', data, layout, { responsive: true, displayModeBar: false });

            const time = (performance.now() - start).toFixed(1);
            document.getElementById('plotly-time').textContent = time + 'ms';
        }

        // 2. ECharts
        async function renderECharts(matrix, symbols) {
            const start = performance.now();

            const chart = echarts.init(document.getElementById('echarts-chart'));
            const cleanSymbols = symbols.map(s => s.replace('USDT', ''));

            // Transform data
            const data = [];
            symbols.forEach((symbol1, i) => {
                symbols.forEach((symbol2, j) => {
                    data.push([j, i, matrix[symbol1]?.[symbol2] || 0]);
                });
            });

            const option = {
                tooltip: {
                    position: 'top',
                    formatter: (params) => {
                        return `${cleanSymbols[params.data[1]]} - ${cleanSymbols[params.data[0]]}<br/>` +
                               `<strong>${params.data[2].toFixed(2)}</strong>`;
                    }
                },
                grid: {
                    height: '70%',
                    top: '10%',
                    left: '15%'
                },
                xAxis: {
                    type: 'category',
                    data: cleanSymbols,
                    axisLabel: { color: '#f5f5f5', fontSize: 10 },
                    splitArea: { show: true }
                },
                yAxis: {
                    type: 'category',
                    data: cleanSymbols,
                    axisLabel: { color: '#f5f5f5', fontSize: 10 },
                    splitArea: { show: true }
                },
                visualMap: {
                    min: -1,
                    max: 1,
                    calculable: true,
                    orient: 'vertical',
                    right: '5%',
                    top: 'center',
                    inRange: {
                        color: ['#3b82f6', '#6b7280', '#ef4444']
                    },
                    textStyle: { color: '#f5f5f5' }
                },
                series: [{
                    type: 'heatmap',
                    data: data,
                    label: {
                        show: false
                    },
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]
            };

            chart.setOption(option);

            const time = (performance.now() - start).toFixed(1);
            document.getElementById('echarts-time').textContent = time + 'ms';
        }

        // 3. D3.js
        async function renderD3(matrix, symbols) {
            const start = performance.now();

            const container = d3.select('#d3-chart');
            container.html(''); // Clear loading

            const width = 500;
            const height = 400;
            const margin = { top: 10, right: 40, bottom: 60, left: 60 };
            const cellSize = (Math.min(width - margin.left - margin.right, height - margin.top - margin.bottom)) / symbols.length;

            const svg = container.append('svg')
                .attr('width', width)
                .attr('height', height);

            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const cleanSymbols = symbols.map(s => s.replace('USDT', ''));

            // Color scale
            const colorScale = d3.scaleLinear()
                .domain([-1, 0, 1])
                .range(['#3b82f6', '#6b7280', '#ef4444']);

            // Create cells
            symbols.forEach((symbol1, i) => {
                symbols.forEach((symbol2, j) => {
                    const value = matrix[symbol1]?.[symbol2] || 0;

                    g.append('rect')
                        .attr('x', j * cellSize)
                        .attr('y', i * cellSize)
                        .attr('width', cellSize)
                        .attr('height', cellSize)
                        .attr('fill', colorScale(value))
                        .attr('stroke', '#0a0a0a')
                        .attr('stroke-width', 1)
                        .append('title')
                        .text(`${cleanSymbols[i]} - ${cleanSymbols[j]}: ${value.toFixed(2)}`);
                });
            });

            // X axis labels
            g.selectAll('.x-label')
                .data(cleanSymbols)
                .enter()
                .append('text')
                .attr('x', (d, i) => i * cellSize + cellSize / 2)
                .attr('y', symbols.length * cellSize + 15)
                .attr('text-anchor', 'middle')
                .attr('fill', '#f5f5f5')
                .attr('font-size', '10px')
                .text(d => d);

            // Y axis labels
            g.selectAll('.y-label')
                .data(cleanSymbols)
                .enter()
                .append('text')
                .attr('x', -5)
                .attr('y', (d, i) => i * cellSize + cellSize / 2 + 3)
                .attr('text-anchor', 'end')
                .attr('fill', '#f5f5f5')
                .attr('font-size', '10px')
                .text(d => d);

            const time = (performance.now() - start).toFixed(1);
            document.getElementById('d3-time').textContent = time + 'ms';
        }

        // 4. ApexCharts
        async function renderApex(matrix, symbols) {
            const start = performance.now();

            const cleanSymbols = symbols.map(s => s.replace('USDT', ''));

            // Transform data for ApexCharts
            const series = symbols.map((symbol1, i) => ({
                name: cleanSymbols[i],
                data: symbols.map((symbol2) => matrix[symbol1]?.[symbol2] || 0)
            }));

            const options = {
                chart: {
                    type: 'heatmap',
                    height: 400,
                    background: 'transparent',
                    toolbar: { show: false }
                },
                plotOptions: {
                    heatmap: {
                        colorScale: {
                            ranges: [
                                { from: -1, to: -0.3, color: '#3b82f6', name: 'Negative' },
                                { from: -0.3, to: 0.3, color: '#6b7280', name: 'Neutral' },
                                { from: 0.3, to: 1, color: '#ef4444', name: 'Positive' }
                            ]
                        }
                    }
                },
                dataLabels: { enabled: false },
                xaxis: {
                    categories: cleanSymbols,
                    labels: {
                        style: { colors: '#f5f5f5', fontSize: '10px' }
                    }
                },
                yaxis: {
                    labels: {
                        style: { colors: '#f5f5f5', fontSize: '10px' }
                    }
                },
                tooltip: {
                    theme: 'dark',
                    y: {
                        formatter: (val) => val.toFixed(2)
                    }
                },
                theme: { mode: 'dark' },
                series: series
            };

            const chart = new ApexCharts(document.querySelector("#apex-chart"), options);
            chart.render();

            const time = (performance.now() - start).toFixed(1);
            document.getElementById('apex-time').textContent = time + 'ms';
        }

        // 5. Custom Canvas
        async function renderCanvas(matrix, symbols) {
            const start = performance.now();

            const canvas = document.getElementById('canvas-chart');
            const ctx = canvas.getContext('2d');

            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = 400;

            const cleanSymbols = symbols.map(s => s.replace('USDT', ''));
            const cellSize = Math.min(canvas.width / symbols.length, canvas.height / symbols.length);

            // Color interpolation
            function getColor(value) {
                if (value < 0) {
                    const t = (value + 1);
                    return `rgb(${Math.floor(59 + (107 - 59) * t)}, ${Math.floor(130 + (115 - 130) * t)}, ${Math.floor(246 + (128 - 246) * t)})`;
                } else {
                    const t = value;
                    return `rgb(${Math.floor(107 + (239 - 107) * t)}, ${Math.floor(115 + (68 - 115) * t)}, ${Math.floor(128 + (68 - 128) * t)})`;
                }
            }

            // Draw cells
            symbols.forEach((symbol1, i) => {
                symbols.forEach((symbol2, j) => {
                    const value = matrix[symbol1]?.[symbol2] || 0;
                    ctx.fillStyle = getColor(value);
                    ctx.fillRect(j * cellSize, i * cellSize, cellSize, cellSize);

                    // Border
                    ctx.strokeStyle = '#0a0a0a';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(j * cellSize, i * cellSize, cellSize, cellSize);
                });
            });

            // Labels
            ctx.fillStyle = '#f5f5f5';
            ctx.font = '10px IBM Plex Mono';
            ctx.textAlign = 'center';

            // X labels
            cleanSymbols.forEach((label, i) => {
                ctx.fillText(label, i * cellSize + cellSize / 2, symbols.length * cellSize + 15);
            });

            // Y labels
            ctx.textAlign = 'right';
            cleanSymbols.forEach((label, i) => {
                ctx.fillText(label, -5, i * cellSize + cellSize / 2 + 3);
            });

            const time = (performance.now() - start).toFixed(1);
            document.getElementById('canvas-time').textContent = time + 'ms';
        }

        // 6. Chart.js (with Matrix plugin)
        async function renderChartJS(matrix, symbols) {
            const start = performance.now();

            const cleanSymbols = symbols.map(s => s.replace('USDT', ''));

            // Transform data for Chart.js Matrix plugin
            const data = [];
            symbols.forEach((symbol1, i) => {
                symbols.forEach((symbol2, j) => {
                    const value = matrix[symbol1]?.[symbol2] || 0;
                    data.push({ x: cleanSymbols[j], y: cleanSymbols[i], v: value });
                });
            });

            const ctx = document.getElementById('chartjs-chart').getContext('2d');
            new Chart(ctx, {
                type: 'matrix',
                data: {
                    datasets: [{
                        label: 'Correlation',
                        data: data,
                        backgroundColor(context) {
                            const value = context.dataset.data[context.dataIndex]?.v || 0;
                            if (value < 0) {
                                const t = (value + 1);
                                return `rgba(59, 130, 246, ${0.3 + t * 0.7})`;
                            } else {
                                const t = value;
                                return `rgba(239, 68, 68, ${0.3 + t * 0.7})`;
                            }
                        },
                        borderWidth: 1,
                        borderColor: '#0a0a0a',
                        width: ({ chart }) => (chart.chartArea || {}).width / symbols.length,
                        height: ({ chart }) => (chart.chartArea || {}).height / symbols.length
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                title: () => '',
                                label(context) {
                                    const v = context.dataset.data[context.dataIndex];
                                    return `${v.y} - ${v.x}: ${v.v.toFixed(2)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'category',
                            labels: cleanSymbols,
                            ticks: {
                                color: '#f5f5f5',
                                font: { size: 10 }
                            },
                            grid: { display: false }
                        },
                        y: {
                            type: 'category',
                            labels: cleanSymbols,
                            ticks: {
                                color: '#f5f5f5',
                                font: { size: 10 }
                            },
                            grid: { display: false }
                        }
                    }
                }
            });

            const time = (performance.now() - start).toFixed(1);
            document.getElementById('chartjs-time').textContent = time + 'ms';
        }

        // 7. Highcharts
        async function renderHighcharts(matrix, symbols) {
            const start = performance.now();

            if (typeof Highcharts === 'undefined') {
                console.error('Highcharts library not loaded');
                document.getElementById('highcharts-time').textContent = 'Error';
                return;
            }

            try {
                const cleanSymbols = symbols.map(s => s.replace('USDT', ''));

                // Transform data for Highcharts
                const data = [];
                symbols.forEach((symbol1, i) => {
                    symbols.forEach((symbol2, j) => {
                        const value = matrix[symbol1]?.[symbol2] || 0;
                        data.push([j, i, value]);
                    });
                });

                Highcharts.chart('highcharts-chart', {
                chart: {
                    type: 'heatmap',
                    backgroundColor: 'transparent',
                    height: 400
                },
                title: { text: null },
                xAxis: {
                    categories: cleanSymbols,
                    labels: {
                        style: { color: '#f5f5f5', fontSize: '10px' }
                    }
                },
                yAxis: {
                    categories: cleanSymbols,
                    title: null,
                    labels: {
                        style: { color: '#f5f5f5', fontSize: '10px' }
                    }
                },
                colorAxis: {
                    min: -1,
                    max: 1,
                    stops: [
                        [0, '#3b82f6'],
                        [0.5, '#6b7280'],
                        [1, '#ef4444']
                    ]
                },
                legend: {
                    enabled: false
                },
                tooltip: {
                    formatter: function() {
                        return `<b>${this.series.yAxis.categories[this.point.y]} - ${this.series.xAxis.categories[this.point.x]}</b><br>${this.point.value.toFixed(2)}`;
                    }
                },
                series: [{
                    name: 'Correlation',
                    borderWidth: 1,
                    borderColor: '#0a0a0a',
                    data: data,
                    dataLabels: {
                        enabled: false
                    }
                }],
                credits: { enabled: false }
                });

                const time = (performance.now() - start).toFixed(1);
                document.getElementById('highcharts-time').textContent = time + 'ms';
            } catch (error) {
                console.error('Highcharts rendering error:', error);
                document.getElementById('highcharts-time').textContent = 'Error';
            }
        }

        // 8. amCharts 5
        async function renderAmCharts(matrix, symbols) {
            const start = performance.now();

            if (typeof am5 === 'undefined') {
                console.error('amCharts 5 library not loaded');
                document.getElementById('amcharts-time').textContent = 'Error';
                return;
            }

            try {
                // Clear any existing chart
                const container = document.getElementById('amcharts-chart');
                container.innerHTML = '';

                const root = am5.Root.new("amcharts-chart");
            root.setThemes([am5themes_Dark.new(root)]);

            const chart = root.container.children.push(am5xy.XYChart.new(root, {
                panX: false,
                panY: false,
                wheelX: "none",
                wheelY: "none",
                layout: root.verticalLayout
            }));

            const cleanSymbols = symbols.map(s => s.replace('USDT', ''));

            // Create Y axis (vertical - symbols)
            const yRenderer = am5xy.AxisRendererY.new(root, {
                minGridDistance: 20,
                inversed: true
            });
            yRenderer.labels.template.setAll({
                fontSize: 10,
                fill: am5.color(0xf5f5f5)
            });

            const yAxis = chart.yAxes.push(am5xy.CategoryAxis.new(root, {
                categoryField: "y",
                renderer: yRenderer
            }));
            yAxis.data.setAll(cleanSymbols.map(s => ({ y: s })));

            // Create X axis (horizontal - symbols)
            const xRenderer = am5xy.AxisRendererX.new(root, {
                minGridDistance: 20
            });
            xRenderer.labels.template.setAll({
                fontSize: 10,
                fill: am5.color(0xf5f5f5)
            });

            const xAxis = chart.xAxes.push(am5xy.CategoryAxis.new(root, {
                categoryField: "x",
                renderer: xRenderer
            }));
            xAxis.data.setAll(cleanSymbols.map(s => ({ x: s })));

            // Create series for heatmap
            const series = chart.series.push(am5xy.ColumnSeries.new(root, {
                xAxis: xAxis,
                yAxis: yAxis,
                categoryXField: "x",
                categoryYField: "y",
                valueField: "value",
                clustered: false
            }));

            // Configure column appearance
            series.columns.template.setAll({
                width: am5.percent(100),
                height: am5.percent(100),
                strokeWidth: 1,
                stroke: am5.color(0x0a0a0a),
                tooltipText: "{y} - {x}: {value}"
            });

            // Color based on correlation value
            series.columns.template.adapters.add("fill", (fill, target) => {
                const dataItem = target.dataItem;
                if (!dataItem) return fill;

                const value = dataItem.get("value", 0);

                // Color scale: blue (negative) -> gray (neutral) -> red (positive)
                if (value < 0) {
                    // Negative correlation: shades of blue
                    const intensity = Math.abs(value);
                    const r = Math.floor(59 + (107 - 59) * (1 - intensity));
                    const g = Math.floor(130 + (115 - 130) * (1 - intensity));
                    const b = Math.floor(246 + (128 - 246) * (1 - intensity));
                    const hex = (r << 16) | (g << 8) | b;
                    return am5.color(hex);
                } else {
                    // Positive correlation: shades of red
                    const intensity = value;
                    const r = Math.floor(107 + (239 - 107) * intensity);
                    const g = Math.floor(115 + (68 - 115) * intensity);
                    const b = Math.floor(128 + (68 - 128) * intensity);
                    const hex = (r << 16) | (g << 8) | b;
                    return am5.color(hex);
                }
            });

            // Transform data
            const data = [];
            symbols.forEach((symbol1, i) => {
                symbols.forEach((symbol2, j) => {
                    const value = matrix[symbol1]?.[symbol2] || 0;
                    data.push({
                        x: cleanSymbols[j],
                        y: cleanSymbols[i],
                        value: value
                    });
                });
            });

            series.data.setAll(data);

                // Animate on load
                series.appear(1000);
                chart.appear(1000, 100);

                const time = (performance.now() - start).toFixed(1);
                document.getElementById('amcharts-time').textContent = time + 'ms';
            } catch (error) {
                console.error('amCharts 5 rendering error:', error);
                document.getElementById('amcharts-time').textContent = 'Error';
            }
        }

        // 9. Billboard.js
        async function renderBillboard(matrix, symbols) {
            const start = performance.now();

            try {
                const cleanSymbols = symbols.map(s => s.replace('USDT', ''));

                // Billboard doesn't have native heatmap, so we'll create a custom grid visualization
                const container = document.getElementById('billboard-chart');
            container.style.position = 'relative';
            container.style.height = '400px';

                // Create custom heatmap grid
                const cellSize = Math.floor(400 / symbols.length);
                let html = '<div style="display: grid; grid-template-columns: repeat(' + symbols.length + ', ' + cellSize + 'px); grid-template-rows: repeat(' + symbols.length + ', ' + cellSize + 'px); gap: 1px; width: fit-content;">';

                symbols.forEach((symbol1, i) => {
                    symbols.forEach((symbol2, j) => {
                        const value = matrix[symbol1]?.[symbol2] || 0;
                        let color;
                        if (value < 0) {
                            const t = (value + 1);
                            color = `rgb(${Math.floor(59 + (107 - 59) * t)}, ${Math.floor(130 + (115 - 130) * t)}, ${Math.floor(246 + (128 - 246) * t)})`;
                        } else {
                            const t = value;
                            color = `rgb(${Math.floor(107 + (239 - 107) * t)}, ${Math.floor(115 + (68 - 115) * t)}, ${Math.floor(128 + (68 - 128) * t)})`;
                        }
                        html += `<div style="background: ${color}; border: 1px solid #0a0a0a; display: flex; align-items: center; justify-content: center; font-size: 8px; color: #f5f5f5;" title="${cleanSymbols[i]} - ${cleanSymbols[j]}: ${value.toFixed(2)}"></div>`;
                    });
                });
                html += '</div>';

                container.innerHTML = html;

                const time = (performance.now() - start).toFixed(1);
                document.getElementById('billboard-time').textContent = time + 'ms';
            } catch (error) {
                console.error('Billboard.js rendering error:', error);
                document.getElementById('billboard-time').textContent = 'Error';
            }
        }

        // Wait for all libraries to load before rendering
        function checkLibrariesLoaded() {
            const libraries = {
                'Plotly': typeof Plotly !== 'undefined',
                'echarts': typeof echarts !== 'undefined',
                'd3': typeof d3 !== 'undefined',
                'ApexCharts': typeof ApexCharts !== 'undefined',
                'Chart': typeof Chart !== 'undefined',
                'Highcharts': typeof Highcharts !== 'undefined',
                'am5': typeof am5 !== 'undefined',
                'bb': typeof bb !== 'undefined'
            };

            const allLoaded = Object.values(libraries).every(loaded => loaded);

            if (allLoaded) {
                console.log('‚úÖ All libraries loaded, rendering charts...');
                renderAllCharts();
            } else {
                const missing = Object.entries(libraries)
                    .filter(([name, loaded]) => !loaded)
                    .map(([name]) => name);
                console.log('‚è≥ Waiting for libraries:', missing.join(', '));
                setTimeout(checkLibrariesLoaded, 100);
            }
        }

        // Start checking when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', checkLibrariesLoaded);
        } else {
            checkLibrariesLoaded();
        }
    </script>
</body>
</html>
