<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Enhanced Smart Money Liquidation Tracker ‚Äì Variant 1</title>
    <style>
        :root {
            --bg-body: #070b12;
            --bg-panel: #0c121c;
            --border-light: #1b2433;
            --text-primary: #e6edf3;
            --text-secondary: #9aa7b8;
            --accent-primary: #42a5f5;
            --accent-positive: #4caf50;
            --accent-warning: #ff9900;
            --accent-negative: #f44336;
            --content-padding: 16px;
            --card-gap: 16px;
            --long-color: #ef4444;
            --short-color: #22c55e;
        }

        body {
            margin: 0;
            background: var(--bg-body);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 1200px;
            margin: 16px auto;
            padding: var(--content-padding);
        }

        .panel {
            background: var(--bg-panel);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transform: translate3d(0, 0, 0);
            contain: layout style paint;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: 0.3px;
        }

        .badge {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 500;
            background: rgba(255, 153, 0, 0.2);
            color: var(--accent-warning);
        }

        /* Timeframe Tabs */
        .timeframe-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 16px;
            background: rgba(255,255,255,0.02);
            border-radius: 12px;
            padding: 4px;
        }

        .tab {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-secondary);
        }

        .tab.active {
            background: var(--accent-primary);
            color: white;
        }

        .tab:hover:not(.active) {
            background: rgba(255,255,255,0.05);
            color: var(--text-primary);
        }

        /* Vertical Heatmap */
        .heatmap-container {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
        }

        .price-scale {
            width: 60px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-size: 11px;
            color: var(--text-secondary);
            padding: 8px 0;
        }

        .vertical-heatmap {
            flex: 1;
            height: 300px;
            background: #0a1018;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            position: relative;
            display: flex;
        }

        .liquidation-side {
            flex: 1;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .side-long {
            border-right: 1px solid var(--border-light);
        }

        .liq-bar {
            position: relative;
            margin: 1px 0;
            border-radius: 2px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .liq-bar:hover {
            transform: scaleX(1.05);
            z-index: 10;
        }

        .liq-bar.long {
            background: linear-gradient(90deg, var(--long-color), transparent);
            justify-content: flex-end;
            padding-right: 4px;
        }

        .liq-bar.short {
            background: linear-gradient(-90deg, var(--short-color), transparent);
            justify-content: flex-start;
            padding-left: 4px;
        }

        .bar-bubble {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            opacity: 0.8;
        }

        .current-price-line {
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--accent-primary);
            box-shadow: 0 0 8px var(--accent-primary);
            z-index: 20;
        }

        .price-label {
            position: absolute;
            right: -60px;
            top: -8px;
            background: var(--accent-primary);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        /* CLLD Chart */
        .clld-container {
            margin-bottom: 16px;
        }

        .clld-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .clld-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .clld-value {
            font-size: 14px;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 6px;
        }

        .clld-chart {
            height: 60px;
            background: #0a1018;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .clld-bars {
            display: flex;
            height: 100%;
            align-items: end;
            padding: 4px;
            gap: 1px;
        }

        .clld-bar {
            flex: 1;
            border-radius: 1px 1px 0 0;
            min-height: 2px;
        }

        .clld-positive { background: var(--short-color); }
        .clld-negative { background: var(--long-color); }

        /* Enhanced Table */
        .enhanced-table {
            background: rgba(255,255,255,0.02);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            overflow: hidden;
        }

        .table-header {
            display: grid;
            grid-template-columns: 80px 1fr 80px 80px 80px 80px;
            background: rgba(255,255,255,0.05);
            border-bottom: 1px solid var(--border-light);
            padding: 12px 16px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .table-row {
            display: grid;
            grid-template-columns: 80px 1fr 80px 80px 80px 80px;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-light);
            transition: background 0.2s;
            cursor: pointer;
        }

        .table-row:hover {
            background: rgba(255,255,255,0.03);
        }

        .table-row:last-child {
            border-bottom: none;
        }

        .symbol-cell {
            font-weight: 700;
            color: var(--text-primary);
        }

        .metrics-cell {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            font-size: 11px;
            color: var(--text-secondary);
        }

        .metric-tag {
            padding: 2px 4px;
            border-radius: 4px;
            background: rgba(255,255,255,0.05);
        }

        .score-cell {
            text-align: center;
            font-weight: 700;
            padding: 6px 8px;
            border-radius: 8px;
            font-size: 13px;
        }

        .score-high { background: rgba(76, 175, 80, 0.18); color: var(--accent-positive); }
        .score-medium { background: rgba(255, 153, 0, 0.18); color: var(--accent-warning); }
        .score-low { background: rgba(244, 67, 54, 0.18); color: var(--accent-negative); }

        .rr-score {
            font-weight: 700;
            font-size: 14px;
        }

        /* Tooltip */
        .tooltip {
            position: absolute;
            background: var(--bg-panel);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 12px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.2s;
            max-width: 250px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .tooltip.show {
            opacity: 1;
        }

        .tooltip-title {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .tooltip-item {
            display: flex;
            justify-content: space-between;
            margin: 3px 0;
        }

        /* Legend */
        .legend {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        .legend-items {
            display: flex;
            gap: 16px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .legend-color {
            width: 12px;
            height: 3px;
            border-radius: 2px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .table-header, .table-row {
                grid-template-columns: 60px 1fr 60px 60px;
            }
            
            .table-header .hide-mobile,
            .table-row .hide-mobile {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="panel">
            <div class="card-header">
                <h1 class="card-title">Enhanced Smart Money Liquidation Tracker</h1>
                <span class="badge">LIVE</span>
            </div>

            <!-- Timeframe Tabs -->
            <div class="timeframe-tabs">
                <div class="tab active" data-timeframe="1h">1H</div>
                <div class="tab" data-timeframe="4h">4H</div>
                <div class="tab" data-timeframe="1d">1D</div>
                <div class="tab" data-timeframe="1w">1W</div>
            </div>

            <!-- Vertical Heatmap -->
            <div class="heatmap-container">
                <div class="price-scale" id="priceScale">
                    <!-- Price levels will be generated -->
                </div>
                <div class="vertical-heatmap" id="verticalHeatmap">
                    <div class="liquidation-side side-long" id="longSide">
                        <!-- Long liquidation bars -->
                    </div>
                    <div class="liquidation-side side-short" id="shortSide">
                        <!-- Short liquidation bars -->
                    </div>
                    <div class="current-price-line" id="currentPriceLine">
                        <div class="price-label" id="priceLabel">$0</div>
                    </div>
                </div>
            </div>

            <div class="legend">
                <div class="legend-items">
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--long-color);"></div>
                        <span>Long Liquidations (Downside Risk)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--short-color);"></div>
                        <span>Short Liquidations (Upside Potential)</span>
                    </div>
                </div>
                <span id="heatmapStatus">Clusters near current price</span>
            </div>

            <!-- CLLD Chart -->
            <div class="clld-container">
                <div class="clld-header">
                    <div class="clld-title">Cumulative Liquidation Delta (CLLD)</div>
                    <div class="clld-value" id="clldValue">+2.3%</div>
                </div>
                <div class="clld-chart">
                    <div class="clld-bars" id="clldBars">
                        <!-- CLLD bars will be generated -->
                    </div>
                </div>
            </div>

            <!-- Enhanced Table -->
            <div class="enhanced-table">
                <div class="table-header">
                    <div>Symbol</div>
                    <div>Metrics</div>
                    <div>Squeeze %</div>
                    <div>Z-Score</div>
                    <div class="hide-mobile">Volume</div>
                    <div>R:R Score</div>
                </div>
                <div id="tableRows">
                    <!-- Table rows will be generated -->
                </div>
            </div>
        </div>
    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>

    <script>
        // Enhanced demo data with more realistic trading metrics
        const demoData = {
            currentPrice: 67850,
            timeframes: {
                '1h': {
                    priceRange: { min: 67200, max: 68500 },
                    longLiquidations: [
                        { price: 67300, volume: 0.8, zScore: 2.1, whaleActivity: true },
                        { price: 67100, volume: 0.6, zScore: 1.8, whaleActivity: false },
                        { price: 66900, volume: 0.9, zScore: 2.4, whaleActivity: true },
                        { price: 66700, volume: 0.4, zScore: 1.2, whaleActivity: false },
                        { price: 66500, volume: 0.7, zScore: 1.9, whaleActivity: false },
                    ],
                    shortLiquidations: [
                        { price: 68000, volume: 0.7, zScore: 1.9, whaleActivity: false },
                        { price: 68200, volume: 0.9, zScore: 2.3, whaleActivity: true },
                        { price: 68400, volume: 0.5, zScore: 1.5, whaleActivity: false },
                        { price: 68600, volume: 0.8, zScore: 2.0, whaleActivity: true },
                    ],
                    clld: [0.2, -0.1, 0.3, 0.5, -0.2, 0.4, 0.1, -0.3, 0.6, 0.2, -0.1, 0.4, 0.3, -0.2, 0.5, 0.1, -0.4, 0.7, 0.2, 0.3],
                    symbols: [
                        { 
                            sym: 'BTCUSDT', 
                            oi1h: '+2.3%', 
                            px1h: '-0.8%', 
                            fundZ: '+2.1œÉ', 
                            ls: '62/38', 
                            density: 84, 
                            p: 78,
                            volume24h: '2.4B',
                            rrScore: 8.2,
                            reversal: 0.73
                        },
                        { 
                            sym: 'ETHUSDT', 
                            oi1h: '+1.7%', 
                            px1h: '-0.5%', 
                            fundZ: '+1.6œÉ', 
                            ls: '58/42', 
                            density: 71, 
                            p: 72,
                            volume24h: '1.8B',
                            rrScore: 6.8,
                            reversal: 0.65
                        },
                        { 
                            sym: 'SOLUSDT', 
                            oi1h: '+2.9%', 
                            px1h: '-1.3%', 
                            fundZ: '+2.4œÉ', 
                            ls: '65/35', 
                            density: 88, 
                            p: 81,
                            volume24h: '890M',
                            rrScore: 9.1,
                            reversal: 0.79
                        },
                        { 
                            sym: 'ADAUSDT', 
                            oi1h: '+1.2%', 
                            px1h: '-0.3%', 
                            fundZ: '+0.9œÉ', 
                            ls: '54/46', 
                            density: 56, 
                            p: 58,
                            volume24h: '420M',
                            rrScore: 5.4,
                            reversal: 0.52
                        },
                        { 
                            sym: 'DOTUSDT', 
                            oi1h: '+1.8%', 
                            px1h: '-0.7%', 
                            fundZ: '+1.3œÉ', 
                            ls: '59/41', 
                            density: 63, 
                            p: 67,
                            volume24h: '310M',
                            rrScore: 6.2,
                            reversal: 0.61
                        }
                    ]
                }
            }
        };

        let currentTimeframe = '1h';

        function formatPrice(price) {
            return `$${price.toLocaleString()}`;
        }

        function formatVolume(vol) {
            if (vol >= 1e9) return `${(vol / 1e9).toFixed(1)}B`;
            if (vol >= 1e6) return `${(vol / 1e6).toFixed(0)}M`;
            return `${vol.toFixed(0)}K`;
        }

        function renderPriceScale() {
            const data = demoData.timeframes[currentTimeframe];
            const priceScale = document.getElementById('priceScale');
            const levels = 15;
            const step = (data.priceRange.max - data.priceRange.min) / (levels - 1);
            
            let html = '';
            for (let i = 0; i < levels; i++) {
                const price = data.priceRange.max - (i * step);
                html += `<div style="font-size: 10px;">${formatPrice(Math.round(price))}</div>`;
            }
            priceScale.innerHTML = html;
        }

        function renderVerticalHeatmap() {
            const data = demoData.timeframes[currentTimeframe];
            const longSide = document.getElementById('longSide');
            const shortSide = document.getElementById('shortSide');
            const priceLine = document.getElementById('currentPriceLine');
            const priceLabel = document.getElementById('priceLabel');
            
            const levels = 15;
            const step = (data.priceRange.max - data.priceRange.min) / (levels - 1);
            
            // Position current price line
            const pricePosition = ((data.priceRange.max - demoData.currentPrice) / (data.priceRange.max - data.priceRange.min)) * 100;
            priceLine.style.top = `${pricePosition}%`;
            priceLabel.textContent = formatPrice(demoData.currentPrice);
            
            // Render long liquidations (left side)
            let longHtml = '';
            for (let i = 0; i < levels; i++) {
                const price = data.priceRange.max - (i * step);
                const liquidation = data.longLiquidations.find(liq => Math.abs(liq.price - price) < step * 0.5);
                
                if (liquidation) {
                    const intensity = liquidation.volume;
                    const width = intensity * 90; // Max 90% width
                    const opacity = 0.3 + (intensity * 0.7);
                    longHtml += `
                        <div class="liq-bar long" 
                             style="height: ${100/levels}%; width: ${width}%; opacity: ${opacity};"
                             data-price="${formatPrice(liquidation.price)}"
                             data-volume="${formatVolume(liquidation.volume * 100000000)}"
                             data-zscore="${liquidation.zScore.toFixed(1)}œÉ"
                             data-whale="${liquidation.whaleActivity}">
                            ${liquidation.whaleActivity ? '<div class="bar-bubble"></div>' : ''}
                        </div>`;
                } else {
                    longHtml += `<div style="height: ${100/levels}%;"></div>`;
                }
            }
            longSide.innerHTML = longHtml;
            
            // Render short liquidations (right side)
            let shortHtml = '';
            for (let i = 0; i < levels; i++) {
                const price = data.priceRange.max - (i * step);
                const liquidation = data.shortLiquidations.find(liq => Math.abs(liq.price - price) < step * 0.5);
                
                if (liquidation) {
                    const intensity = liquidation.volume;
                    const width = intensity * 90;
                    const opacity = 0.3 + (intensity * 0.7);
                    shortHtml += `
                        <div class="liq-bar short" 
                             style="height: ${100/levels}%; width: ${width}%; opacity: ${opacity};"
                             data-price="${formatPrice(liquidation.price)}"
                             data-volume="${formatVolume(liquidation.volume * 100000000)}"
                             data-zscore="${liquidation.zScore.toFixed(1)}œÉ"
                             data-whale="${liquidation.whaleActivity}">
                            ${liquidation.whaleActivity ? '<div class="bar-bubble"></div>' : ''}
                        </div>`;
                } else {
                    shortHtml += `<div style="height: ${100/levels}%;"></div>`;
                }
            }
            shortSide.innerHTML = shortHtml;
        }

        function renderCLLDChart() {
            const data = demoData.timeframes[currentTimeframe];
            const clldBars = document.getElementById('clldBars');
            const clldValue = document.getElementById('clldValue');
            
            const currentCLLD = data.clld[data.clld.length - 1];
            clldValue.textContent = `${currentCLLD > 0 ? '+' : ''}${(currentCLLD * 100).toFixed(1)}%`;
            clldValue.className = `clld-value ${currentCLLD > 0 ? 'score-high' : 'score-low'}`;
            
            const maxAbs = Math.max(...data.clld.map(Math.abs));
            clldBars.innerHTML = data.clld.map(val => {
                const height = (Math.abs(val) / maxAbs) * 100;
                const className = val >= 0 ? 'clld-positive' : 'clld-negative';
                return `<div class="clld-bar ${className}" style="height: ${height}%;"></div>`;
            }).join('');
        }

        function renderEnhancedTable() {
            const data = demoData.timeframes[currentTimeframe];
            const tableRows = document.getElementById('tableRows');
            
            // Sort by squeeze probability descending
            const sortedSymbols = [...data.symbols].sort((a, b) => b.p - a.p);
            
            tableRows.innerHTML = sortedSymbols.map(symbol => {
                const pClass = symbol.p >= 75 ? 'score-high' : symbol.p >= 55 ? 'score-medium' : 'score-low';
                const rrClass = symbol.rrScore >= 7 ? 'score-high' : symbol.rrScore >= 5 ? 'score-medium' : 'score-low';
                const zScore = parseFloat(symbol.fundZ.replace('œÉ', ''));
                const zClass = Math.abs(zScore) >= 2 ? 'score-high' : Math.abs(zScore) >= 1.5 ? 'score-medium' : 'score-low';
                
                return `
                    <div class="table-row" data-symbol="${symbol.sym}">
                        <div class="symbol-cell">${symbol.sym.replace('USDT', '')}</div>
                        <div class="metrics-cell">
                            <span class="metric-tag">OI: ${symbol.oi1h}</span>
                            <span class="metric-tag">Px: ${symbol.px1h}</span>
                            <span class="metric-tag">L/S: ${symbol.ls}</span>
                            <span class="metric-tag">Density: ${symbol.density}</span>
                        </div>
                        <div class="score-cell ${pClass}">${symbol.p}%</div>
                        <div class="score-cell ${zClass}">${symbol.fundZ}</div>
                        <div class="score-cell hide-mobile">${symbol.volume24h}</div>
                        <div class="score-cell rr-score ${rrClass}">${symbol.rrScore}</div>
                    </div>`;
            }).join('');
        }

        function setupInteractivity() {
            // Timeframe tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    currentTimeframe = tab.dataset.timeframe;
                    renderAll();
                });
            });

            // Heatmap tooltips
            document.addEventListener('mouseover', (e) => {
                if (e.target.classList.contains('liq-bar')) {
                    showTooltip(e, e.target);
                }
            });

            document.addEventListener('mouseout', (e) => {
                if (e.target.classList.contains('liq-bar')) {
                    hideTooltip();
                }
            });

            // Table row clicks (zoom functionality placeholder)
            document.addEventListener('click', (e) => {
                const row = e.target.closest('.table-row');
                if (row) {
                    const symbol = row.dataset.symbol;
                    console.log(`Zoom to ${symbol} - Feature placeholder`);
                    // Here you would implement zoom/filter functionality
                }
            });
        }

        function showTooltip(e, element) {
            const tooltip = document.getElementById('tooltip');
            const rect = element.getBoundingClientRect();
            
            const isWhale = element.dataset.whale === 'true';
            const side = element.classList.contains('long') ? 'Long Liquidation' : 'Short Liquidation';
            
            tooltip.innerHTML = `
                <div class="tooltip-title">${side} ${isWhale ? 'üêã' : ''}</div>
                <div class="tooltip-item">
                    <span>Price Level:</span>
                    <span>${element.dataset.price}</span>
                </div>
                <div class="tooltip-item">
                    <span>Est. Volume:</span>
                    <span>${element.dataset.volume}</span>
                </div>
                <div class="tooltip-item">
                    <span>Z-Score:</span>
                    <span>${element.dataset.zscore}</span>
                </div>
                <div class="tooltip-item">
                    <span>Type:</span>
                    <span>${isWhale ? 'Whale Activity' : 'Retail Cluster'}</span>
                </div>
            `;
            
            tooltip.style.left = `${rect.right + 10}px`;
            tooltip.style.top = `${rect.top}px`;
            tooltip.classList.add('show');
        }

        function hideTooltip() {
            document.getElementById('tooltip').classList.remove('show');
        }

        function renderAll() {
            renderPriceScale();
            renderVerticalHeatmap();
            renderCLLDChart();
            renderEnhancedTable();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderAll();
            setupInteractivity();
            
            // Simulate real-time updates every 30 seconds
            setInterval(() => {
                // Add slight randomization to simulate live data
                const data = demoData.timeframes[currentTimeframe];
                data.clld.push((Math.random() - 0.5) * 0.8);
                data.clld.shift();
                renderCLLDChart();
            }, 30000);
        });
    </script>
</body>
</html>
