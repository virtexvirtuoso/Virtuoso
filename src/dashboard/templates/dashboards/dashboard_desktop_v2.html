<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtuoso Dashboard v2 - VGL</title>
    <meta name="description" content="Professional cryptocurrency trading dashboard with vue-grid-layout">
    <meta name="theme-color" content="#0a0a0a">

    <!-- Brand Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Vue 3 (production build with template compiler - self-hosted) -->
    <script src="/static/js/vue3.global.prod.js"></script>

    <!-- vue-grid-layout-v3 for Vue 3 (self-hosted) -->
    <script src="/static/js/vue-grid-layout-v3.umd.js"></script>

    <!-- Self-hosted JS libraries -->
    <script src="/static/js/lucide.min.js"></script>
    <script src="/static/js/lightweight-charts.min.js"></script>

    <!-- Plotly.js for correlation heatmap -->
    <!-- Highcharts for correlation heatmap (2.5x faster than Plotly) -->
    <script src="https://unpkg.com/highcharts@11.2.0/highcharts.js"></script>
    <script src="https://unpkg.com/highcharts@11.2.0/modules/heatmap.js"></script>

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cmVjdCB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHJ4PSI0IiBmaWxsPSIjMGEwYTBhIi8+CiAgPHBhdGggZD0ibTMgMTcgNi02IDQgNCA4LTgiIHN0cm9rZT0iI2ZiYmYyNCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KICA8cGF0aCBkPSJtMjEgNy00IDRWN2g0eiIgZmlsbD0iI2ZiYmYyNCIgc3Ryb2tlPSIjZmJiZjI0IiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8L3N2Zz4=">

    <style>
        :root {
            --neon-amber: #fbbf24;
            --neon-cyan: #06B6D4;
            --neon-red: #ff0066;

            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-panel: #161616;
            --bg-card: #1a1a1a;

            --border-light: #222222;
            --border-glow: rgba(251, 191, 36, 0.3);

            --text-primary: #f5f5f5;
            --text-secondary: #a8a8a8;
            --text-muted: #7a7a7a;
            --text-accent: #fbbf24;

            --accent-positive: #00d68f;
            --accent-negative: #ff5252;
            --accent-warning: #ffb800;
            --accent-primary: #fbbf24;

            --sidebar-width: 200px;
            --sidebar-collapsed: 56px;
            --header-height: 48px;
            --widget-gap: 10px;
            --widget-radius: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
        }

        /* Layout Structure */
        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Left Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-light);
            display: flex;
            flex-direction: column;
            transition: width 0.3s ease;
            z-index: 100;
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed);
        }

        .sidebar-header {
            height: var(--header-height);
            display: flex;
            align-items: center;
            padding: 0 16px;
            border-bottom: 1px solid var(--border-light);
            gap: 12px;
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-accent);
            font-family: 'IBM Plex Mono', monospace;
            font-weight: 700;
            font-size: 18px;
            letter-spacing: 1px;
        }

        .sidebar.collapsed .sidebar-logo span {
            display: none;
        }

        .sidebar-nav {
            flex: 1;
            padding: 16px 8px;
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: 24px;
        }

        .nav-section-title {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 0 12px;
            margin-bottom: 8px;
        }

        .sidebar.collapsed .nav-section-title {
            display: none;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 4px;
        }

        .nav-item:hover {
            background: rgba(251, 191, 36, 0.08);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: rgba(251, 191, 36, 0.15);
            color: var(--text-accent);
        }

        .nav-item i {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .nav-item span {
            font-size: 13px;
            font-weight: 500;
        }

        .sidebar.collapsed .nav-item span {
            display: none;
        }

        .sidebar.collapsed .nav-item {
            justify-content: center;
            padding: 12px;
        }

        .sidebar-footer {
            padding: 16px;
            border-top: 1px solid var(--border-light);
        }

        .collapse-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 8px;
            border: none;
            background: var(--bg-panel);
            color: var(--text-secondary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .collapse-btn:hover {
            background: var(--bg-card);
            color: var(--text-primary);
        }

        /* Main Content Area */
        .main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Top Header Bar */
        .top-header {
            height: var(--header-height);
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .market-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-positive);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            10% { opacity: 0.92; }
            20% { opacity: 0.82; }
            30% { opacity: 0.70; }
            40% { opacity: 0.58; }
            50% { opacity: 0.50; }
            60% { opacity: 0.58; }
            70% { opacity: 0.70; }
            80% { opacity: 0.82; }
            90% { opacity: 0.92; }
            100% { opacity: 1; }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .header-stats {
            display: flex;
            gap: 24px;
        }

        .header-stat {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .header-stat-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .header-stat-value {
            font-size: 14px;
            font-weight: 600;
            font-family: 'IBM Plex Mono', monospace;
        }

        .header-stat-value.positive {
            color: var(--accent-positive);
        }

        .header-stat-value.negative {
            color: var(--accent-negative);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border: none;
            background: var(--bg-panel);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .header-btn:hover {
            background: var(--bg-card);
            color: var(--text-primary);
        }

        .header-btn i {
            width: 18px;
            height: 18px;
        }

        .header-btn.unlocked {
            background: rgba(251, 191, 36, 0.2);
            color: var(--neon-amber);
        }

        .header-btn.unlocked:hover {
            background: rgba(251, 191, 36, 0.3);
        }

        /* Dashboard Grid Container */
        .dashboard-grid-container {
            flex: 1;
            padding: var(--widget-gap);
            overflow-y: auto;
            overflow-x: hidden;
        }

        /* VGL Styles */
        .vue-grid-layout {
            background: transparent;
            min-height: 100%;
        }

        .vue-grid-item {
            background: var(--bg-panel);
            border: 1px solid var(--border-light);
            border-radius: var(--widget-radius);
            overflow: hidden;
            transition: all 0.2s ease;
            transform: translateZ(0);
            will-change: transform;
        }

        .vue-grid-item:hover {
            border-color: var(--border-glow);
        }

        .vue-grid-item.vue-draggable-dragging {
            opacity: 0.8 !important;
            z-index: 1000 !important;
            cursor: grabbing !important;
            box-shadow: 0 8px 32px rgba(251, 191, 36, 0.3),
                        0 0 0 2px var(--neon-amber);
        }

        .vue-grid-item.resizing {
            opacity: 0.7;
            box-shadow: 0 4px 16px rgba(6, 182, 212, 0.3),
                        0 0 0 2px var(--neon-cyan);
        }

        .vue-resizable-handle {
            bottom: 2px !important;
            right: 2px !important;
            background: var(--neon-amber) !important;
            width: 16px !important;
            height: 16px !important;
            border-radius: 3px !important;
            opacity: 0 !important;
            transition: opacity 0.2s;
        }

        .vue-grid-item:hover .vue-resizable-handle {
            opacity: 0.8 !important;
        }

        /* Widget Cards */
        .widget {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            border-bottom: 1px solid var(--border-light);
            background: rgba(0, 0, 0, 0.2);
            cursor: grab;
        }

        .widget-header:active {
            cursor: grabbing;
        }

        .widget-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-accent);
            font-family: 'IBM Plex Mono', monospace;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .widget-title i {
            width: 14px;
            height: 14px;
        }

        .widget-actions {
            display: flex;
            gap: 8px;
        }

        .widget-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .widget-btn:hover {
            background: var(--bg-card);
            color: var(--text-primary);
        }

        .widget-btn i {
            width: 14px;
            height: 14px;
        }

        .widget-body {
            flex: 1;
            padding: 10px;
            overflow: auto;
            display: flex;
            flex-direction: column;
        }

        /* Market Overview Widget */
        .market-regime {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: linear-gradient(135deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.1) 100%);
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .regime-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-positive);
        }

        .regime-icon i {
            width: 28px;
            height: 28px;
        }

        .regime-info {
            flex: 1;
        }

        .regime-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .regime-value {
            font-size: 20px;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
        }

        .regime-stats {
            text-align: right;
        }

        .fear-greed {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .fear-greed-value {
            font-size: 28px;
            font-weight: 800;
            font-family: 'IBM Plex Mono', monospace;
            color: var(--accent-warning);
        }

        .fear-greed-label {
            font-size: 11px;
            color: var(--text-secondary);
            max-width: 60px;
            line-height: 1.3;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 10px;
        }

        .stat-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
        }

        .stat-change {
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        .stat-change.positive { color: var(--accent-positive); }
        .stat-change.negative { color: var(--accent-negative); }

        /* Dominance Bar */
        .dominance-bar {
            height: 24px;
            border-radius: 6px;
            overflow: hidden;
            display: flex;
            margin: 12px 0 6px;
            background: rgba(0, 0, 0, 0.3);
        }

        .dominance-segment {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            color: white;
            transition: width 0.5s ease;
        }

        .dominance-segment.btc {
            background: linear-gradient(180deg, #f7931a 0%, #d97706 100%);
        }

        .dominance-segment.eth {
            background: linear-gradient(180deg, #627eea 0%, #4f5fd9 100%);
        }

        .dominance-segment.stable {
            background: linear-gradient(180deg, #26a17b 0%, #1e8e6a 100%);
        }

        .dominance-segment.alts {
            background: linear-gradient(180deg, #8b5cf6 0%, #7c3aed 100%);
        }

        .dominance-legend {
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            color: var(--text-secondary);
        }

        /* Momentum Cards */
        .momentum-cards-container {
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding: 10px;
        }

        .momentum-card {
            position: relative;
            background: var(--bg-card);
            border-radius: 6px;
            overflow: visible;
            border: 1px solid var(--border-light);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .momentum-card:hover {
            transform: translateY(-2px);
            border-color: rgba(255, 255, 255, 0.12);
        }

        .momentum-card.bullish {
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(16, 185, 129, 0.05) 100%);
        }

        .momentum-card.bearish {
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(239, 68, 68, 0.05) 100%);
        }

        .momentum-card.neutral {
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(156, 163, 175, 0.03) 100%);
        }

        /* Card-level pill pulse animation */
        .card-pulse-ring {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 6px;
            border: 2px solid;
            opacity: 0;
            pointer-events: none;
            will-change: transform, opacity;
        }

        .momentum-card.bullish .card-pulse-ring {
            border-color: #10b981;
            animation: cardPulsePillDesktop var(--pulse-duration, 3s) ease-out infinite;
        }

        .momentum-card.bearish .card-pulse-ring {
            border-color: #ef4444;
            animation: cardPulsePillDesktop var(--pulse-duration, 3s) ease-out infinite;
        }

        .momentum-card.neutral .card-pulse-ring {
            border-color: #6b7280;
            animation: cardPulsePillDesktop var(--pulse-duration, 4.5s) ease-out infinite;
            opacity: 0.15;
        }

        @keyframes cardPulsePillDesktop {
            0% {
                transform: scaleX(1);
                opacity: 0;
            }
            5% {
                opacity: 0.25;
            }
            20% {
                transform: scaleX(1.03);
                opacity: 0.18;
            }
            50% {
                transform: scaleX(1.08);
                opacity: 0.08;
            }
            100% {
                transform: scaleX(1.12);
                opacity: 0;
            }
        }

        .momentum-card.bullish:hover {
            box-shadow: 0 8px 24px -8px rgba(16, 185, 129, 0.3);
        }

        .momentum-card.bearish:hover {
            box-shadow: 0 8px 24px -8px rgba(239, 68, 68, 0.3);
        }

        .momentum-wave-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            opacity: 0.12;
            transition: opacity 0.3s ease;
        }

        .momentum-card:hover .momentum-wave-container {
            opacity: 0.22;
        }

        .momentum-wave-canvas {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .momentum-card-inner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 14px;
            position: relative;
            z-index: 2;
        }

        .momentum-card-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .momentum-symbol-block {
            width: 75px;
            flex-shrink: 0;
        }

        .momentum-symbol {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.02em;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .momentum-rank-badge {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            font-weight: 600;
            padding: 2px 5px;
            border-radius: 3px;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(251, 191, 36, 0.1) 100%);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .momentum-signal-badge {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 9px;
            font-weight: 600;
            padding: 3px 7px;
            border-radius: 4px;
            margin-top: 4px;
            letter-spacing: 0.04em;
        }

        .momentum-signal-badge::before {
            content: '';
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: momentumSignalPulse 1.5s ease-in-out infinite;
        }

        @keyframes momentumSignalPulse {
            0% { opacity: 1; transform: scale3d(1, 1, 1); }
            5% { opacity: 0.97; transform: scale3d(0.985, 0.985, 1); }
            10% { opacity: 0.94; transform: scale3d(0.97, 0.97, 1); }
            15% { opacity: 0.90; transform: scale3d(0.955, 0.955, 1); }
            20% { opacity: 0.86; transform: scale3d(0.94, 0.94, 1); }
            25% { opacity: 0.82; transform: scale3d(0.928, 0.928, 1); }
            30% { opacity: 0.78; transform: scale3d(0.918, 0.918, 1); }
            35% { opacity: 0.75; transform: scale3d(0.91, 0.91, 1); }
            40% { opacity: 0.73; transform: scale3d(0.905, 0.905, 1); }
            45% { opacity: 0.71; transform: scale3d(0.902, 0.902, 1); }
            50% { opacity: 0.70; transform: scale3d(0.90, 0.90, 1); }
            55% { opacity: 0.71; transform: scale3d(0.902, 0.902, 1); }
            60% { opacity: 0.73; transform: scale3d(0.905, 0.905, 1); }
            65% { opacity: 0.75; transform: scale3d(0.91, 0.91, 1); }
            70% { opacity: 0.78; transform: scale3d(0.918, 0.918, 1); }
            75% { opacity: 0.82; transform: scale3d(0.928, 0.928, 1); }
            80% { opacity: 0.86; transform: scale3d(0.94, 0.94, 1); }
            85% { opacity: 0.90; transform: scale3d(0.955, 0.955, 1); }
            90% { opacity: 0.94; transform: scale3d(0.97, 0.97, 1); }
            95% { opacity: 0.97; transform: scale3d(0.985, 0.985, 1); }
            100% { opacity: 1; transform: scale3d(1, 1, 1); }
        }

        .momentum-signal-badge.LONG {
            background: rgba(16, 185, 129, 0.15);
            color: #34d399;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        .momentum-signal-badge.LONG::before { background: #10b981; }

        .momentum-signal-badge.SHORT {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        .momentum-signal-badge.SHORT::before { background: #ef4444; }

        .momentum-signal-badge.NEUTRAL {
            background: rgba(156, 163, 175, 0.12);
            color: #d1d5db;
            border: 1px solid rgba(156, 163, 175, 0.2);
        }
        .momentum-signal-badge.NEUTRAL::before {
            background: #9ca3af;
            animation: none;
        }

        .momentum-metrics {
            display: flex;
            gap: 12px;
        }

        .momentum-metric {
            text-align: left;
        }

        .momentum-metric:first-child {
            width: 68px;
            flex-shrink: 0;
        }

        .momentum-metric:nth-child(2) {
            width: 60px;
            flex-shrink: 0;
        }

        .momentum-metric-label {
            font-size: 9px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.06em;
            margin-bottom: 2px;
        }

        .momentum-metric-value {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .momentum-metric-value.positive { color: #34d399; }
        .momentum-metric-value.negative { color: #f87171; }

        .momentum-trend-arrow {
            display: inline-block;
            margin-left: 2px;
            font-size: 0.7em;
        }

        .momentum-score-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Sparkline - SVG line chart showing score history */
        .momentum-sparkline {
            width: 70px;
            height: 28px;
            opacity: 0.85;
            transition: opacity 0.2s ease;
        }

        .momentum-card:hover .momentum-sparkline {
            opacity: 1;
        }

        .sparkline-path {
            fill: none;
            stroke-width: 1.5;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .momentum-card.bullish .sparkline-path { stroke: #10b981; }
        .momentum-card.bearish .sparkline-path { stroke: #ef4444; }
        .momentum-card.neutral .sparkline-path { stroke: #9ca3af; }

        .momentum-score-circle {
            position: relative;
            width: 44px;
            height: 44px;
            flex-shrink: 0;
        }

        .momentum-score-ring {
            transform: rotate(-90deg);
        }

        .momentum-score-ring-bg {
            fill: none;
            stroke: rgba(255, 255, 255, 0.04);
            stroke-width: 3.5;
        }

        .momentum-score-ring-progress {
            fill: none;
            stroke-width: 3.5;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
        }

        .momentum-card.bullish .momentum-score-ring-progress {
            stroke: url(#momentumBullishGradient);
            filter: drop-shadow(0 0 8px rgba(16, 185, 129, 0.4));
        }

        .momentum-card.bearish .momentum-score-ring-progress {
            stroke: url(#momentumBearishGradient);
            filter: drop-shadow(0 0 8px rgba(239, 68, 68, 0.4));
        }

        .momentum-card.neutral .momentum-score-ring-progress {
            stroke: #9ca3af;
            filter: drop-shadow(0 0 4px rgba(156, 163, 175, 0.3));
        }

        .momentum-score-inner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .momentum-score-value {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
            font-weight: 700;
            line-height: 1;
        }

        .momentum-card.bullish .momentum-score-value { color: #34d399; }
        .momentum-card.bearish .momentum-score-value { color: #f87171; }
        .momentum-card.neutral .momentum-score-value { color: #d1d5db; }

        /* Alpha Pulse expandable card styles */
        .momentum-card {
            cursor: pointer;
            overflow: visible;
        }

        .momentum-card-expand-indicator {
            display: flex;
            justify-content: center;
            padding: 4px 0;
            opacity: 0.4;
            transition: opacity 0.2s;
        }

        .momentum-card:hover .momentum-card-expand-indicator {
            opacity: 0.7;
        }

        .momentum-card-expanded {
            display: none;
            padding: 10px 12px;
            border-top: 1px solid var(--border-light);
            background: rgba(0, 0, 0, 0.15);
        }

        .momentum-card-expanded.visible {
            display: block;
        }

        .momentum-component-bars {
            display: flex;
            gap: 3px;
            margin-top: 6px;
            padding-top: 6px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .momentum-component-bar {
            flex: 1;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 2px;
            height: 20px;
            position: relative;
            overflow: hidden;
        }

        .momentum-component-bar-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            opacity: 0.85;
            transition: height 0.3s ease;
        }

        .momentum-breakdown-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .momentum-breakdown-label {
            font-size: 10px;
            color: var(--text-secondary);
        }

        .momentum-breakdown-bar {
            width: 45px;
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-right: 6px;
        }

        .momentum-breakdown-value {
            font-size: 10px;
            font-weight: 600;
            min-width: 20px;
            text-align: right;
        }

        .momentum-action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin-top: 10px;
        }

        .momentum-action-btn {
            padding: 8px 6px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            transition: all 0.2s;
        }

        .momentum-action-btn.primary {
            background: var(--accent-primary);
            border: none;
            color: var(--bg-primary);
        }

        .momentum-action-btn.secondary {
            background: rgba(255, 191, 0, 0.12);
            border: 1px solid rgba(251, 191, 36, 0.25);
            color: var(--text-primary);
        }

        .momentum-action-btn:hover {
            transform: translateY(-1px);
            filter: brightness(1.1);
        }

        .momentum-pulse-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid;
            opacity: 0;
            will-change: transform, opacity;
        }

        .momentum-card.bullish .momentum-pulse-ring {
            border-color: #10b981;
            animation: momentumPulseGlow var(--pulse-duration, 2.5s) cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }

        .momentum-card.bearish .momentum-pulse-ring {
            border-color: #ef4444;
            animation: momentumPulseGlow var(--pulse-duration, 2.5s) cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }

        .momentum-card.neutral .momentum-pulse-ring {
            border-color: #6b7280;
            animation: momentumPulseGlow var(--pulse-duration, 4s) cubic-bezier(0.4, 0, 0.2, 1) infinite;
            opacity: 0.3;
        }

        @keyframes momentumPulseGlow {
            0% { transform: translate(-50%, -50%) scale3d(1, 1, 1); opacity: 0; }
            2% { transform: translate(-50%, -50%) scale3d(1.005, 1.005, 1); opacity: 0.05; }
            4% { transform: translate(-50%, -50%) scale3d(1.012, 1.012, 1); opacity: 0.12; }
            6% { transform: translate(-50%, -50%) scale3d(1.02, 1.02, 1); opacity: 0.19; }
            8% { transform: translate(-50%, -50%) scale3d(1.03, 1.03, 1); opacity: 0.26; }
            10% { transform: translate(-50%, -50%) scale3d(1.04, 1.04, 1); opacity: 0.32; }
            12% { transform: translate(-50%, -50%) scale3d(1.052, 1.052, 1); opacity: 0.38; }
            15% { transform: translate(-50%, -50%) scale3d(1.07, 1.07, 1); opacity: 0.44; }
            18% { transform: translate(-50%, -50%) scale3d(1.09, 1.09, 1); opacity: 0.48; }
            22% { transform: translate(-50%, -50%) scale3d(1.115, 1.115, 1); opacity: 0.50; }
            26% { transform: translate(-50%, -50%) scale3d(1.14, 1.14, 1); opacity: 0.49; }
            30% { transform: translate(-50%, -50%) scale3d(1.17, 1.17, 1); opacity: 0.47; }
            35% { transform: translate(-50%, -50%) scale3d(1.205, 1.205, 1); opacity: 0.44; }
            40% { transform: translate(-50%, -50%) scale3d(1.24, 1.24, 1); opacity: 0.40; }
            45% { transform: translate(-50%, -50%) scale3d(1.275, 1.275, 1); opacity: 0.36; }
            50% { transform: translate(-50%, -50%) scale3d(1.31, 1.31, 1); opacity: 0.32; }
            55% { transform: translate(-50%, -50%) scale3d(1.345, 1.345, 1); opacity: 0.28; }
            60% { transform: translate(-50%, -50%) scale3d(1.38, 1.38, 1); opacity: 0.24; }
            65% { transform: translate(-50%, -50%) scale3d(1.415, 1.415, 1); opacity: 0.20; }
            70% { transform: translate(-50%, -50%) scale3d(1.45, 1.45, 1); opacity: 0.16; }
            75% { transform: translate(-50%, -50%) scale3d(1.485, 1.485, 1); opacity: 0.12; }
            80% { transform: translate(-50%, -50%) scale3d(1.52, 1.52, 1); opacity: 0.09; }
            85% { transform: translate(-50%, -50%) scale3d(1.55, 1.55, 1); opacity: 0.06; }
            90% { transform: translate(-50%, -50%) scale3d(1.575, 1.575, 1); opacity: 0.03; }
            95% { transform: translate(-50%, -50%) scale3d(1.59, 1.59, 1); opacity: 0.01; }
            100% { transform: translate(-50%, -50%) scale3d(1.6, 1.6, 1); opacity: 0; }
        }

        /* Top Movers - Side by Side Layout */
        .movers-container {
            display: flex;
            flex-direction: row;
            gap: 0;
            height: 100%;
            min-height: 0;
        }

        .movers-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            overflow: hidden;
        }

        .movers-section:first-child {
            border-right: 1px solid var(--border-light);
        }

        .movers-section-header {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--border-light);
        }

        .movers-section-header.gainers {
            background: rgba(0, 214, 143, 0.08);
            color: var(--accent-positive);
        }

        .movers-section-header.losers {
            background: rgba(255, 82, 82, 0.08);
            color: var(--accent-negative);
        }

        .movers-table-wrapper {
            flex: 1;
            overflow-y: auto;
        }

        /* Alert Filter Pills */
        .alert-filter-pills {
            display: flex;
            gap: 6px;
            padding: 0 0 12px 0;
            overflow-x: auto;
            flex-wrap: wrap;
        }

        .alert-filter-pill {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            padding: 5px 10px;
            border-radius: 14px;
            border: 1px solid var(--border-light);
            background: var(--bg-secondary);
            color: var(--text-secondary);
            font-size: 10px;
            font-weight: 500;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .alert-filter-pill i {
            width: 10px;
            height: 10px;
            flex-shrink: 0;
        }

        .alert-filter-pill:hover {
            border-color: var(--neon-amber);
            color: var(--text-primary);
        }

        .alert-filter-pill.active {
            background: rgba(251, 191, 36, 0.15);
            border-color: var(--neon-amber);
            color: var(--neon-amber);
            font-weight: 600;
        }

        /* Alert Cards */
        .alert-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 14px;
            border-radius: 8px;
            margin-bottom: 8px;
            min-height: 48px;
            transition: all 0.2s ease;
        }

        .alert-card:hover {
            transform: translateX(2px);
        }

        .alert-card.whale { background: rgba(59, 130, 246, 0.08); }
        .alert-card.liquidation { background: rgba(239, 68, 68, 0.08); }
        .alert-card.signal { background: rgba(16, 185, 129, 0.08); }
        .alert-card.regime { background: rgba(139, 92, 246, 0.08); }

        .alert-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.05);
        }

        .alert-icon i {
            width: 18px;
            height: 18px;
        }

        .alert-content {
            flex: 1;
            padding: 0 12px;
        }

        .alert-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .alert-subtitle {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .alert-meta {
            text-align: right;
        }

        .alert-value {
            font-size: 14px;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
        }

        .alert-time {
            font-size: 10px;
            color: var(--text-muted);
        }

        /* Signal Cards */
        .signal-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            border-radius: 6px;
            margin-bottom: 6px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-light);
            transition: all 0.2s ease;
        }

        .signal-card:hover {
            border-color: rgba(255, 255, 255, 0.12);
            transform: translateY(-1px);
        }

        .signal-card.long {
            background: linear-gradient(90deg, rgba(16, 185, 129, 0.08) 0%, rgba(0, 0, 0, 0.2) 100%);
        }

        .signal-card.short {
            background: linear-gradient(90deg, rgba(239, 68, 68, 0.08) 0%, rgba(0, 0, 0, 0.2) 100%);
        }

        .signal-direction-badge {
            font-size: 10px;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'IBM Plex Mono', monospace;
        }

        .signal-direction-badge.long {
            background: rgba(16, 185, 129, 0.2);
            color: #34d399;
        }

        .signal-direction-badge.short {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }

        .signal-score {
            font-size: 16px;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
        }

        /* Symbol Table */
        .symbol-table {
            width: 100%;
            border-collapse: collapse;
        }

        .symbol-table th {
            text-align: left;
            padding: 3px 6px;
            font-size: 9px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            border-bottom: 1px solid var(--border-light);
            position: sticky;
            top: 0;
            background: var(--bg-panel);
        }

        .symbol-table td {
            padding: 4px 6px;
            font-size: 11px;
            border-bottom: 1px solid rgba(255,255,255,0.03);
        }

        .symbol-table tbody tr:hover {
            background: rgba(251, 191, 36, 0.06);
            cursor: pointer;
        }

        .symbol-name {
            font-weight: 600;
            font-family: 'IBM Plex Mono', monospace;
        }

        .symbol-price {
            font-family: 'IBM Plex Mono', monospace;
            text-align: right;
        }

        .symbol-change {
            font-weight: 600;
            font-family: 'IBM Plex Mono', monospace;
            text-align: right;
        }

        .symbol-change.positive { color: var(--accent-positive); }
        .symbol-change.negative { color: var(--accent-negative); }

        /* Chart Container */
        .chart-container {
            width: 100%;
            flex: 1;
            min-height: 200px;
        }

        /* Beta Chart Layout */
        .beta-chart-wrapper {
            display: flex;
            flex-direction: row;
            gap: 8px;
        }

        .beta-chart-wrapper .chart-container {
            flex: 1;
            min-width: 0;
        }

        .beta-legend-container {
            width: 120px;
            flex-shrink: 0;
            overflow-y: auto;
            max-height: 100%;
        }

        .beta-legend {
            display: flex;
            flex-direction: column;
            gap: 2px;
            font-size: 10px;
            font-family: var(--font-mono);
        }

        .beta-legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 2px 4px;
            background: rgba(26, 26, 26, 0.6);
            border-radius: 3px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .beta-legend-item:hover {
            background: rgba(40, 40, 40, 0.8);
        }

        .legend-color {
            width: 8px;
            height: 8px;
            border-radius: 2px;
            flex-shrink: 0;
        }

        .legend-symbol {
            flex: 1;
            color: var(--text-secondary);
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .legend-change {
            font-weight: 600;
            white-space: nowrap;
        }

        .legend-change.positive {
            color: var(--accent-positive);
        }

        .legend-change.negative {
            color: var(--accent-negative);
        }

        /* Beta Symbol Styling */
        .beta-symbol {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, var(--neon-amber) 0%, #f59e0b 100%);
            color: var(--bg-primary);
            border-radius: 4px;
            font-weight: 800;
            font-size: 14px;
            font-family: 'Times New Roman', serif;
            font-style: italic;
        }

        /* Count Badge */
        .count-badge {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-positive);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 9px;
            margin-left: 4px;
        }

        .count-badge.alert {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-negative);
        }

        /* CEX Badge */
        .cex-badge {
            background: rgba(255, 165, 0, 0.2);
            color: #ffa500;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 9px;
        }

        /* Timeframe Select */
        .timeframe-select {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: 4px;
            padding: 4px 8px;
            color: var(--text-primary);
            font-size: 11px;
            cursor: pointer;
        }

        .timeframe-select:focus {
            outline: none;
            border-color: var(--neon-amber);
        }

        .confluence-sort {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: 4px;
            padding: 4px 8px;
            color: var(--text-primary);
            font-size: 11px;
        }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 32px;
            color: var(--text-muted);
            text-align: center;
        }

        .empty-state i {
            width: 48px;
            height: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-light);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Loading state */
        .widget.loading {
            position: relative;
            pointer-events: none;
        }

        .widget.loading::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 10, 0.8);
            z-index: 10;
            border-radius: var(--widget-radius);
        }

        .widget.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 32px;
            height: 32px;
            margin: -16px 0 0 -16px;
            border: 2px solid var(--border-light);
            border-top-color: var(--neon-amber);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            z-index: 11;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Confluence badges */
        .confluence-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 32px;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
        }

        .confluence-badge.bullish {
            background: rgba(0, 214, 143, 0.25);
            color: #14f195;
            border: 1px solid rgba(0, 214, 143, 0.4);
        }

        .confluence-badge.bearish {
            background: rgba(255, 82, 82, 0.25);
            color: #ff6b6b;
            border: 1px solid rgba(255, 82, 82, 0.4);
        }

        .confluence-badge.neutral {
            background: rgba(156, 163, 175, 0.2);
            color: var(--text-secondary);
            border: 1px solid rgba(156, 163, 175, 0.3);
        }

        /* SVG Gradients */
        .momentum-svg-defs {
            position: absolute;
            width: 0;
            height: 0;
            overflow: hidden;
        }

        /* ===== PRICE TICKER BAR ===== */
        .price-ticker {
            background: linear-gradient(90deg, var(--bg-secondary) 0%, var(--bg-panel) 50%, var(--bg-secondary) 100%);
            border-bottom: 1px solid var(--border-light);
            overflow: hidden;
            white-space: nowrap;
            height: 26px;
            display: flex;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .ticker-track {
            display: flex;
            animation: ticker-scroll 30s linear infinite;
            will-change: transform;
        }

        .ticker-track:hover {
            animation-play-state: paused;
        }

        @keyframes ticker-scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .ticker-item {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 0 12px;
            font-size: 11px;
            font-family: 'IBM Plex Mono', monospace;
        }

        .ticker-symbol {
            color: var(--text-primary);
            font-weight: 600;
        }

        .ticker-price {
            color: var(--text-secondary);
        }

        .ticker-change {
            font-weight: 600;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .ticker-change.positive {
            color: var(--accent-positive);
            background: rgba(0, 214, 143, 0.15);
        }

        .ticker-change.negative {
            color: var(--accent-negative);
            background: rgba(255, 82, 82, 0.15);
        }

        .ticker-separator {
            color: var(--border-light);
            font-size: 8px;
        }

        /* ===== NEWS TICKER BAR ===== */
        .news-ticker {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-light);
            overflow: hidden;
            white-space: nowrap;
            height: 24px;
            display: flex;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .news-ticker-label {
            background: var(--neon-amber);
            color: var(--bg-primary);
            font-size: 9px;
            font-weight: 700;
            padding: 3px 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            flex-shrink: 0;
            position: relative;
            z-index: 3;
        }

        .news-track {
            display: flex;
            animation: news-scroll 30s linear infinite;
            will-change: transform;
            position: relative;
            z-index: 1;
        }

        .news-track:hover {
            animation-play-state: paused;
        }

        @keyframes news-scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .news-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 0 24px;
            font-size: 12px;
            cursor: pointer;
            transition: color 0.2s;
        }

        .news-item:hover {
            color: var(--neon-amber);
        }

        .news-item a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.2s;
        }

        .news-item a:hover {
            color: var(--neon-amber);
        }

        .news-source {
            color: var(--text-secondary);
            font-size: 10px;
            opacity: 0.7;
        }

        .news-separator {
            color: var(--border-light);
            font-size: 6px;
        }

        /* Fullscreen Overlay */
        .fullscreen-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100vw;
            height: 100vh;
            background: #050505;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .fullscreen-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 24px;
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-light);
        }

        .fullscreen-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .fullscreen-title .beta-symbol {
            color: var(--neon-amber);
            font-size: 1.4rem;
        }

        .fullscreen-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .fullscreen-close {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-light);
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .fullscreen-close:hover {
            background: rgba(251, 191, 36, 0.1);
            border-color: var(--neon-amber);
            color: var(--neon-amber);
        }

        .fullscreen-body {
            flex: 1;
            display: flex;
            padding: 16px;
            gap: 16px;
            overflow: hidden;
            background: #050505;
            min-height: 0;
        }

        .fullscreen-chart {
            flex: 1;
            background: #111111;
            border-radius: 8px;
            border: 1px solid #222;
            overflow: hidden;
            min-height: 400px;
            position: relative;
        }

        .fullscreen-legend {
            width: 180px;
            background: var(--card-bg);
            border-radius: 8px;
            border: 1px solid var(--border-light);
            overflow-y: auto;
            padding: 12px;
        }

        .fullscreen-legend-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--neon-amber);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-light);
        }

        /* Analytics Section Styles */
        .analytics-container {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            background: var(--bg-primary);
        }

        .analytics-header {
            margin-bottom: 24px;
        }

        .analytics-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
            letter-spacing: -0.5px;
            margin-bottom: 8px;
        }

        .analytics-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        @media (max-width: 1400px) {
            .analytics-grid {
                grid-template-columns: 1fr;
            }
        }

        .analytics-panel {
            background: var(--bg-panel);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .analytics-panel:hover {
            border-color: var(--border-glow);
            box-shadow: 0 4px 24px rgba(251, 191, 36, 0.1);
        }

        .analytics-panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-light);
        }

        .analytics-panel-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-accent);
            font-family: 'IBM Plex Mono', monospace;
        }

        .analytics-panel-title i {
            width: 20px;
            height: 20px;
        }

        .analytics-panel-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .analytics-panel-badge.beta {
            background: rgba(251, 191, 36, 0.2);
            color: var(--neon-amber);
        }

        .analytics-panel-body {
            min-height: 200px;
        }

        /* Regime Analytics Styles */
        .regime-distribution {
            margin-bottom: 20px;
        }

        .regime-pie-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto 16px;
        }

        .regime-pie {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .regime-center-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .regime-center-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
        }

        .regime-center-text {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .regime-legend {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .regime-legend-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .regime-legend-item:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .regime-legend-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .regime-legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .regime-legend-name {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .regime-legend-value {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
        }

        .trading-bias-card {
            padding: 16px;
            border-radius: 8px;
            border: 2px solid;
            text-align: center;
            margin-bottom: 16px;
        }

        .trading-bias-card.BULLISH {
            border-color: var(--accent-positive);
            background: rgba(0, 214, 143, 0.1);
        }

        .trading-bias-card.BEARISH {
            border-color: var(--accent-negative);
            background: rgba(255, 82, 82, 0.1);
        }

        .trading-bias-card.NEUTRAL {
            border-color: var(--accent-warning);
            background: rgba(255, 184, 0, 0.1);
        }

        .trading-bias-card.CAUTION {
            border-color: #a855f7;
            background: rgba(168, 85, 247, 0.1);
        }

        .trading-bias-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .trading-bias-value {
            font-size: 24px;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
        }

        .trading-bias-card.BULLISH .trading-bias-value {
            color: var(--accent-positive);
        }

        .trading-bias-card.BEARISH .trading-bias-value {
            color: var(--accent-negative);
        }

        .trading-bias-card.NEUTRAL .trading-bias-value {
            color: var(--accent-warning);
        }

        .trading-bias-card.CAUTION .trading-bias-value {
            color: #a855f7;
        }

        .regime-timeline {
            max-height: 300px;
            overflow-y: auto;
        }

        .regime-timeline-item {
            display: flex;
            gap: 12px;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.02);
            border-left: 3px solid;
        }

        .regime-timeline-time {
            font-size: 11px;
            color: var(--text-muted);
            font-family: 'IBM Plex Mono', monospace;
            min-width: 60px;
        }

        .regime-timeline-change {
            flex: 1;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .regime-timeline-arrow {
            color: var(--neon-amber);
            font-weight: 700;
        }

        /* Signal Performance Styles */
        .signal-metric-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .signal-metric-card {
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            border: 1px solid var(--border-light);
        }

        .signal-metric-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .signal-metric-value {
            font-size: 28px;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
            color: var(--text-primary);
        }

        .signal-metric-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .signal-chart-container {
            margin-bottom: 20px;
        }

        .signal-chart-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .signal-bar-chart {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .signal-bar-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .signal-bar-label {
            min-width: 80px;
            font-size: 12px;
            color: var(--text-secondary);
            font-family: 'IBM Plex Mono', monospace;
        }

        .signal-bar-track {
            flex: 1;
            height: 24px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .signal-bar-fill {
            height: 100%;
            transition: width 0.5s ease;
            position: relative;
        }

        .signal-bar-value {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
        }

        .component-analysis {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .component-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 6px;
        }

        .component-name {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: capitalize;
        }

        .component-score {
            font-size: 14px;
            font-weight: 600;
            font-family: 'IBM Plex Mono', monospace;
        }

        /* Liquidation & Risk Styles */
        .stress-gauge-container {
            position: relative;
            width: 180px;
            height: 180px;
            margin: 0 auto 24px;
        }

        .stress-gauge {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .stress-gauge-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .stress-gauge-value {
            font-size: 32px;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
            color: var(--text-primary);
        }

        .stress-gauge-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        .stress-gauge-status {
            font-size: 14px;
            font-weight: 600;
            margin-top: 2px;
        }

        .stress-factors {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .stress-factor-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stress-factor-name {
            min-width: 90px;
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: capitalize;
        }

        .stress-factor-bar {
            flex: 1;
            height: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .stress-factor-fill {
            height: 100%;
            transition: width 0.5s ease;
        }

        .stress-factor-value {
            position: absolute;
            right: 6px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
        }

        .risk-alerts {
            background: rgba(255, 82, 82, 0.1);
            border: 1px solid var(--accent-negative);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
        }

        .risk-alert-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            font-weight: 600;
            color: var(--accent-negative);
            margin-bottom: 8px;
        }

        .risk-alert-item {
            font-size: 11px;
            color: var(--text-secondary);
            padding: 4px 0;
            padding-left: 24px;
        }

        .liquidation-summary {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .liquidation-stat {
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 6px;
            border: 1px solid var(--border-light);
        }

        .liquidation-stat-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .liquidation-stat-value {
            font-size: 20px;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
            color: var(--text-primary);
        }

        /* Loading States */
        .analytics-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            color: var(--text-muted);
            font-size: 14px;
        }

        .analytics-error {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            color: var(--accent-negative);
            font-size: 14px;
        }

        /* Correlation Matrix Styles */
        .correlation-panel {
            min-height: 700px;
        }

        .correlation-timeframe-selector {
            display: flex;
            gap: 4px;
            background: rgba(255, 255, 255, 0.03);
            padding: 2px;
            border-radius: 6px;
        }

        .correlation-tf-btn {
            padding: 4px 12px;
            font-size: 11px;
            font-weight: 600;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'IBM Plex Mono', monospace;
        }

        .correlation-tf-btn:hover {
            background: rgba(251, 191, 36, 0.1);
            color: var(--text-primary);
        }

        .correlation-tf-btn.active {
            background: var(--neon-amber);
            color: #0a0a0a;
        }

        .correlation-content {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .correlation-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .correlation-metric-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 16px;
            transition: all 0.3s ease;
        }

        .correlation-metric-card:hover {
            border-color: var(--border-glow);
            background: rgba(255, 255, 255, 0.04);
        }

        .correlation-metric-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .correlation-metric-value {
            font-size: 32px;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
            line-height: 1;
            margin-bottom: 6px;
        }

        .correlation-metric-unit {
            font-size: 16px;
            color: var(--text-muted);
            font-weight: 400;
        }

        .correlation-metric-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .correlation-main-grid {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 20px;
        }

        .correlation-heatmap-container {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 16px;
            min-height: 800px;
        }

        .correlation-insights {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .correlation-insight-section {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 16px;
        }

        .correlation-insight-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .correlation-pair-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .correlation-pair-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
        }

        .correlation-pair-item.strong {
            border-left-color: #ef4444;
        }

        .correlation-pair-item.weak {
            border-left-color: #10b981;
        }

        .correlation-pair-item:hover {
            background: rgba(255, 255, 255, 0.06);
        }

        .correlation-pair-symbols {
            font-size: 12px;
            font-weight: 500;
            font-family: 'IBM Plex Mono', monospace;
            color: var(--text-primary);
        }

        .correlation-pair-value {
            font-size: 14px;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
        }

        .correlation-warning {
            display: flex;
            gap: 12px;
            padding: 14px;
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 8px;
            color: var(--neon-amber);
        }

        .correlation-warning strong {
            display: block;
            font-size: 13px;
            margin-bottom: 4px;
        }

        .correlation-warning p {
            font-size: 11px;
            color: var(--text-secondary);
            margin: 0;
            line-height: 1.4;
        }

        .correlation-legend {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 16px;
        }

        .correlation-legend-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .correlation-legend-gradient {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .correlation-legend-labels {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            font-weight: 600;
            font-family: 'IBM Plex Mono', monospace;
            color: var(--text-primary);
        }

        .correlation-legend-bar {
            height: 12px;
            border-radius: 6px;
            background: linear-gradient(to right,
                #3b82f6 0%,
                #6b7280 50%,
                #ef4444 100%
            );
        }

        .correlation-legend-descriptions {
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .correlation-main-grid {
                grid-template-columns: 1fr;
            }

            .correlation-metrics {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .correlation-metrics {
                grid-template-columns: 1fr;
            }

            .correlation-timeframe-selector {
                flex-wrap: wrap;
            }
        }

        /* Layout Settings Modal */
        .layout-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .layout-modal {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .layout-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid #333;
        }

        .layout-modal-header h3 {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 18px;
            font-weight: 600;
            color: #fbbf24;
            margin: 0;
        }

        .layout-modal-close {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
        }

        .layout-modal-close:hover {
            color: #fbbf24;
        }

        .layout-modal-body {
            padding: 24px;
            overflow-y: auto;
        }

        .layout-info {
            margin-bottom: 20px;
        }

        .layout-info p {
            color: #9ca3af;
            font-size: 14px;
            margin: 0;
        }

        .layout-table {
            margin-bottom: 24px;
            overflow-x: auto;
        }

        .layout-table table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
        }

        .layout-table th {
            background: #111111;
            color: #fbbf24;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #333;
        }

        .layout-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #222;
            color: #e5e7eb;
        }

        .layout-table tr:hover td {
            background: rgba(251, 191, 36, 0.05);
        }

        .layout-table .widget-name {
            font-weight: 500;
            color: #fbbf24;
        }

        .layout-code {
            background: #111111;
            border: 1px solid #333;
            border-radius: 8px;
            overflow: hidden;
        }

        .layout-code-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: #0a0a0a;
            border-bottom: 1px solid #333;
        }

        .layout-code-header span {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            color: #9ca3af;
            font-weight: 500;
        }

        .layout-copy-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.2);
            border-radius: 6px;
            color: #fbbf24;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .layout-copy-btn:hover {
            background: rgba(251, 191, 36, 0.15);
            border-color: rgba(251, 191, 36, 0.3);
        }

        .layout-code pre {
            padding: 16px;
            margin: 0;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            line-height: 1.6;
            color: #e5e7eb;
            overflow-x: auto;
            white-space: pre;
        }

        /* Position Calculator Styles */
        .calculator-container {
            flex: 1;
            overflow-y: auto;
            padding: 32px;
            background: var(--bg-primary);
        }

        .calculator-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 40px;
            gap: 20px;
        }

        .calculator-title-wrapper {
            flex: 1;
        }

        .calculator-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        .calculator-subtitle {
            font-size: 15px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Mode Toggle */
        .calculator-mode-toggle {
            display: flex;
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 4px;
            gap: 4px;
        }

        .calc-mode-btn {
            padding: 10px 20px;
            background: transparent;
            border: none;
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .calc-mode-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .calc-mode-btn.active {
            background: var(--neon-amber);
            color: #0a0a0a;
            box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);
        }

        .calc-mode-btn i {
            width: 14px;
            height: 14px;
        }

        .calculator-grid {
            display: grid;
            gap: 28px;
            max-width: 1200px;
        }

        .calc-section {
            background: var(--bg-panel);
            border: 1px solid var(--border-light);
            border-radius: var(--widget-radius);
            padding: 28px;
        }

        .calc-section-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-accent);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .calc-section-title i {
            width: 18px;
            height: 18px;
        }

        .calc-field-group {
            margin-bottom: 20px;
        }

        .calc-field-group:last-child {
            margin-bottom: 0;
        }

        .calc-label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .calc-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 15px;
            font-family: 'IBM Plex Mono', monospace;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .calc-input:focus {
            outline: none;
            border-color: var(--neon-amber);
            box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.1), 0 4px 12px rgba(251, 191, 36, 0.15);
            transform: translateY(-1px);
        }

        .calc-input:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Quick Presets */
        .calc-presets {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .calc-preset-btn {
            flex: 1;
            min-width: 140px;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s;
            text-align: left;
        }

        .calc-preset-btn:hover {
            border-color: var(--neon-amber);
            background: rgba(251, 191, 36, 0.05);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .calc-preset-btn .preset-name {
            display: block;
            font-size: 13px;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .calc-preset-btn .preset-desc {
            display: block;
            font-size: 11px;
            color: var(--text-muted);
        }

        .calc-direction-toggle {
            display: flex;
            gap: 8px;
        }

        .calc-direction-btn {
            flex: 1;
            padding: 14px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .calc-direction-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(255, 255, 255, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.25s;
        }

        .calc-direction-btn:hover::before {
            opacity: 1;
        }

        .calc-direction-btn:hover {
            border-color: var(--neon-amber);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .calc-direction-btn.active.long {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.1) 100%);
            border-color: var(--accent-positive);
            color: var(--accent-positive);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .calc-direction-btn.active.short {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.1) 100%);
            border-color: var(--accent-negative);
            color: var(--accent-negative);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        /* Enhanced Leverage Slider */
        .calc-slider-container {
            margin-top: 16px;
            position: relative;
        }

        .calc-slider-track {
            width: 100%;
            height: 8px;
            background: linear-gradient(to right,
                #10b981 0%,
                #10b981 4%,
                #fbbf24 4%,
                #fbbf24 16%,
                #f97316 16%,
                #f97316 40%,
                #ef4444 40%,
                #ef4444 100%);
            border-radius: 4px;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .calc-slider-markers {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            padding: 0 4px;
        }

        .calc-slider-marker {
            font-size: 10px;
            color: var(--text-muted);
            font-weight: 600;
        }

        .calc-slider {
            width: 100%;
            height: 8px;
            background: transparent;
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
            position: absolute;
            top: 0;
            left: 0;
            cursor: pointer;
        }

        .calc-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: var(--neon-amber);
            border-radius: 50%;
            cursor: grab;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4), 0 0 0 3px rgba(251, 191, 36, 0.3);
            transition: all 0.2s;
            border: 3px solid var(--bg-panel);
        }

        .calc-slider::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5), 0 0 0 4px rgba(251, 191, 36, 0.4);
        }

        .calc-slider::-webkit-slider-thumb:active {
            cursor: grabbing;
            transform: scale(1.05);
        }

        .calc-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: var(--neon-amber);
            border-radius: 50%;
            cursor: grab;
            border: 3px solid var(--bg-panel);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4), 0 0 0 3px rgba(251, 191, 36, 0.3);
            transition: all 0.2s;
        }

        .calc-slider::-moz-range-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5), 0 0 0 4px rgba(251, 191, 36, 0.4);
        }

        .calc-slider::-moz-range-thumb:active {
            cursor: grabbing;
            transform: scale(1.05);
        }

        .calc-slider-value {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 16px;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 6px;
            border: 1px solid var(--border-light);
        }

        .calc-slider-current {
            font-weight: 700;
            font-size: 20px;
            color: var(--text-accent);
            font-family: 'IBM Plex Mono', monospace;
        }

        .calc-leverage-risk {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .calc-leverage-risk.low {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-positive);
        }

        .calc-leverage-risk.medium {
            background: rgba(251, 191, 36, 0.2);
            color: var(--accent-warning);
        }

        .calc-leverage-risk.high {
            background: rgba(249, 115, 22, 0.2);
            color: #f97316;
        }

        .calc-leverage-risk.extreme {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-negative);
            animation: pulse-danger 2s infinite;
        }

        @keyframes pulse-danger {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Risk Gauge */
        .calc-risk-gauge {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 24px 0;
        }

        .calc-gauge-container {
            position: relative;
            width: 180px;
            height: 180px;
        }

        .calc-gauge-svg {
            transform: rotate(-90deg);
        }

        .calc-gauge-bg {
            fill: none;
            stroke: var(--bg-secondary);
            stroke-width: 12;
        }

        .calc-gauge-fill {
            fill: none;
            stroke-width: 12;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s cubic-bezier(0.4, 0, 0.2, 1), stroke 0.5s;
        }

        .calc-gauge-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .calc-gauge-value {
            font-size: 36px;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
            line-height: 1;
            margin-bottom: 4px;
        }

        .calc-gauge-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        /* Price Ladder */
        .calc-price-ladder {
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 20px;
            margin: 24px 0;
        }

        .calc-ladder-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
        }

        .calc-ladder-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: 6px;
            border: 1px solid var(--border-light);
            background: var(--bg-panel);
            transition: all 0.25s;
        }

        .calc-ladder-item:last-child {
            margin-bottom: 0;
        }

        .calc-ladder-item.take-profit {
            border-color: var(--accent-positive);
            background: rgba(16, 185, 129, 0.05);
        }

        .calc-ladder-item.entry {
            border-color: var(--neon-amber);
            background: rgba(251, 191, 36, 0.05);
            border-width: 2px;
            transform: scale(1.02);
        }

        .calc-ladder-item.stop-loss {
            border-color: var(--accent-negative);
            background: rgba(239, 68, 68, 0.05);
        }

        .calc-ladder-item.liquidation {
            border-color: #7c3aed;
            background: rgba(124, 58, 237, 0.05);
        }

        .calc-ladder-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .calc-ladder-item.take-profit .calc-ladder-icon {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-positive);
        }

        .calc-ladder-item.entry .calc-ladder-icon {
            background: rgba(251, 191, 36, 0.2);
            color: var(--neon-amber);
        }

        .calc-ladder-item.stop-loss .calc-ladder-icon {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-negative);
        }

        .calc-ladder-item.liquidation .calc-ladder-icon {
            background: rgba(124, 58, 237, 0.2);
            color: #7c3aed;
        }

        .calc-ladder-content {
            flex: 1;
        }

        .calc-ladder-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-muted);
            margin-bottom: 2px;
        }

        .calc-ladder-price {
            font-size: 18px;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
            color: var(--text-primary);
        }

        .calc-ladder-distance {
            font-size: 11px;
            color: var(--text-muted);
            font-family: 'IBM Plex Mono', monospace;
            text-align: right;
        }

        /* Results Grid - Enhanced */
        .calc-results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .calc-result-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 16px;
            transition: all 0.25s;
            position: relative;
            overflow: hidden;
        }

        .calc-result-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--border-light);
            transition: all 0.25s;
        }

        .calc-result-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            border-color: var(--neon-amber);
        }

        .calc-result-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .calc-result-value {
            font-size: 20px;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
            color: var(--text-primary);
            transition: all 0.3s;
        }

        .calc-result-value.positive {
            color: var(--accent-positive);
        }

        .calc-result-value.negative {
            color: var(--accent-negative);
        }

        .calc-result-value.warning {
            color: var(--accent-warning);
        }

        .calc-result-item.highlight {
            border-color: var(--neon-amber);
            background: rgba(251, 191, 36, 0.05);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.2);
        }

        .calc-result-item.highlight::before {
            background: var(--neon-amber);
        }

        .calc-result-item.highlight .calc-result-label {
            color: var(--text-accent);
        }

        .calc-result-item.highlight .calc-result-value {
            font-size: 24px;
        }

        /* Simple Mode Results */
        .calc-simple-results {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 20px;
        }

        .calc-simple-result-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border-light);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .calc-simple-result-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4);
        }

        .calc-simple-result-card.primary {
            border-color: var(--neon-amber);
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.08) 0%, rgba(251, 191, 36, 0.02) 100%);
            box-shadow: 0 0 24px rgba(251, 191, 36, 0.2);
        }

        .calc-simple-result-card.risk {
            border-color: rgba(239, 68, 68, 0.3);
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, transparent 100%);
        }

        .calc-simple-result-card.reward {
            border-color: rgba(34, 197, 94, 0.3);
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.05) 0%, transparent 100%);
        }

        .calc-simple-result-card.ratio {
            border-color: rgba(59, 130, 246, 0.3);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, transparent 100%);
        }

        .calc-simple-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            margin-bottom: 12px;
        }

        .calc-simple-value {
            font-size: 36px;
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
            color: var(--text-primary);
            margin-bottom: 8px;
            line-height: 1.2;
        }

        .calc-simple-result-card.primary .calc-simple-value {
            color: var(--neon-amber);
        }

        .calc-simple-value.positive {
            color: var(--accent-positive);
        }

        .calc-simple-value.negative {
            color: var(--accent-negative);
        }

        .calc-simple-value.warning {
            color: var(--accent-warning);
        }

        .calc-simple-subvalue {
            font-size: 13px;
            color: var(--text-secondary);
            font-family: 'IBM Plex Mono', monospace;
        }

        .calc-simple-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .calc-simple-status.good {
            background: rgba(34, 197, 94, 0.2);
            color: var(--accent-positive);
        }

        .calc-simple-status.poor {
            background: rgba(251, 191, 36, 0.2);
            color: var(--accent-warning);
        }

        @media (max-width: 768px) {
            .calc-simple-results {
                grid-template-columns: 1fr;
            }

            .calc-simple-value {
                font-size: 28px;
            }
        }

        /* Liquidation Warning */
        .calc-liquidation-warning {
            padding: 16px;
            border-radius: 8px;
            border: 1px solid var(--accent-negative);
            background: rgba(239, 68, 68, 0.1);
            margin-top: 24px;
            display: flex;
            align-items: start;
            gap: 12px;
            animation: pulse-warning 2s infinite;
        }

        @keyframes pulse-warning {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 rgba(239, 68, 68, 0.5); }
            50% { opacity: 0.9; box-shadow: 0 0 20px rgba(239, 68, 68, 0.5); }
        }

        .calc-liquidation-warning i {
            color: var(--accent-negative);
            flex-shrink: 0;
        }

        .calc-liquidation-warning-content {
            flex: 1;
        }

        .calc-liquidation-warning-title {
            font-size: 13px;
            font-weight: 700;
            color: var(--accent-negative);
            margin-bottom: 4px;
        }

        .calc-liquidation-warning-text {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Risk/Reward Visual Bar */
        .calc-rr-visual {
            margin-top: 24px;
        }

        .calc-rr-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .calc-rr-bars {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
        }

        .calc-rr-bar-container {
            flex: 1;
        }

        .calc-rr-bar-label {
            font-size: 11px;
            color: var(--text-muted);
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .calc-rr-bar-value {
            font-family: 'IBM Plex Mono', monospace;
            font-weight: 600;
        }

        .calc-rr-bar {
            height: 32px;
            border-radius: 6px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            position: relative;
            overflow: hidden;
        }

        .calc-rr-bar-fill {
            height: 100%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .calc-rr-bar-fill.risk {
            background: linear-gradient(90deg, rgba(239, 68, 68, 0.8) 0%, rgba(239, 68, 68, 1) 100%);
        }

        .calc-rr-bar-fill.reward {
            background: linear-gradient(90deg, rgba(16, 185, 129, 0.8) 0%, rgba(16, 185, 129, 1) 100%);
        }

        /* ===================================
           ANIMATED L/S RATIO GLOW EFFECT
           =================================== */

        .ls-ratio-container {
            background: rgba(0, 0, 0, 0.2);
            padding: 6px;
            border-radius: 6px;
            text-align: center;
        }

        .ls-ratio-header {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .ls-ratio-percentages {
            display: flex;
            justify-content: center;
            gap: 3px;
            align-items: baseline;
            margin: 4px 0;
        }

        .ls-ratio-percentages .long-pct {
            font-size: 13px;
            font-weight: 700;
            color: var(--accent-positive);
        }

        .ls-ratio-percentages .divider {
            color: var(--text-secondary);
            font-size: 11px;
        }

        .ls-ratio-percentages .short-pct {
            font-size: 13px;
            font-weight: 700;
            color: var(--accent-negative);
        }

        .ls-ratio-bar-container {
            position: relative;
            height: 14px;
            margin: 4px 0 4px;
            border-radius: 4px;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.3);
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        .ls-ratio-bar {
            position: absolute;
            height: 100%;
            display: flex;
            width: 100%;
        }

        .ls-ratio-bar .long-side,
        .ls-ratio-bar .short-side {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: filter, background;
        }

        .ls-ratio-bar .long-side {
            background: var(--accent-positive);
        }

        .ls-ratio-bar .short-side {
            background: var(--accent-negative);
            flex: 1;
        }

        .side-label {
            font-size: 8px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.9);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }

        .ls-ratio-label {
            font-size: 9px;
            color: var(--text-secondary);
        }

        .ls-ratio-label.extreme-warning {
            color: var(--accent-positive);
            font-weight: 600;
        }

        .ls-ratio-label.extreme-warning.short {
            color: var(--accent-negative);
        }

        @keyframes glow-pulse {
            0%, 100% {
                filter: drop-shadow(0 0 var(--glow-size-min) var(--glow-color))
                        drop-shadow(0 0 calc(var(--glow-size-min) * 1.5) var(--glow-color-fade));
            }
            50% {
                filter: drop-shadow(0 0 var(--glow-size-max) var(--glow-color-bright))
                        drop-shadow(0 0 calc(var(--glow-size-max) * 1.5) var(--glow-color))
                        drop-shadow(0 0 calc(var(--glow-size-max) * 2.5) var(--glow-color-fade));
            }
        }

        @keyframes shimmer {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        .ls-ratio-container.moderate-long .long-side {
            --glow-color: rgba(0, 214, 143, 0.5);
            --glow-color-fade: rgba(0, 214, 143, 0.3);
            filter: drop-shadow(0 0 12px var(--glow-color))
                    drop-shadow(0 0 20px var(--glow-color-fade))
                    drop-shadow(0 0 30px rgba(0, 214, 143, 0.15));
        }

        .ls-ratio-container.moderate-short .short-side {
            --glow-color: rgba(255, 82, 82, 0.5);
            --glow-color-fade: rgba(255, 82, 82, 0.3);
            filter: drop-shadow(0 0 12px var(--glow-color))
                    drop-shadow(0 0 20px var(--glow-color-fade))
                    drop-shadow(0 0 30px rgba(255, 82, 82, 0.15));
        }

        .ls-ratio-container.high-long .long-side {
            --glow-size-min: 20px;
            --glow-size-max: 45px;
            --glow-color: rgba(0, 214, 143, 0.7);
            --glow-color-bright: rgba(0, 255, 170, 0.95);
            --glow-color-fade: rgba(0, 214, 143, 0.4);
            background: linear-gradient(110deg,
                var(--accent-positive) 0%,
                rgba(0, 255, 170, 0.9) 40%,
                var(--accent-positive) 50%,
                rgba(0, 255, 170, 0.85) 60%,
                var(--accent-positive) 100%);
            background-size: 200% 100%;
            animation: glow-pulse 2s ease-in-out infinite,
                       shimmer 3s linear infinite;
        }

        .ls-ratio-container.high-short .short-side {
            --glow-size-min: 20px;
            --glow-size-max: 45px;
            --glow-color: rgba(255, 82, 82, 0.7);
            --glow-color-bright: rgba(255, 120, 120, 0.95);
            --glow-color-fade: rgba(255, 82, 82, 0.4);
            background: linear-gradient(110deg,
                var(--accent-negative) 0%,
                rgba(255, 120, 120, 0.9) 40%,
                var(--accent-negative) 50%,
                rgba(255, 120, 120, 0.85) 60%,
                var(--accent-negative) 100%);
            background-size: 200% 100%;
            animation: glow-pulse 2s ease-in-out infinite,
                       shimmer 3s linear infinite;
        }

        .ls-ratio-container.extreme-long .long-side {
            --glow-size-min: 35px;
            --glow-size-max: 80px;
            --glow-color: rgba(0, 214, 143, 0.85);
            --glow-color-bright: rgba(0, 255, 170, 1.0);
            --glow-color-fade: rgba(0, 214, 143, 0.5);
            background: linear-gradient(110deg,
                #00ffaa 0%,
                var(--accent-positive) 25%,
                #00ffaa 50%,
                var(--accent-positive) 75%,
                #00ffaa 100%);
            background-size: 300% 100%;
            animation: glow-pulse 1.2s ease-in-out infinite,
                       shimmer 1.5s linear infinite;
        }

        .ls-ratio-container.extreme-short .short-side {
            --glow-size-min: 35px;
            --glow-size-max: 80px;
            --glow-color: rgba(255, 82, 82, 0.85);
            --glow-color-bright: rgba(255, 100, 100, 1.0);
            --glow-color-fade: rgba(255, 82, 82, 0.5);
            background: linear-gradient(110deg,
                #ff7070 0%,
                var(--accent-negative) 25%,
                #ff7070 50%,
                var(--accent-negative) 75%,
                #ff7070 100%);
            background-size: 300% 100%;
            animation: glow-pulse 1.2s ease-in-out infinite,
                       shimmer 1.5s linear infinite;
        }

        /* ===================================
           SIGNAL PILLS (Phase 2)
           =================================== */

        .signal-pill {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            cursor: help;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .signal-pill:hover {
            transform: translateY(-1px);
            filter: brightness(1.2);
        }

        /* Signal Direction Colors */
        .signal-pill.bullish {
            background: rgba(0, 214, 143, 0.12);
            color: var(--accent-positive);
            border-color: rgba(0, 214, 143, 0.2);
        }

        .signal-pill.bearish {
            background: rgba(255, 82, 82, 0.12);
            color: var(--accent-negative);
            border-color: rgba(255, 82, 82, 0.2);
        }

        /* Signal Strength Intensity */
        .signal-pill.extreme {
            font-weight: 700;
            border-width: 1.5px;
        }

        .signal-pill.strong {
            opacity: 0.95;
        }

        .signal-pill.moderate {
            opacity: 0.85;
        }

        .signal-pill.weak {
            opacity: 0.7;
        }

        .signal-icon {
            display: inline-flex;
            align-items: center;
        }

        .signal-label {
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .signal-strength {
            font-size: 8px;
            opacity: 0.7;
            margin-left: 2px;
        }
    </style>
</head>
<body>
    <!-- SVG Definitions for Alpha Pulse -->
    <svg class="momentum-svg-defs" aria-hidden="true">
        <defs>
            <linearGradient id="momentumBullishGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#10b981" />
                <stop offset="100%" style="stop-color:#34d399" />
            </linearGradient>
            <linearGradient id="momentumBearishGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#ef4444" />
                <stop offset="100%" style="stop-color:#f87171" />
            </linearGradient>
        </defs>
    </svg>

    <div id="app" class="app-container">
        <!-- Fullscreen Beta Chart Overlay -->
        <div v-if="betaFullscreen" class="fullscreen-overlay">
            <div class="fullscreen-header">
                <div class="fullscreen-title">
                    <span class="beta-symbol"></span>
                    Bitcoin Beta Analysis
                </div>
                <div class="fullscreen-actions">
                    <select class="timeframe-select" v-model="betaTimeframe" @change="loadBetaChart" style="margin-right: 8px;">
                        <option value="0.0833">5m</option>
                        <option value="0.25">15m</option>
                        <option value="0.5">30m</option>
                        <option value="1">1H</option>
                        <option value="4">4H</option>
                        <option value="12">12H</option>
                        <option value="24">24H</option>
                    </select>
                    <button class="fullscreen-close" @click="openBetaFullscreen">
                        <i data-lucide="minimize-2"></i>
                        Exit Fullscreen
                    </button>
                </div>
            </div>
            <div class="fullscreen-body">
                <div class="fullscreen-chart" id="betaChartFullscreen"></div>
                <div class="fullscreen-legend">
                    <div class="fullscreen-legend-title">Performance</div>
                    <div id="betaChartLegendFullscreen"></div>
                </div>
            </div>
        </div>

        <!-- Left Sidebar -->
        <div class="sidebar" :class="{ collapsed: sidebarCollapsed }">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i data-lucide="trending-up"></i>
                    <span>VIRTUOSO</span>
                </div>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Main</div>
                    <div class="nav-item" :class="{ active: currentView === 'dashboard' }" @click="switchView('dashboard')">
                        <i data-lucide="layout-dashboard"></i>
                        <span>Dashboard</span>
                    </div>
                    <div class="nav-item" :class="{ active: currentView === 'signals' }" @click="switchView('signals')">
                        <i data-lucide="zap"></i>
                        <span>Signals</span>
                    </div>
                    <div class="nav-item" :class="{ active: currentView === 'analytics' }" @click="switchView('analytics')">
                        <i data-lucide="activity"></i>
                        <span>Analytics</span>
                    </div>
                    <a href="/aggr" class="nav-item" style="text-decoration: none; color: inherit;">
                        <i data-lucide="bar-chart-4"></i>
                        <span>Aggr.trade</span>
                    </a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Tools</div>
                    <div class="nav-item">
                        <i data-lucide="book-open"></i>
                        <span>Education</span>
                    </div>
                    <div class="nav-item" :class="{ active: currentView === 'calculator' }" @click="switchView('calculator')">
                        <i data-lucide="calculator"></i>
                        <span>Position Calculator</span>
                    </div>
                    <div class="nav-item">
                        <i data-lucide="code"></i>
                        <span>API Docs</span>
                    </div>
                </div>
            </nav>
            <div class="sidebar-footer">
                <button class="collapse-btn" @click="sidebarCollapsed = !sidebarCollapsed">
                    <i :data-lucide="sidebarCollapsed ? 'chevron-right' : 'chevron-left'"></i>
                </button>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-area">
            <!-- Top Header -->
            <header class="top-header">
                <div class="header-left">
                    <div class="market-status">
                        <div class="status-dot"></div>
                        <span>Markets Open</span>
                    </div>
                    <div class="header-stats">
                        <div class="header-stat">
                            <div class="header-stat-label">Uptime</div>
                            <div class="header-stat-value">{{ uptime }}</div>
                        </div>
                        <div class="header-stat">
                            <div class="header-stat-label">CPU</div>
                            <div class="header-stat-value">{{ cpu }}%</div>
                        </div>
                        <div class="header-stat">
                            <div class="header-stat-label">Memory</div>
                            <div class="header-stat-value">{{ memory }}%</div>
                        </div>
                        <div class="header-stat">
                            <div class="header-stat-label">Status</div>
                            <div class="header-stat-value positive">Online</div>
                        </div>
                    </div>
                </div>
                <div class="header-right">
                    <button class="header-btn" @click="toggleLock" :class="{ unlocked: !editable }" title="Toggle Edit Mode">
                        <i :data-lucide="editable ? 'lock-open' : 'lock'"></i>
                    </button>
                    <button class="header-btn" @click="resetLayout" title="Reset Layout">
                        <i data-lucide="refresh-ccw"></i>
                    </button>
                    <button class="header-btn" @click="showLayoutSettings = true" title="Layout Settings">
                        <i data-lucide="settings"></i>
                    </button>
                </div>
            </header>

            <!-- Layout Settings Modal -->
            <div v-if="showLayoutSettings" class="layout-modal-overlay" @click.self="showLayoutSettings = false">
                <div class="layout-modal">
                    <div class="layout-modal-header">
                        <h3>Dashboard Layout Configuration</h3>
                        <button class="layout-modal-close" @click="showLayoutSettings = false">
                            <i data-lucide="x"></i>
                        </button>
                    </div>
                    <div class="layout-modal-body">
                        <div class="layout-info">
                            <p>Current layout positions (drag widgets to adjust, then copy this configuration):</p>
                        </div>
                        <div class="layout-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Widget</th>
                                        <th>x</th>
                                        <th>y</th>
                                        <th>w</th>
                                        <th>h</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="item in layout" :key="item.i">
                                        <td class="widget-name">{{ getWidgetName(item.i) }}</td>
                                        <td>{{ item.x }}</td>
                                        <td>{{ item.y }}</td>
                                        <td>{{ item.w }}</td>
                                        <td>{{ item.h }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="layout-code">
                            <div class="layout-code-header">
                                <span>Layout Array (for dashboard_desktop_v2.html):</span>
                                <button class="layout-copy-btn" @click="copyLayoutToClipboard">
                                    <i data-lucide="copy"></i>
                                    <span>{{ layoutCopied ? 'Copied!' : 'Copy' }}</span>
                                </button>
                            </div>
                            <pre>{{ formatLayoutForCopy }}</pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Price Ticker Bar -->
            <div class="price-ticker" v-show="showPriceTicker">
                <div class="ticker-track" ref="tickerTrack" v-html="priceTickerHtml"></div>
            </div>

            <!-- News Ticker Bar -->
            <div class="news-ticker" v-show="showNewsTicker">
                <div class="news-ticker-label">News</div>
                <div class="news-track" ref="newsTrack" v-html="newsTickerHtml"></div>
            </div>

            <!-- Dashboard Grid -->
            <div class="dashboard-grid-container" v-show="currentView === 'dashboard'">
                <grid-layout
                    v-model:layout="layout"
                    :col-num="12"
                    :row-height="120"
                    :is-draggable="editable"
                    :is-resizable="editable"
                    :vertical-compact="true"
                    :margin="[10, 10]"
                    :use-css-transforms="true"
                    @layout-updated="saveLayout"
                >
                    <grid-item v-for="item in layout" :key="item.i"
                               :x="item.x"
                               :y="item.y"
                               :w="item.w"
                               :h="item.h"
                               :i="item.i"
                               drag-allow-from=".widget-header"
                               drag-ignore-from=".widget-btn">
                        <div class="widget" :class="{ loading: loading }">
                            <!-- Market Overview -->
                            <template v-if="item.i === 'marketOverview'">
                                <div class="widget-header">
                                    <div class="widget-title">
                                        <i data-lucide="globe"></i>
                                        Market Overview
                                    </div>
                                    <div class="widget-actions">
                                        <button class="widget-btn" @click="loadMarketOverview" title="Refresh">
                                            <i data-lucide="refresh-cw"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="widget-body">
                                    <!-- HERO: Market Regime (Primary Focus) -->
                                    <div style="background: linear-gradient(135deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.15) 100%); padding: 12px; border-radius: 10px; margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.05);">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px;">Market Regime</div>
                                                <div style="font-size: 15px; font-weight: 700; letter-spacing: 0.2px; color: var(--text-primary); line-height: 1.2;">{{ marketOverview.regime || 'Loading' }}</div>
                                            </div>
                                            <!-- Fear & Greed -->
                                            <div style="text-align: right;">
                                                <div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 4px; text-transform: uppercase;">Fear & Greed</div>
                                                <div style="display: flex; align-items: center; gap: 6px; justify-content: flex-end;">
                                                    <div style="font-size: 24px; font-weight: 800; color: var(--accent-warning);">{{ marketOverview.fearGreed }}</div>
                                                    <div style="font-size: 10px; font-weight: 600; color: var(--text-secondary); max-width: 50px; line-height: 1.2;">{{ marketOverview.fearGreedLabel }}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Total Market Cap with 24h Change -->
                                    <div style="background: rgba(0,0,0,0.15); padding: 12px; border-radius: 10px; margin-bottom: 12px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div>
                                                <div style="font-size: 10px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.3px;">Total Market Cap</div>
                                                <div style="display: flex; align-items: baseline; gap: 8px; margin-top: 2px;">
                                                    <span style="font-size: 20px; font-weight: 700; color: var(--text-primary);">{{ marketOverview.totalMarketCap }}</span>
                                                    <span v-if="marketOverview.marketCapChange" :style="{ fontSize: '11px', fontWeight: 600, padding: '2px 6px', borderRadius: '4px', background: parseFloat(marketOverview.marketCapChange) >= 0 ? 'rgba(76, 175, 80, 0.2)' : 'rgba(239, 68, 68, 0.2)', color: parseFloat(marketOverview.marketCapChange) >= 0 ? 'var(--accent-positive)' : 'var(--accent-negative)' }">{{ marketOverview.marketCapChange }}</span>
                                                </div>
                                            </div>
                                            <div style="text-align: right;">
                                                <div style="font-size: 10px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.3px;">24H Volume</div>
                                                <div style="font-size: 14px; font-weight: 600; color: var(--text-primary); margin-top: 2px;">{{ marketOverview.volume24h }}</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Dominance Breakdown Bar -->
                                    <div style="margin-bottom: 12px;">
                                        <div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.3px;">Market Dominance</div>
                                        <div style="height: 28px; border-radius: 6px; overflow: hidden; display: flex; background: rgba(0,0,0,0.3); box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);">
                                            <div :style="{ background: 'linear-gradient(180deg, #f7931a 0%, #e67b00 100%)', height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center', transition: 'width 0.5s ease', minWidth: '40px', width: marketOverview.btcDom + '%' }">
                                                <span style="font-size: 9px; font-weight: 700; color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">BTC</span>
                                            </div>
                                            <div :style="{ background: 'linear-gradient(180deg, #627eea 0%, #4a66d4 100%)', height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center', transition: 'width 0.5s ease', minWidth: '32px', width: marketOverview.ethDom + '%' }">
                                                <span style="font-size: 9px; font-weight: 700; color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">ETH</span>
                                            </div>
                                            <div :style="{ background: 'linear-gradient(180deg, #26a17b 0%, #1d8a68 100%)', height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center', transition: 'width 0.5s ease', minWidth: '38px', width: marketOverview.stableDom + '%' }">
                                                <span style="font-size: 9px; font-weight: 700; color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">STBL</span>
                                            </div>
                                            <div :style="{ background: 'linear-gradient(180deg, #8b5cf6 0%, #7244e8 100%)', height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center', transition: 'width 0.5s ease', flex: 1, minWidth: '36px' }">
                                                <span style="font-size: 9px; font-weight: 700; color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">ALTS</span>
                                            </div>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; margin-top: 6px; font-size: 11px;">
                                            <span style="color: #f7931a;"><span style="font-weight: 700;">{{ marketOverview.btcDom }}%</span> BTC</span>
                                            <span style="color: #627eea;"><span style="font-weight: 700;">{{ marketOverview.ethDom }}%</span> ETH</span>
                                            <span style="color: #26a17b;"><span style="font-weight: 700;">{{ marketOverview.stableDom }}%</span> Stable</span>
                                            <span style="color: #8b5cf6;"><span style="font-weight: 700;">{{ marketOverview.altDom }}%</span> Alts</span>
                                        </div>
                                    </div>

                                    <!-- Trend & Volatility Row -->
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 12px;">
                                        <!-- Trend Strength with Progress Bar -->
                                        <div>
                                            <div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 4px; text-transform: uppercase;">Trend Strength</div>
                                            <div style="display: flex; align-items: center; gap: 8px;">
                                                <div style="font-size: 16px; font-weight: 700;">{{ marketOverview.trendStrength }}</div>
                                                <div style="flex: 1; height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; overflow: hidden;">
                                                    <div :style="{ height: '100%', width: marketOverview.trendStrength + '%', background: 'var(--accent-primary)', transition: 'width 0.3s ease' }"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Market Volatility with Comparison -->
                                        <div>
                                            <div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 4px; text-transform: uppercase;">Volatility</div>
                                            <div style="font-size: 13px;">
                                                <span style="font-weight: 700; color: var(--text-primary);">{{ marketOverview.volatility }}</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Market Sentiment Breadth -->
                                    <div style="padding-top: 12px; border-top: 1px solid var(--border-light);">
                                        <div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;">Market Sentiment</div>
                                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                            <div :style="{ width: '36px', height: '36px', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center', transition: 'all 0.3s ease', background: marketOverview.bullishPct >= 50 ? 'rgba(76, 175, 80, 0.2)' : 'rgba(239, 68, 68, 0.2)', color: marketOverview.bullishPct >= 50 ? 'var(--accent-positive)' : 'var(--accent-negative)' }">
                                                <i :data-lucide="marketOverview.bullishPct >= 50 ? 'trending-up' : 'trending-down'" style="width: 20px; height: 20px;"></i>
                                            </div>
                                            <div style="flex: 1;">
                                                <div style="height: 24px; background: #0a1018; border-radius: 12px; overflow: hidden; position: relative; margin-bottom: 6px;">
                                                    <div style="height: 100%; display: flex; align-items: center; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);">
                                                        <div :style="{ background: 'var(--accent-positive)', height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontSize: '10px', fontWeight: 700, transition: 'width 0.5s ease', width: (marketOverview.bullishPct || 50) + '%' }">{{ marketOverview.bullishPct || 50 }}%</div>
                                                        <div :style="{ background: 'var(--accent-negative)', height: '100%', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontSize: '10px', fontWeight: 700, transition: 'width 0.5s ease', width: (100 - (marketOverview.bullishPct || 50)) + '%' }">{{ 100 - (marketOverview.bullishPct || 50) }}%</div>
                                                    </div>
                                                </div>
                                                <div style="display: flex; justify-content: space-between; font-size: 11px; color: var(--text-muted);">
                                                    <span style="display: flex; align-items: center; gap: 4px;">
                                                        <i data-lucide="arrow-up" style="width: 12px; height: 12px; color: var(--accent-positive);"></i>
                                                        <span style="font-weight: 600; color: var(--text-primary);">{{ marketOverview.risingCount || 0 }}</span>
                                                        <span>rising</span>
                                                    </span>
                                                    <span style="display: flex; align-items: center; gap: 4px;">
                                                        <i data-lucide="arrow-down" style="width: 12px; height: 12px; color: var(--accent-negative);"></i>
                                                        <span style="font-weight: 600; color: var(--text-primary);">{{ marketOverview.fallingCount || 0 }}</span>
                                                        <span>falling</span>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <!-- Bitcoin Beta Chart -->
                            <template v-else-if="item.i === 'betaChart'">
                                <div class="widget-header">
                                    <div class="widget-title">
                                        <span class="beta-symbol"></span>
                                        Bitcoin Beta Analysis
                                    </div>
                                    <div class="widget-actions">
                                        <select class="timeframe-select" v-model="betaTimeframe" @change="loadBetaChart">
                                            <option value="0.0833">5m</option>
                                            <option value="0.25">15m</option>
                                            <option value="0.5">30m</option>
                                            <option value="1">1H</option>
                                            <option value="4">4H</option>
                                            <option value="12">12H</option>
                                            <option value="24">24H</option>
                                        </select>
                                        <button class="widget-btn" title="Fullscreen" @click="openBetaFullscreen">
                                            <i data-lucide="maximize-2"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="widget-body beta-chart-wrapper">
                                    <div class="chart-container" id="betaChartContainer" ref="betaChartContainer"></div>
                                    <div class="beta-legend-container" id="betaChartLegend"></div>
                                </div>
                            </template>

                            <!-- Alpha Pulse (Confluence) -->
                            <template v-else-if="item.i === 'confluence'">
                                <div class="widget-header">
                                    <div class="widget-title">
                                        <i data-lucide="activity"></i>
                                        Alpha Pulse
                                    </div>
                                    <div class="widget-actions">
                                        <select class="confluence-sort" v-model="confluenceSort" @change="sortConfluence">
                                            <option value="score">Sort by Score</option>
                                            <option value="change">Sort by Change</option>
                                            <option value="symbol">Sort by Symbol</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="widget-body" style="padding: 0; overflow-y: auto;">
                                    <div class="momentum-cards-container" v-html="momentumCardsHtml"></div>
                                </div>
                            </template>

                            <!-- Top Movers -->
                            <template v-else-if="item.i === 'topMovers'">
                                <div class="widget-header">
                                    <div class="widget-title">
                                        <i data-lucide="bar-chart-2"></i>
                                        Top Movers
                                    </div>
                                </div>
                                <div class="widget-body" style="padding: 0;">
                                    <div class="movers-container">
                                        <!-- Gainers Section -->
                                        <div class="movers-section">
                                            <div class="movers-section-header gainers">
                                                <i data-lucide="trending-up" style="width: 12px; height: 12px;"></i>
                                                <span>Gainers</span>
                                            </div>
                                            <div class="movers-table-wrapper">
                                                <table class="symbol-table compact">
                                                    <thead>
                                                        <tr>
                                                            <th>Symbol</th>
                                                            <th>Price</th>
                                                            <th>24h</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr v-for="gainer in topMovers.gainers" :key="gainer.symbol">
                                                            <td><span class="symbol-name">{{ gainer.symbol }}</span></td>
                                                            <td class="symbol-price">{{ formatPrice(gainer.price) }}</td>
                                                            <td class="symbol-change positive">{{ formatChange(gainer.change) }}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <!-- Losers Section -->
                                        <div class="movers-section">
                                            <div class="movers-section-header losers">
                                                <i data-lucide="trending-down" style="width: 12px; height: 12px;"></i>
                                                <span>Losers</span>
                                            </div>
                                            <div class="movers-table-wrapper">
                                                <table class="symbol-table compact">
                                                    <thead>
                                                        <tr>
                                                            <th>Symbol</th>
                                                            <th>Price</th>
                                                            <th>24h</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr v-for="loser in topMovers.losers" :key="loser.symbol">
                                                            <td><span class="symbol-name">{{ loser.symbol }}</span></td>
                                                            <td class="symbol-price">{{ formatPrice(loser.price) }}</td>
                                                            <td class="symbol-change negative">{{ formatChange(loser.change) }}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <!-- Bitcoin Lead/Lag Prediction -->
                            <template v-else-if="item.i === 'btcPrediction'">
                                <!-- Include the standalone widget content -->
                                <div class="widget-header" style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; border-bottom: 1px solid rgba(251, 191, 36, 0.1);">
                                    <div class="widget-title" style="display: flex; align-items: center; gap: 0.5rem;">
                                        <i data-lucide="activity"></i>
                                        BTC Lead/Lag Predictor
                                    </div>
                                    <div id="btc-pred-status-indicator" style="width: 8px; height: 8px; border-radius: 50%; background: var(--text-secondary); box-shadow: 0 0 8px currentColor;"></div>
                                </div>

                                <div class="widget-body" style="padding: 1rem; overflow-y: auto;">
                                    <!-- Data Collection Progress Section -->
                                    <div style="margin-bottom: 1.25rem;">
                                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                                            <span style="color: var(--text-secondary); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">Data Collection</span>
                                            <span id="btc-pred-progress-text" style="color: var(--neon-amber); font-size: 0.75rem; font-weight: 600;">0/60</span>
                                        </div>

                                        <!-- Progress Bar -->
                                        <div style="position: relative; height: 6px; background: rgba(251, 191, 36, 0.1); border-radius: 3px; overflow: hidden;">
                                            <div id="btc-pred-progress-bar" style="position: absolute; left: 0; top: 0; height: 100%; width: 0%; background: linear-gradient(90deg, var(--neon-amber), #f59e0b); transition: width 0.3s ease; box-shadow: 0 0 10px var(--neon-amber);"></div>
                                        </div>

                                        <div id="btc-pred-ready-message" style="margin-top: 0.5rem; padding: 0.5rem; background: rgba(251, 191, 36, 0.05); border-left: 2px solid var(--neon-amber); border-radius: 3px; display: none;">
                                            <span style="color: var(--accent-positive); font-size: 0.75rem; font-weight: 500;">
                                                <i data-lucide="check-circle" style="width: 12px; height: 12px; display: inline; vertical-align: middle;"></i>
                                                System Ready
                                            </span>
                                        </div>
                                    </div>

                                    <!-- Summary Metrics -->
                                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; margin-bottom: 1.25rem;">
                                        <div style="background: rgba(251, 191, 36, 0.05); border-radius: 6px; padding: 0.75rem; border: 1px solid rgba(251, 191, 36, 0.1);">
                                            <div style="color: var(--text-secondary); font-size: 0.65rem; text-transform: uppercase; margin-bottom: 0.25rem;">Active</div>
                                            <div id="btc-pred-active-count" style="color: var(--accent-positive); font-size: 1.5rem; font-weight: 700; line-height: 1;">0</div>
                                        </div>

                                        <div style="background: rgba(251, 191, 36, 0.05); border-radius: 6px; padding: 0.75rem; border: 1px solid rgba(251, 191, 36, 0.1);">
                                            <div style="color: var(--text-secondary); font-size: 0.65rem; text-transform: uppercase; margin-bottom: 0.25rem;">Avg Conf</div>
                                            <div id="btc-pred-avg-confidence" style="color: var(--neon-amber); font-size: 1.5rem; font-weight: 700; line-height: 1;">0%</div>
                                        </div>

                                        <div style="background: rgba(251, 191, 36, 0.05); border-radius: 6px; padding: 0.75rem; border: 1px solid rgba(251, 191, 36, 0.1);">
                                            <div style="color: var(--text-secondary); font-size: 0.65rem; text-transform: uppercase; margin-bottom: 0.25rem;">Total</div>
                                            <div id="btc-pred-total-symbols" style="color: var(--text-primary); font-size: 1.5rem; font-weight: 700; line-height: 1;">0</div>
                                        </div>
                                    </div>

                                    <!-- Top Predictions List -->
                                    <div style="margin-bottom: 1rem;">
                                        <div style="color: var(--text-secondary); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.75rem;">
                                            Top Predictions
                                        </div>

                                        <div id="btc-pred-predictions-list" style="display: flex; flex-direction: column; gap: 0.5rem; max-height: 300px; overflow-y: auto;">
                                            <!-- Predictions will be inserted here -->
                                            <div style="text-align: center; padding: 1.5rem; color: var(--text-secondary); font-size: 0.8rem;">
                                                Awaiting data collection...
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Confidence Distribution Mini Chart -->
                                    <div style="margin-top: 1.25rem; padding-top: 1rem; border-top: 1px solid rgba(251, 191, 36, 0.1);">
                                        <div style="color: var(--text-secondary); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem;">
                                            Confidence Distribution
                                        </div>
                                        <canvas id="btc-pred-confidence-chart" style="width: 100%; height: 60px;"></canvas>
                                    </div>
                                </div>
                            </template>

                            <!-- Perpetuals Pulse -->
                            <template v-else-if="item.i === 'perpsPulse'">
                                <div class="widget-header">
                                    <div class="widget-title">
                                        <i data-lucide="bar-chart-3"></i>
                                        Perpetuals Pulse
                                    </div>
                                    <span class="cex-badge">{{ perpsPulse.exchangeCount }} CEX/DEX</span>
                                </div>
                                <div class="widget-body">
                                    <!-- Row 1: Funding + L/S + Basis -->
                                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; margin-bottom: 6px;">
                                        <!-- Funding Rate -->
                                        <div style="background: rgba(0,0,0,0.2); padding: 6px; border-radius: 6px; text-align: center;">
                                            <div style="font-size: 10px; color: var(--text-secondary); text-transform: uppercase;">Funding</div>
                                            <div style="font-size: 14px; font-weight: 700; color: var(--text-primary);">{{ perpsPulse.fundingRate }}</div>
                                            <div style="font-size: 10px; color: var(--text-secondary);">{{ perpsPulse.fundingSentiment }}</div>
                                        </div>
                                        <!-- Long/Short with Animated Glow -->
                                        <div class="ls-ratio-container" :class="lsBarClass">
                                            <div class="ls-ratio-header">Long / Short</div>
                                            <div class="ls-ratio-percentages">
                                                <span class="long-pct">{{ perpsPulse.longPct }}%</span>
                                                <span class="divider">/</span>
                                                <span class="short-pct">{{ perpsPulse.shortPct }}%</span>
                                            </div>
                                            <div class="ls-ratio-bar-container">
                                                <div class="ls-ratio-bar">
                                                    <div class="long-side" :style="{ width: perpsPulse.longPct + '%' }">
                                                        <span class="side-label">LONG</span>
                                                    </div>
                                                    <div class="short-side">
                                                        <span class="side-label">SHORT</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="ls-ratio-label" :class="lsLabelClass">{{ perpsPulse.lsLabel }}</div>
                                        </div>
                                        <!-- Basis -->
                                        <div style="background: rgba(0,0,0,0.2); padding: 6px; border-radius: 6px; text-align: center;">
                                            <div style="font-size: 10px; color: var(--text-secondary); text-transform: uppercase;">Basis</div>
                                            <div style="font-size: 10px; font-weight: 600; padding: 2px 4px; border-radius: 3px; background: rgba(255, 191, 0, 0.15); color: var(--text-primary); display: inline-block;">{{ perpsPulse.basisStatus }}</div>
                                            <div style="font-size: 10px; color: var(--text-secondary); margin-top: 2px;">{{ perpsPulse.basisPct }}</div>
                                        </div>
                                    </div>
                                    <!-- Row 2: OI + Volume -->
                                    <div style="background: rgba(0,0,0,0.15); padding: 6px 8px; border-radius: 6px; margin-bottom: 6px;">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                            <div>
                                                <div style="font-size: 10px; color: var(--text-secondary); text-transform: uppercase;">Open Interest</div>
                                                <div style="font-size: 15px; font-weight: 700; color: var(--text-primary);">{{ perpsPulse.openInterest }}</div>
                                            </div>
                                            <div style="text-align: right;">
                                                <div style="font-size: 10px; color: var(--text-secondary); text-transform: uppercase;">24H Volume</div>
                                                <div style="font-size: 14px; font-weight: 600; color: var(--text-secondary);">{{ perpsPulse.volume }}</div>
                                            </div>
                                        </div>
                                        <!-- CEX/DEX Bar -->
                                        <div style="margin-top: 4px;">
                                            <div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 3px; text-transform: uppercase;">CEX vs DEX</div>
                                            <div style="height: 18px; border-radius: 5px; overflow: hidden; display: flex; background: rgba(0,0,0,0.3);">
                                                <div :style="{ width: perpsPulse.cexPct + '%' }" style="background: linear-gradient(180deg, #ffa500 0%, #e67b00 100%); height: 100%; display: flex; align-items: center; justify-content: center; transition: width 0.5s ease;">
                                                    <span style="font-size: 10px; font-weight: 700; color: white;">CEX {{ perpsPulse.cexPct }}%</span>
                                                </div>
                                                <div style="background: linear-gradient(180deg, #8b5cf6 0%, #7244e8 100%); height: 100%; display: flex; align-items: center; justify-content: center; transition: width 0.5s ease; flex: 1;">
                                                    <span style="font-size: 10px; font-weight: 700; color: white;">DEX</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Row 3: Advanced Metrics (Phase 2) -->
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 6px;">
                                        <!-- Funding Z-Score -->
                                        <div style="background: rgba(0,0,0,0.1); padding: 5px 6px; border-radius: 4px; display: flex; align-items: center; justify-content: space-between;">
                                            <div style="font-size: 10px; color: var(--text-secondary); text-transform: uppercase;">Funding </div>
                                            <div :style="{ color: perpsPulse.fundingZScore > 0 ? 'var(--accent-negative)' : perpsPulse.fundingZScore < 0 ? 'var(--accent-positive)' : 'var(--text-secondary)' }"
                                                 style="font-size: 12px; font-weight: 700;">
                                                {{ perpsPulse.fundingZScore > 0 ? '+' : '' }}{{ perpsPulse.fundingZScore.toFixed(2) }}
                                            </div>
                                        </div>
                                        <!-- L/S Entropy (Health Indicator) -->
                                        <div style="background: rgba(0,0,0,0.1); padding: 5px 6px; border-radius: 4px; display: flex; align-items: center; justify-content: space-between;">
                                            <div style="font-size: 10px; color: var(--text-secondary); text-transform: uppercase;">L/S Health</div>
                                            <div :style="{ color: perpsPulse.lsEntropy >= 0.7 ? 'var(--accent-positive)' : perpsPulse.lsEntropy < 0.4 ? 'var(--accent-negative)' : 'var(--text-secondary)' }"
                                                 style="font-size: 12px; font-weight: 700;">
                                                {{ (perpsPulse.lsEntropy * 100).toFixed(0) }}%
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Row 4: Active Signals (Phase 2) -->
                                    <div v-if="perpsPulse.signalCount > 0" style="background: rgba(0,0,0,0.1); padding: 6px; border-radius: 6px;">
                                        <div style="font-size: 10px; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 4px; display: flex; align-items: center; gap: 4px;">
                                            <i data-lucide="activity" style="width: 11px; height: 11px;"></i>
                                            Active Signals
                                        </div>
                                        <div style="display: flex; flex-wrap: wrap; gap: 3px;">
                                            <div v-for="signal in perpsPulse.signals"
                                                 :key="signal.signal_type"
                                                 :class="['signal-pill', signal.direction, signal.strength]"
                                                 :title="signal.description + ' (confidence: ' + (signal.confidence * 100).toFixed(0) + '%)'">
                                                <span class="signal-icon">
                                                    <i :data-lucide="getSignalIcon(signal.signal_type)" style="width: 9px; height: 9px;"></i>
                                                </span>
                                                <span class="signal-label">{{ formatSignalType(signal.signal_type) }}</span>
                                                <span class="signal-strength">{{ signal.strength.charAt(0).toUpperCase() }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <!-- Alerted Signals -->
                            <template v-else-if="item.i === 'alertedSignals'">
                                <div class="widget-header">
                                    <div class="widget-title">
                                        <i data-lucide="bell-ring" style="color: var(--accent-positive);"></i>
                                        Alerted Signals
                                        <span class="count-badge">{{ alertedSignals.length }}</span>
                                    </div>
                                </div>
                                <div class="widget-body">
                                    <div style="font-size: 9px; color: var(--text-secondary); margin-bottom: 8px;">
                                        High-conviction signals that crossed the alert threshold
                                    </div>
                                    <div style="overflow-y: auto; flex: 1;">
                                        <div v-for="signal in alertedSignals"
                                             :key="signal.symbol"
                                             class="signal-card clickable"
                                             :class="signal.direction.toLowerCase()"
                                             @click="openSignalReport(signal)"
                                             :title="'Click to view full trading report'">
                                            <span class="symbol-name">{{ signal.symbol }}</span>
                                            <span class="signal-direction-badge" :class="signal.direction.toLowerCase()">{{ signal.direction }}</span>
                                            <span class="signal-score">{{ signal.score }}</span>
                                            <i data-lucide="external-link" style="width: 12px; height: 12px; margin-left: auto; opacity: 0.5;"></i>
                                        </div>
                                    </div>
                                </div>
                            </template>

                            <!-- Recent Alerts -->
                            <template v-else-if="item.i === 'alerts'">
                                <div class="widget-header">
                                    <div class="widget-title">
                                        <i data-lucide="bell"></i>
                                        Recent Alerts
                                        <span class="count-badge alert">{{ recentAlerts.length }}</span>
                                    </div>
                                </div>
                                <div class="widget-body">
                                    <!-- Alert Filter Pills -->
                                    <div class="alert-filter-pills">
                                        <button class="alert-filter-pill" :class="{ active: alertFilter === 'all' }" @click="alertFilter = 'all'">
                                            <i data-lucide="layers"></i>
                                            <span>All</span>
                                        </button>
                                        <button class="alert-filter-pill" :class="{ active: alertFilter === 'whale_trade' }" @click="alertFilter = 'whale_trade'">
                                            <i data-lucide="fish"></i>
                                            <span>Whales</span>
                                        </button>
                                        <button class="alert-filter-pill" :class="{ active: alertFilter === 'liquidation_cascade' }" @click="alertFilter = 'liquidation_cascade'">
                                            <i data-lucide="droplets"></i>
                                            <span>Liqs</span>
                                        </button>
                                        <button class="alert-filter-pill" :class="{ active: alertFilter === 'signal' }" @click="alertFilter = 'signal'">
                                            <i data-lucide="target"></i>
                                            <span>Signals</span>
                                        </button>
                                        <button class="alert-filter-pill" :class="{ active: alertFilter === 'regime_change' }" @click="alertFilter = 'regime_change'">
                                            <i data-lucide="activity"></i>
                                            <span>Regime</span>
                                        </button>
                                    </div>
                                    <div style="overflow-y: auto; flex: 1;">
                                        <div v-for="alert in filteredAlerts" :key="alert.id" class="alert-card" :class="alert.type">
                                            <div class="alert-icon">
                                                <i :data-lucide="alert.icon"></i>
                                            </div>
                                            <div class="alert-content">
                                                <div class="alert-title">{{ alert.title }}</div>
                                                <div class="alert-subtitle">{{ alert.subtitle }}</div>
                                            </div>
                                            <div class="alert-meta">
                                                <div class="alert-value">{{ alert.value }}</div>
                                                <div class="alert-time">{{ alert.time }}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>

                        </div>
                    </grid-item>
                </grid-layout>
            </div>

            <!-- Analytics Section -->
            <div class="analytics-container" v-show="currentView === 'analytics'">
                <div class="analytics-header">
                    <div class="analytics-title">Analytics Dashboard</div>
                    <div class="analytics-subtitle">Comprehensive market intelligence and performance metrics</div>
                </div>

                <div class="analytics-grid">
                    <!-- Market Regime Analytics Panel -->
                    <div class="analytics-panel">
                        <div class="analytics-panel-header">
                            <div class="analytics-panel-title">
                                <i data-lucide="trending-up"></i>
                                Market Regime
                            </div>
                        </div>
                        <div class="analytics-panel-body">
                            <div v-if="analyticsLoading.regime" class="analytics-loading">
                                <i data-lucide="loader-2" style="width: 20px; height: 20px; animation: spin 1s linear infinite;"></i>
                                <span style="margin-left: 8px;">Loading regime data...</span>
                            </div>
                            <div v-else-if="analyticsError.regime" class="analytics-error">
                                {{ analyticsError.regime }}
                            </div>
                            <div v-else>
                                <!-- Trading Bias Card -->
                                <div class="trading-bias-card" :class="regimeAnalytics.tradingBias">
                                    <div class="trading-bias-label">Trading Bias</div>
                                    <div class="trading-bias-value">{{ regimeAnalytics.tradingBias }}</div>
                                </div>

                                <!-- Regime Distribution -->
                                <div class="regime-distribution">
                                    <div class="regime-pie-container">
                                        <svg class="regime-pie" viewBox="0 0 100 100">
                                            <circle v-for="(segment, index) in regimeAnalytics.pieSegments"
                                                :key="index"
                                                cx="50"
                                                cy="50"
                                                r="40"
                                                fill="none"
                                                :stroke="segment.color"
                                                stroke-width="20"
                                                :stroke-dasharray="`${segment.percentage * 2.51327} 251.327`"
                                                :stroke-dashoffset="`${segment.offset}`"
                                            />
                                        </svg>
                                        <div class="regime-center-label">
                                            <div class="regime-center-value">{{ regimeAnalytics.currentRegime }}</div>
                                            <div class="regime-center-text">Current</div>
                                        </div>
                                    </div>

                                    <div class="regime-legend">
                                        <div v-for="item in regimeAnalytics.distribution" :key="item.name" class="regime-legend-item">
                                            <div class="regime-legend-left">
                                                <div class="regime-legend-color" :style="{ backgroundColor: item.color }"></div>
                                                <span class="regime-legend-name">{{ item.name }}</span>
                                            </div>
                                            <span class="regime-legend-value">{{ item.percentage }}%</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Recent Regime Changes -->
                                <div v-if="regimeAnalytics.recentChanges.length > 0">
                                    <div class="signal-chart-title">Recent Changes</div>
                                    <div class="regime-timeline">
                                        <div v-for="change in regimeAnalytics.recentChanges" :key="change.timestamp"
                                            class="regime-timeline-item"
                                            :style="{ borderLeftColor: change.color }">
                                            <div class="regime-timeline-time">{{ formatTime(change.timestamp) }}</div>
                                            <div class="regime-timeline-change">
                                                {{ change.from }} <span class="regime-timeline-arrow"></span> {{ change.to }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Signal Performance Panel -->
                    <div class="analytics-panel">
                        <div class="analytics-panel-header">
                            <div class="analytics-panel-title">
                                <i data-lucide="zap"></i>
                                Signal Performance
                            </div>
                        </div>
                        <div class="analytics-panel-body">
                            <div v-if="analyticsLoading.signals" class="analytics-loading">
                                <i data-lucide="loader-2" style="width: 20px; height: 20px; animation: spin 1s linear infinite;"></i>
                                <span style="margin-left: 8px;">Loading signal data...</span>
                            </div>
                            <div v-else-if="analyticsError.signals" class="analytics-error">
                                {{ analyticsError.signals }}
                            </div>
                            <div v-else>
                                <!-- Key Metrics -->
                                <div class="signal-metric-grid">
                                    <div class="signal-metric-card">
                                        <div class="signal-metric-label">Win Rate</div>
                                        <div class="signal-metric-value" :style="{ color: signalAnalytics.winRate >= 50 ? 'var(--accent-positive)' : 'var(--accent-warning)' }">
                                            {{ signalAnalytics.winRate }}%
                                        </div>
                                        <div class="signal-metric-subtitle">{{ signalAnalytics.totalSignals }} total signals</div>
                                    </div>
                                    <div class="signal-metric-card">
                                        <div class="signal-metric-label">Avg Score</div>
                                        <div class="signal-metric-value">{{ signalAnalytics.avgScore }}</div>
                                        <div class="signal-metric-subtitle">Confluence strength</div>
                                    </div>
                                </div>

                                <!-- Score Distribution -->
                                <div class="signal-chart-container">
                                    <div class="signal-chart-title">Score Distribution</div>
                                    <div class="signal-bar-chart">
                                        <div v-for="bucket in signalAnalytics.scoreDistribution" :key="bucket.range" class="signal-bar-item">
                                            <div class="signal-bar-label">{{ bucket.range }}</div>
                                            <div class="signal-bar-track">
                                                <div class="signal-bar-fill"
                                                    :style="{ width: bucket.percentage + '%', backgroundColor: bucket.color }">
                                                    <span class="signal-bar-value">{{ bucket.count }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Component Contribution -->
                                <div class="signal-chart-container">
                                    <div class="signal-chart-title">Component Analysis</div>
                                    <div class="component-analysis">
                                        <div v-for="comp in signalAnalytics.componentContribution" :key="comp.name" class="component-item">
                                            <span class="component-name">{{ comp.name }}</span>
                                            <span class="component-score" :style="{ color: comp.score >= 60 ? 'var(--accent-positive)' : comp.score <= 40 ? 'var(--accent-negative)' : 'var(--accent-warning)' }">
                                                {{ comp.score }}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Liquidation & Risk Panel -->
                    <div class="analytics-panel">
                        <div class="analytics-panel-header">
                            <div class="analytics-panel-title">
                                <i data-lucide="alert-triangle"></i>
                                Liquidation & Risk
                            </div>
                        </div>
                        <div class="analytics-panel-body">
                            <div v-if="analyticsLoading.liquidation" class="analytics-loading">
                                <i data-lucide="loader-2" style="width: 20px; height: 20px; animation: spin 1s linear infinite;"></i>
                                <span style="margin-left: 8px;">Loading risk data...</span>
                            </div>
                            <div v-else-if="analyticsError.liquidation" class="analytics-error">
                                {{ analyticsError.liquidation }}
                            </div>
                            <div v-else>
                                <!-- Market Stress Gauge -->
                                <div class="stress-gauge-container">
                                    <svg class="stress-gauge" viewBox="0 0 100 100">
                                        <circle cx="50" cy="50" r="40" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="12"/>
                                        <circle cx="50" cy="50" r="40" fill="none"
                                            :stroke="liquidationAnalytics.stressColor"
                                            stroke-width="12"
                                            :stroke-dasharray="`${liquidationAnalytics.stressLevel * 2.51327} 251.327`"
                                            stroke-dashoffset="0"
                                            stroke-linecap="round"
                                        />
                                    </svg>
                                    <div class="stress-gauge-center">
                                        <div class="stress-gauge-value">{{ liquidationAnalytics.stressLevel }}</div>
                                        <div class="stress-gauge-label">Stress Index</div>
                                        <div class="stress-gauge-status" :style="{ color: liquidationAnalytics.stressColor }">
                                            {{ liquidationAnalytics.stressStatus }}
                                        </div>
                                    </div>
                                </div>

                                <!-- Cascade Risk Alerts -->
                                <div v-if="liquidationAnalytics.cascadeAlerts.length > 0" class="risk-alerts">
                                    <div class="risk-alert-title">
                                        <i data-lucide="alert-octagon" style="width: 14px; height: 14px;"></i>
                                        Cascade Risk Zones
                                    </div>
                                    <div v-for="alert in liquidationAnalytics.cascadeAlerts" :key="alert" class="risk-alert-item">
                                        {{ alert }}
                                    </div>
                                </div>

                                <!-- Stress Factors -->
                                <div class="signal-chart-container">
                                    <div class="signal-chart-title">Stress Factors</div>
                                    <div class="stress-factors">
                                        <div v-for="factor in liquidationAnalytics.stressFactors" :key="factor.name" class="stress-factor-item">
                                            <div class="stress-factor-name">{{ factor.name }}</div>
                                            <div class="stress-factor-bar">
                                                <div class="stress-factor-fill"
                                                    :style="{ width: factor.value + '%', backgroundColor: factor.color }">
                                                    <span class="stress-factor-value">{{ factor.value }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Liquidation Summary -->
                                <div class="liquidation-summary">
                                    <div class="liquidation-stat">
                                        <div class="liquidation-stat-label">24h Volume</div>
                                        <div class="liquidation-stat-value">{{ formatCurrency(liquidationAnalytics.volume24h) }}</div>
                                    </div>
                                    <div class="liquidation-stat">
                                        <div class="liquidation-stat-label">Events</div>
                                        <div class="liquidation-stat-value">{{ liquidationAnalytics.eventCount }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cross-Asset Correlation Matrix Panel -->
                    <div class="analytics-panel correlation-panel" style="grid-column: 1 / -1;">
                        <div class="analytics-panel-header">
                            <div class="analytics-panel-title">
                                <i data-lucide="git-merge"></i>
                                Cross-Asset Correlation Matrix
                            </div>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <!-- Timeframe Selector -->
                                <div class="correlation-timeframe-selector">
                                    <button
                                        v-for="tf in correlationTimeframes"
                                        :key="tf.value"
                                        @click="loadCorrelationData(tf.value)"
                                        :class="{ active: correlationTimeframe === tf.value }"
                                        class="correlation-tf-btn">
                                        {{ tf.label }}
                                    </button>
                                </div>
                                <div class="analytics-panel-badge beta">BETA</div>
                            </div>
                        </div>
                        <div class="analytics-panel-body">
                            <div v-if="analyticsLoading.correlation" class="analytics-loading">
                                <i data-lucide="loader-2" style="width: 20px; height: 20px; animation: spin 1s linear infinite;"></i>
                                <span style="margin-left: 8px;">Loading correlation data...</span>
                            </div>
                            <div v-else-if="analyticsError.correlation" class="analytics-error">
                                {{ analyticsError.correlation }}
                            </div>
                            <div v-else class="correlation-content">
                                <!-- Top Metrics Row -->
                                <div class="correlation-metrics">
                                    <div class="correlation-metric-card">
                                        <div class="correlation-metric-label">Diversification Score</div>
                                        <div class="correlation-metric-value"
                                            :style="{ color: correlationData.diversificationScore >= 70 ? 'var(--accent-positive)' : correlationData.diversificationScore >= 40 ? 'var(--accent-warning)' : 'var(--accent-negative)' }">
                                            {{ correlationData.diversificationScore }}
                                            <span class="correlation-metric-unit">/100</span>
                                        </div>
                                        <div class="correlation-metric-subtitle">
                                            {{ correlationData.diversificationScore >= 70 ? 'Well diversified' : correlationData.diversificationScore >= 40 ? 'Moderate risk clustering' : 'High correlation risk' }}
                                        </div>
                                    </div>
                                    <div class="correlation-metric-card">
                                        <div class="correlation-metric-label">Average Correlation</div>
                                        <div class="correlation-metric-value">{{ correlationData.averageCorrelation }}</div>
                                        <div class="correlation-metric-subtitle">Across all pairs</div>
                                    </div>
                                    <div class="correlation-metric-card">
                                        <div class="correlation-metric-label">Asset Count</div>
                                        <div class="correlation-metric-value">{{ correlationData.symbols.length }}</div>
                                        <div class="correlation-metric-subtitle">{{ correlationData.timeframe }} timeframe</div>
                                    </div>
                                </div>

                                <!-- Main Content: Heatmap + Insights -->
                                <div class="correlation-main-grid">
                                    <!-- Heatmap Container -->
                                    <div class="correlation-heatmap-container">
                                        <div id="correlationHeatmap" style="width: 100%; height: 800px;"></div>
                                    </div>

                                    <!-- Insights Panel -->
                                    <div class="correlation-insights">
                                        <!-- Strongest Correlations -->
                                        <div class="correlation-insight-section">
                                            <div class="correlation-insight-title">
                                                <i data-lucide="trending-up" style="width: 14px; height: 14px;"></i>
                                                Strongest Correlations
                                            </div>
                                            <div class="correlation-pair-list">
                                                <div v-for="pair in correlationData.strongestPairs" :key="pair.label" class="correlation-pair-item strong">
                                                    <div class="correlation-pair-symbols">{{ pair.label }}</div>
                                                    <div class="correlation-pair-value" :style="{ color: '#ef4444' }">
                                                        {{ pair.value }}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Weakest Correlations (Best Diversification) -->
                                        <div class="correlation-insight-section">
                                            <div class="correlation-insight-title">
                                                <i data-lucide="shield-check" style="width: 14px; height: 14px;"></i>
                                                Best Diversification Pairs
                                            </div>
                                            <div class="correlation-pair-list">
                                                <div v-for="pair in correlationData.weakestPairs" :key="pair.label" class="correlation-pair-item weak">
                                                    <div class="correlation-pair-symbols">{{ pair.label }}</div>
                                                    <div class="correlation-pair-value" :style="{ color: '#10b981' }">
                                                        {{ pair.value }}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Risk Warning -->
                                        <div v-if="correlationData.diversificationScore < 40" class="correlation-warning">
                                            <i data-lucide="alert-triangle" style="width: 16px; height: 16px;"></i>
                                            <div>
                                                <strong>High Correlation Risk</strong>
                                                <p>Many assets move together. Consider diversifying into low-correlation pairs.</p>
                                            </div>
                                        </div>

                                        <!-- Color Scale Legend -->
                                        <div class="correlation-legend">
                                            <div class="correlation-legend-title">Correlation Scale</div>
                                            <div class="correlation-legend-gradient">
                                                <div class="correlation-legend-labels">
                                                    <span>-1.0</span>
                                                    <span>0</span>
                                                    <span>+1.0</span>
                                                </div>
                                                <div class="correlation-legend-bar"></div>
                                                <div class="correlation-legend-descriptions">
                                                    <span>Perfect negative</span>
                                                    <span>No correlation</span>
                                                    <span>Perfect positive</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Position Calculator Section -->
            <div class="calculator-container" v-show="currentView === 'calculator'">
                <div class="calculator-header">
                    <div class="calculator-title-wrapper">
                        <div class="calculator-title">Position Size Calculator</div>
                        <div class="calculator-subtitle">Professional risk management tool for leverage trading</div>
                    </div>
                    <div class="calculator-mode-toggle">
                        <button class="calc-mode-btn"
                                :class="{ active: calculatorMode === 'simple' }"
                                @click="calculatorMode = 'simple'">
                            <i data-lucide="zap" style="width: 14px; height: 14px;"></i>
                            Simple
                        </button>
                        <button class="calc-mode-btn"
                                :class="{ active: calculatorMode === 'advanced' }"
                                @click="calculatorMode = 'advanced'">
                            <i data-lucide="sliders" style="width: 14px; height: 14px;"></i>
                            Advanced
                        </button>
                    </div>
                </div>

                <!-- Quick Presets (Advanced Only) -->
                <div class="calc-presets" v-show="calculatorMode === 'advanced'">
                    <button class="calc-preset-btn" @click="applyPreset('conservative')">
                        <span class="preset-name">Conservative</span>
                        <span class="preset-desc">2% risk, 5x leverage</span>
                    </button>
                    <button class="calc-preset-btn" @click="applyPreset('moderate')">
                        <span class="preset-name">Moderate</span>
                        <span class="preset-desc">3% risk, 10x leverage</span>
                    </button>
                    <button class="calc-preset-btn" @click="applyPreset('aggressive')">
                        <span class="preset-name">Aggressive</span>
                        <span class="preset-desc">5% risk, 20x leverage</span>
                    </button>
                </div>

                <div class="calculator-grid">
                    <!-- Trade Setup Section -->
                    <div class="calc-section">
                        <div class="calc-section-title">
                            <i data-lucide="target"></i>
                            Trade Setup
                        </div>

                        <div class="calc-field-group">
                            <label class="calc-label">Direction</label>
                            <div class="calc-direction-toggle">
                                <button class="calc-direction-btn long"
                                        :class="{ active: calculator.direction === 'LONG' }"
                                        @click="calculator.direction = 'LONG'">
                                    LONG
                                </button>
                                <button class="calc-direction-btn short"
                                        :class="{ active: calculator.direction === 'SHORT' }"
                                        @click="calculator.direction = 'SHORT'">
                                    SHORT
                                </button>
                            </div>
                        </div>

                        <div class="calc-field-group">
                            <label class="calc-label">Entry Price</label>
                            <input type="number"
                                   class="calc-input"
                                   v-model.number="calculator.entryPrice"
                                   placeholder="50000"
                                   step="0.01">
                        </div>

                        <div class="calc-field-group">
                            <label class="calc-label">Stop Loss</label>
                            <input type="number"
                                   class="calc-input"
                                   v-model.number="calculator.stopLoss"
                                   placeholder="49000"
                                   step="0.01">
                        </div>

                        <div class="calc-field-group">
                            <label class="calc-label">Take Profit</label>
                            <input type="number"
                                   class="calc-input"
                                   v-model.number="calculator.takeProfit"
                                   placeholder="52000"
                                   step="0.01">
                        </div>

                        <!-- Price Ladder Visualization (Advanced Only) -->
                        <div class="calc-price-ladder" v-show="calculatorMode === 'advanced'">
                            <div class="calc-ladder-title">Price Levels</div>

                            <div class="calc-ladder-item take-profit">
                                <div class="calc-ladder-icon">
                                    <i data-lucide="trending-up" style="width: 16px; height: 16px;"></i>
                                </div>
                                <div class="calc-ladder-content">
                                    <div class="calc-ladder-label">Take Profit</div>
                                    <div class="calc-ladder-price">${{ calculator.takeProfit || '0.00' }}</div>
                                </div>
                                <div class="calc-ladder-distance">
                                    +{{ calcRewardDistance.toFixed(2) }} ({{ calcRewardDistance > 0 && calculator.entryPrice > 0 ? ((calcRewardDistance / calculator.entryPrice) * 100).toFixed(2) : '0.00' }}%)
                                </div>
                            </div>

                            <div class="calc-ladder-item entry">
                                <div class="calc-ladder-icon">
                                    <i data-lucide="target" style="width: 16px; height: 16px;"></i>
                                </div>
                                <div class="calc-ladder-content">
                                    <div class="calc-ladder-label">Entry Price</div>
                                    <div class="calc-ladder-price">${{ calculator.entryPrice || '0.00' }}</div>
                                </div>
                                <div class="calc-ladder-distance">Entry</div>
                            </div>

                            <div class="calc-ladder-item stop-loss">
                                <div class="calc-ladder-icon">
                                    <i data-lucide="shield-alert" style="width: 16px; height: 16px;"></i>
                                </div>
                                <div class="calc-ladder-content">
                                    <div class="calc-ladder-label">Stop Loss</div>
                                    <div class="calc-ladder-price">${{ calculator.stopLoss || '0.00' }}</div>
                                </div>
                                <div class="calc-ladder-distance">
                                    -{{ calcRiskDistance.toFixed(2) }} ({{ calcRiskPercent.toFixed(2) }}%)
                                </div>
                            </div>

                            <div class="calc-ladder-item liquidation">
                                <div class="calc-ladder-icon">
                                    <i data-lucide="alert-triangle" style="width: 16px; height: 16px;"></i>
                                </div>
                                <div class="calc-ladder-content">
                                    <div class="calc-ladder-label">Liquidation</div>
                                    <div class="calc-ladder-price">${{ calcLiquidationPrice.toFixed(2) }}</div>
                                </div>
                                <div class="calc-ladder-distance">
                                    {{ calcLiqProximity.toFixed(2) }}%
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Risk Management Section -->
                    <div class="calc-section">
                        <div class="calc-section-title">
                            <i data-lucide="shield"></i>
                            Risk Management
                        </div>

                        <!-- Risk Gauge (Advanced Only) -->
                        <div class="calc-risk-gauge" v-show="calculatorMode === 'advanced'">
                            <div class="calc-gauge-container">
                                <svg class="calc-gauge-svg" viewBox="0 0 180 180">
                                    <circle class="calc-gauge-bg" cx="90" cy="90" r="75"></circle>
                                    <circle class="calc-gauge-fill"
                                            cx="90" cy="90" r="75"
                                            :stroke="calcLeverageColor"
                                            :stroke-dasharray="calcGaugeDashArray"
                                            stroke-dashoffset="0"></circle>
                                </svg>
                                <div class="calc-gauge-center">
                                    <div class="calc-gauge-value" :style="{ color: calcLeverageColor }">
                                        {{ calculator.leverage }}x
                                    </div>
                                    <div class="calc-gauge-label">{{ calcLeverageRisk }}</div>
                                </div>
                            </div>
                        </div>

                        <div class="calc-field-group">
                            <label class="calc-label">Account Balance (USD)</label>
                            <input type="number"
                                   class="calc-input"
                                   v-model.number="calculator.accountBalance"
                                   placeholder="10000"
                                   step="100">
                        </div>

                        <div class="calc-field-group">
                            <label class="calc-label">Risk per Trade (%)</label>
                            <input type="number"
                                   class="calc-input"
                                   v-model.number="calculator.riskPercent"
                                   placeholder="1"
                                   min="0.1"
                                   max="10"
                                   step="0.1">
                        </div>

                        <div class="calc-field-group">
                            <label class="calc-label">Leverage</label>
                            <div class="calc-slider-container">
                                <div class="calc-slider-track"></div>
                                <input type="range"
                                       class="calc-slider"
                                       v-model.number="calculator.leverage"
                                       min="1"
                                       max="125"
                                       step="1">
                                <div class="calc-slider-markers">
                                    <span class="calc-slider-marker">1x</span>
                                    <span class="calc-slider-marker">10x</span>
                                    <span class="calc-slider-marker">25x</span>
                                    <span class="calc-slider-marker">50x</span>
                                    <span class="calc-slider-marker">100x</span>
                                    <span class="calc-slider-marker">125x</span>
                                </div>
                                <div class="calc-slider-value">
                                    <span>1x</span>
                                    <span class="calc-slider-current">{{ calculator.leverage }}x</span>
                                    <span class="calc-leverage-risk" :class="calcLeverageRiskClass">{{ calcLeverageRisk }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Results Section -->
                    <div class="calc-section">
                        <div class="calc-section-title">
                            <i data-lucide="bar-chart-3"></i>
                            Calculation Results
                        </div>

                        <!-- Risk/Reward Visual Comparison (Advanced Only) -->
                        <div class="calc-rr-visual" v-show="calculatorMode === 'advanced'">
                            <div class="calc-rr-title">Risk vs Reward Comparison</div>
                            <div class="calc-rr-bars">
                                <div class="calc-rr-bar-container">
                                    <div class="calc-rr-bar-label">
                                        <span>Risk</span>
                                        <span class="calc-rr-bar-value">${{ calcRiskAmount.toFixed(2) }}</span>
                                    </div>
                                    <div class="calc-rr-bar">
                                        <div class="calc-rr-bar-fill risk" :style="{ width: calcRRBarWidth.risk + '%' }">
                                            {{ calcRiskPercent.toFixed(1) }}%
                                        </div>
                                    </div>
                                </div>
                                <div class="calc-rr-bar-container">
                                    <div class="calc-rr-bar-label">
                                        <span>Reward</span>
                                        <span class="calc-rr-bar-value">${{ calcPotentialProfit.toFixed(2) }}</span>
                                    </div>
                                    <div class="calc-rr-bar">
                                        <div class="calc-rr-bar-fill reward" :style="{ width: calcRRBarWidth.reward + '%' }">
                                            {{ calcRiskRewardRatio.toFixed(1) }}:1
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Simple Mode Results -->
                        <div class="calc-simple-results" v-show="calculatorMode === 'simple'">
                            <div class="calc-simple-result-card primary">
                                <div class="calc-simple-label">Position Size</div>
                                <div class="calc-simple-value">${{ calcPositionSizeUSD.toFixed(2) }}</div>
                                <div class="calc-simple-subvalue">{{ calcPositionSizeBase.toFixed(4) }} units</div>
                            </div>

                            <div class="calc-simple-result-card risk">
                                <div class="calc-simple-label">Risk Amount</div>
                                <div class="calc-simple-value negative">${{ calcRiskAmount.toFixed(2) }}</div>
                                <div class="calc-simple-subvalue">{{ calcRiskPercent.toFixed(2) }}% of entry</div>
                            </div>

                            <div class="calc-simple-result-card reward">
                                <div class="calc-simple-label">Potential Profit</div>
                                <div class="calc-simple-value positive">${{ calcPotentialProfit.toFixed(2) }}</div>
                                <div class="calc-simple-subvalue">{{ calcROI.toFixed(2) }}% ROI</div>
                            </div>

                            <div class="calc-simple-result-card ratio">
                                <div class="calc-simple-label">Risk:Reward Ratio</div>
                                <div class="calc-simple-value" :class="{ positive: calcRiskRewardRatio >= 2, warning: calcRiskRewardRatio < 2 }">
                                    {{ calcRiskRewardRatio.toFixed(2) }}:1
                                </div>
                                <div class="calc-simple-subvalue">
                                    <span v-if="calcRiskRewardRatio >= 2" class="calc-simple-status good"> Good ratio</span>
                                    <span v-else class="calc-simple-status poor"> Low ratio</span>
                                </div>
                            </div>
                        </div>

                        <!-- Advanced Mode Results -->
                        <div class="calc-results-grid" v-show="calculatorMode === 'advanced'">
                            <div class="calc-result-item highlight">
                                <div class="calc-result-label">Position Size (USD)</div>
                                <div class="calc-result-value">${{ calcPositionSizeUSD.toFixed(2) }}</div>
                            </div>

                            <div class="calc-result-item highlight">
                                <div class="calc-result-label">Position Size (Base)</div>
                                <div class="calc-result-value">{{ calcPositionSizeBase.toFixed(4) }}</div>
                            </div>

                            <div class="calc-result-item">
                                <div class="calc-result-label">Risk Amount</div>
                                <div class="calc-result-value negative">${{ calcRiskAmount.toFixed(2) }}</div>
                            </div>

                            <div class="calc-result-item">
                                <div class="calc-result-label">R:R Ratio</div>
                                <div class="calc-result-value" :class="{ positive: calcRiskRewardRatio >= 2, warning: calcRiskRewardRatio < 2 && calcRiskRewardRatio >= 1 }">
                                    {{ calcRiskRewardRatio.toFixed(2) }}:1
                                </div>
                            </div>

                            <div class="calc-result-item">
                                <div class="calc-result-label">Potential Profit</div>
                                <div class="calc-result-value positive">${{ calcPotentialProfit.toFixed(2) }}</div>
                            </div>

                            <div class="calc-result-item">
                                <div class="calc-result-label">ROI %</div>
                                <div class="calc-result-value positive">{{ calcROI.toFixed(2) }}%</div>
                            </div>

                            <div class="calc-result-item">
                                <div class="calc-result-label">Liquidation Price</div>
                                <div class="calc-result-value negative">${{ calcLiquidationPrice.toFixed(2) }}</div>
                            </div>

                            <div class="calc-result-item">
                                <div class="calc-result-label">Risk Distance</div>
                                <div class="calc-result-value">${{ calcRiskDistance.toFixed(2) }} ({{ calcRiskPercent.toFixed(2) }}%)</div>
                            </div>
                        </div>

                        <!-- Liquidation Warning (conditional) -->
                        <div v-if="calcShowLiqWarning" class="calc-liquidation-warning">
                            <i data-lucide="alert-triangle" style="width: 20px; height: 20px;"></i>
                            <div class="calc-liquidation-warning-content">
                                <div class="calc-liquidation-warning-title">Liquidation Risk Warning</div>
                                <div class="calc-liquidation-warning-text">
                                    Your liquidation price is only {{ Math.abs(calcLiqProximity).toFixed(1) }}% from entry.
                                    Consider reducing leverage or widening your stop loss.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        const VGL = window.VueGridLayoutV3 || window.VueGridLayout || {};
        const { GridLayout, GridItem } = VGL;

        const app = createApp({
            components: {
                GridLayout,
                GridItem
            },
            data() {
                return {
                    sidebarCollapsed: false,
                    editable: false,
                    loading: false,
                    uptime: '24h',
                    cpu: 45,
                    memory: 62,
                    showLayoutSettings: false,
                    layoutCopied: false,
                    layout: [
                        { i: 'marketOverview', x: 0, y: 0, w: 3, h: 4 },
                        { i: 'betaChart', x: 3, y: 0, w: 6, h: 5 },
                        { i: 'confluence', x: 9, y: 0, w: 3, h: 8 },
                        { i: 'perpsPulse', x: 0, y: 4, w: 3, h: 2.5 },
                        { i: 'alerts', x: 3, y: 5, w: 4, h: 3 },
                        { i: 'alertedSignals', x: 7, y: 5, w: 2, h: 3 },
                        { i: 'topMovers', x: 0, y: 6.5, w: 3, h: 2 },
                        { i: 'btcPrediction', x: 9, y: 8, w: 3, h: 4 }
                    ],
                    // Market Overview
                    marketOverview: {
                        regime: 'Loading...',
                        fearGreed: '--',
                        fearGreedLabel: 'Loading',
                        totalMarketCap: '$0',
                        marketCapChange: '+0%',
                        volume24h: '$0',
                        trendStrength: '0',
                        volatility: '--',
                        btcDom: 57,
                        ethDom: 12,
                        stableDom: 8,
                        altDom: 23,
                        bullishPct: 50,
                        risingCount: 0,
                        fallingCount: 0
                    },
                    // Beta Chart
                    betaTimeframe: '4',
                    betaChart: null,
                    betaSeriesMap: {},
                    betaFullscreen: false,
                    // Momentum Waves
                    confluenceSort: 'score',
                    confluenceData: [],
                    momentumCardsHtml: '',
                    // Top Movers
                    topMovers: {
                        gainers: [],
                        losers: []
                    },
                    // Perpetuals Pulse
                    perpsPulse: {
                        fundingRate: '0.000%',
                        fundingSentiment: 'NEUTRAL',
                        longPct: 50,
                        shortPct: 50,
                        lsLabel: 'BALANCED',
                        basisStatus: 'NEUTRAL',
                        basisPct: '+0.00%',
                        openInterest: '$0B',
                        volume: '$0B',
                        cexPct: 90,
                        exchangeCount: 8,
                        // Phase 2 Advanced Metrics
                        fundingZScore: 0.0,
                        lsEntropy: 0.5,
                        signalCount: 0,
                        signals: []
                    },
                    // Alerted Signals
                    alertedSignals: [],
                    // Recent Alerts
                    recentAlerts: [],
                    alertFilter: 'all',
                    // Price & News Tickers
                    showPriceTicker: true,
                    showNewsTicker: true,
                    priceTickerHtml: '',
                    newsTickerHtml: '<span class="news-item">Loading news...</span>',
                    // View Navigation
                    currentView: 'dashboard',
                    // Analytics Data
                    analyticsLoading: {
                        regime: false,
                        signals: false,
                        liquidation: false,
                        correlation: false
                    },
                    analyticsError: {
                        regime: null,
                        signals: null,
                        liquidation: null,
                        correlation: null
                    },
                    regimeAnalytics: {
                        currentRegime: 'N/A',
                        tradingBias: 'NEUTRAL',
                        distribution: [],
                        pieSegments: [],
                        recentChanges: []
                    },
                    signalAnalytics: {
                        winRate: 0,
                        totalSignals: 0,
                        avgScore: 0,
                        scoreDistribution: [],
                        componentContribution: []
                    },
                    liquidationAnalytics: {
                        stressLevel: 0,
                        stressStatus: 'CALM',
                        stressColor: '#00d68f',
                        stressFactors: [],
                        cascadeAlerts: [],
                        volume24h: 0,
                        eventCount: 0
                    },
                    // Correlation Matrix
                    correlationTimeframes: [
                        { label: '1H', value: '1h' },
                        { label: '4H', value: '4h' },
                        { label: '24H', value: '24h' },
                        { label: '7D', value: '7d' }
                    ],
                    correlationTimeframe: '24h',
                    correlationData: {
                        matrix: {},
                        symbols: [],
                        timeframe: '24h',
                        diversificationScore: 0,
                        averageCorrelation: 0,
                        strongestPairs: [],
                        weakestPairs: []
                    },
                    // Position Calculator
                    calculatorMode: 'advanced', // 'simple' or 'advanced'
                    calculator: {
                        direction: 'LONG',
                        entryPrice: 50000,
                        stopLoss: 49000,
                        takeProfit: 52000,
                        accountBalance: 10000,
                        riskPercent: 1,
                        leverage: 10
                    }
                };
            },
            computed: {
                filteredAlerts() {
                    if (this.alertFilter === 'all') {
                        return this.recentAlerts;
                    }
                    return this.recentAlerts.filter(alert => alert.type === this.alertFilter);
                },
                formatLayoutForCopy() {
                    const layoutStr = this.layout.map(item => {
                        return `    { i: '${item.i}', x: ${item.x}, y: ${item.y}, w: ${item.w}, h: ${item.h} }`;
                    }).join(',\n');
                    return `layout: [\n${layoutStr}\n]`;
                },
                // Position Calculator Computed Properties
                calcRiskDistance() {
                    const entry = parseFloat(this.calculator.entryPrice) || 0;
                    const stop = parseFloat(this.calculator.stopLoss) || 0;
                    return Math.abs(entry - stop);
                },
                calcRiskPercent() {
                    const entry = parseFloat(this.calculator.entryPrice) || 0;
                    if (entry === 0) return 0;
                    return (this.calcRiskDistance / entry) * 100;
                },
                calcPositionSizeUSD() {
                    const balance = parseFloat(this.calculator.accountBalance) || 0;
                    const riskPct = parseFloat(this.calculator.riskPercent) || 0;
                    const riskPercentDecimal = this.calcRiskPercent;
                    const leverage = parseFloat(this.calculator.leverage) || 1;

                    if (riskPercentDecimal === 0) return 0;

                    // Position Size = (Account Balance  Risk %) / (Risk % per unit)  Leverage
                    return (balance * (riskPct / 100)) / (riskPercentDecimal / 100) * leverage;
                },
                calcPositionSizeBase() {
                    const entry = parseFloat(this.calculator.entryPrice) || 0;
                    if (entry === 0) return 0;
                    return this.calcPositionSizeUSD / entry;
                },
                calcRiskAmount() {
                    const balance = parseFloat(this.calculator.accountBalance) || 0;
                    const riskPct = parseFloat(this.calculator.riskPercent) || 0;
                    return balance * (riskPct / 100);
                },
                calcRewardDistance() {
                    const entry = parseFloat(this.calculator.entryPrice) || 0;
                    const tp = parseFloat(this.calculator.takeProfit) || 0;
                    return Math.abs(tp - entry);
                },
                calcRiskRewardRatio() {
                    if (this.calcRiskDistance === 0) return 0;
                    return this.calcRewardDistance / this.calcRiskDistance;
                },
                calcPotentialProfit() {
                    const posSize = this.calcPositionSizeUSD;
                    const entry = parseFloat(this.calculator.entryPrice) || 0;
                    const tp = parseFloat(this.calculator.takeProfit) || 0;

                    if (entry === 0) return 0;

                    const priceChange = this.calculator.direction === 'LONG' ? (tp - entry) : (entry - tp);
                    return posSize * (priceChange / entry);
                },
                calcROI() {
                    const leverage = parseFloat(this.calculator.leverage) || 1;
                    const margin = this.calcPositionSizeUSD / leverage;

                    if (margin === 0) return 0;
                    return (this.calcPotentialProfit / margin) * 100;
                },
                calcLiquidationPrice() {
                    const entry = parseFloat(this.calculator.entryPrice) || 0;
                    const leverage = parseFloat(this.calculator.leverage) || 1;
                    const posSize = this.calcPositionSizeUSD;
                    const margin = posSize / leverage;

                    if (posSize === 0 || entry === 0) return 0;

                    // Simplified liquidation: Entry  (Margin / Position Size in Base) for LONG/SHORT
                    const basePosSize = posSize / entry;
                    const liquidationDistance = margin / basePosSize;

                    if (this.calculator.direction === 'LONG') {
                        return entry - liquidationDistance;
                    } else {
                        return entry + liquidationDistance;
                    }
                },
                // New Enhanced Calculator Computed Properties
                calcLiqProximity() {
                    const entry = parseFloat(this.calculator.entryPrice) || 0;
                    const liq = this.calcLiquidationPrice;
                    if (entry === 0) return 0;
                    return ((liq - entry) / entry) * 100;
                },
                calcShowLiqWarning() {
                    return Math.abs(this.calcLiqProximity) < 15 && this.calculator.entryPrice > 0;
                },
                calcLeverageRisk() {
                    const lev = this.calculator.leverage;
                    if (lev <= 5) return 'Low Risk';
                    if (lev <= 20) return 'Medium Risk';
                    if (lev <= 50) return 'High Risk';
                    return 'Extreme Risk';
                },
                calcLeverageRiskClass() {
                    const lev = this.calculator.leverage;
                    if (lev <= 5) return 'low';
                    if (lev <= 20) return 'medium';
                    if (lev <= 50) return 'high';
                    return 'extreme';
                },
                calcLeverageColor() {
                    const lev = this.calculator.leverage;
                    if (lev <= 5) return '#10b981';
                    if (lev <= 20) return '#fbbf24';
                    if (lev <= 50) return '#f97316';
                    return '#ef4444';
                },
                calcGaugeDashArray() {
                    const circumference = 2 * Math.PI * 75; // r=75
                    const percentage = (this.calculator.leverage / 125) * 100;
                    const dashLength = (percentage / 100) * circumference;
                    return `${dashLength} ${circumference}`;
                },
                calcRRBarWidth() {
                    const riskAmt = this.calcRiskAmount;
                    const rewardAmt = this.calcPotentialProfit;
                    const max = Math.max(riskAmt, rewardAmt);

                    if (max === 0) return { risk: 0, reward: 0 };

                    return {
                        risk: (riskAmt / max) * 100,
                        reward: (rewardAmt / max) * 100
                    };
                },
                // Perpetuals Pulse L/S Bar Animation
                lsBarClass() {
                    const longPct = parseFloat(this.perpsPulse.longPct);
                    const shortPct = parseFloat(this.perpsPulse.shortPct);

                    if (longPct >= 70) return 'extreme-long';
                    if (shortPct >= 70) return 'extreme-short';
                    if (longPct >= 65) return 'high-long';
                    if (shortPct >= 65) return 'high-short';
                    if (longPct >= 55) return 'moderate-long';
                    if (shortPct >= 55) return 'moderate-short';
                    return 'balanced';
                },
                lsLabelClass() {
                    const longPct = parseFloat(this.perpsPulse.longPct);
                    const shortPct = parseFloat(this.perpsPulse.shortPct);

                    if (longPct >= 70) return 'extreme-warning';
                    if (shortPct >= 70) return 'extreme-warning short';
                    return '';
                }
            },
            methods: {
                toggleLock() {
                    this.editable = !this.editable;
                    console.log('Edit mode:', this.editable ? 'ON' : 'OFF');
                },
                // Perpetuals Pulse Signal Methods (Phase 2)
                getSignalIcon(signalType) {
                    const iconMap = {
                        'funding_divergence': 'git-branch',
                        'ls_extreme': 'scale',
                        'liquidation_risk': 'alert-triangle',
                        'momentum': 'trending-up'
                    };
                    return iconMap[signalType] || 'activity';
                },
                formatSignalType(signalType) {
                    return signalType.replace(/_/g, ' ');
                },
                saveLayout() {
                    localStorage.setItem('dashboardLayoutV2', JSON.stringify(this.layout));
                    console.log('Layout saved to localStorage');
                },
                getWidgetName(widgetId) {
                    const widgetNames = {
                        'marketOverview': 'Market Overview',
                        'betaChart': 'Bitcoin Beta Analysis',
                        'confluence': 'Alpha Pulse',
                        'perpsPulse': 'Perpetuals Pulse',
                        'alerts': 'Recent Alerts',
                        'alertedSignals': 'Alerted Signals',
                        'topMovers': 'Top Movers',
                        'btcPrediction': 'BTC Lead/Lag Predictor'
                    };
                    return widgetNames[widgetId] || widgetId;
                },
                async copyLayoutToClipboard() {
                    try {
                        await navigator.clipboard.writeText(this.formatLayoutForCopy);
                        this.layoutCopied = true;
                        setTimeout(() => {
                            this.layoutCopied = false;
                        }, 2000);
                    } catch (err) {
                        console.error('Failed to copy:', err);
                        alert('Failed to copy to clipboard');
                    }
                },
                resetLayout() {
                    if (confirm('Reset layout to default?')) {
                        localStorage.removeItem('dashboardLayoutV2');
                        this.layout = [
                            { i: 'marketOverview', x: 0, y: 0, w: 3, h: 7 },
                            { i: 'betaChart', x: 3, y: 0, w: 6, h: 4 },
                            { i: 'confluence', x: 9, y: 0, w: 3, h: 4 },
                            { i: 'perpsPulse', x: 0, y: 7, w: 3, h: 4 },
                            { i: 'alerts', x: 3, y: 4, w: 3, h: 4 },
                            { i: 'alertedSignals', x: 6, y: 4, w: 6, h: 4 },
                            { i: 'topMovers', x: 0, y: 11, w: 3, h: 4 }
                        ];
                        console.log('Layout reset to default');
                    }
                },
                openBetaFullscreen() {
                    // Toggle fullscreen mode for beta chart
                    this.betaFullscreen = !this.betaFullscreen;

                    this.$nextTick(() => {
                        // Re-init lucide icons for the new overlay
                        if (typeof lucide !== 'undefined') {
                            lucide.createIcons();
                        }

                        // Small delay to let DOM update, then reload chart in correct container
                        // loadBetaChart() handles container selection based on betaFullscreen state
                        setTimeout(() => {
                            this.loadBetaChart();
                        }, 100);
                    });
                },
                async loadMarketOverview() {
                    try {
                        // Use mobile-data endpoint - prefer ROOT level data over nested market_overview
                        // Root level has fresh cache data, nested may have stale cache_warmer data
                        const response = await fetch('/api/dashboard/mobile-data');
                        const result = await response.json();
                        const nested = result.market_overview || {};

                        // Check if data is from cache warmer initialization
                        let regime = result.market_regime || nested.market_regime || result.regime || 'Unknown';
                        let regimeStatus = null;

                        // Handle regime being an object with .regime property
                        if (typeof regime === 'object') {
                            regimeStatus = regime.status;
                            regime = regime.regime;
                        }

                        // Detect initialization state
                        const isInitializing = regime === 'Initializing' ||
                                             regimeStatus === 'cache_warmer_generated';

                        // Check if this is first load (no existing data)
                        const isFirstLoad = !this.marketOverview || !this.marketOverview.regime;

                        // Preserve last good data during initialization (unless first load)
                        if (isInitializing && !isFirstLoad) {
                            console.log('Preserving last good market overview data during cache warm-up');
                            return;
                        }

                        // For display: show "Loading..." instead of "Initializing"
                        if (regime === 'Initializing') {
                            regime = 'Loading...';
                        }

                        // Data is split between root and nested:
                        // - Root: market_regime (string), trend_strength, current_volatility, total_volume_24h
                        // - Nested: fear_greed_*, total_market_cap, btc_dominance, etc.
                        const marketCap = nested.total_market_cap || 0;
                        const volume = nested.coingecko_volume_24h || result.total_volume_24h || 0;

                        // Calculate market sentiment from whole market breadth (gainers/losers)
                        const risingCount = nested.gainers || 0;
                        const fallingCount = nested.losers || 0;
                        const totalSymbols = risingCount + fallingCount;
                        const bullishPct = totalSymbols > 0 ? ((risingCount / totalSymbols) * 100).toFixed(1) : 50;

                        // Calculate dominance values (must sum to 100%)
                        const btcDom = parseFloat(nested.btc_dominance || 57);
                        const ethDom = parseFloat(nested.eth_dominance || 12);
                        const stableDom = parseFloat(nested.stablecoin_dominance || 8);
                        // Other alts = 100% - BTC - ETH - Stablecoins
                        const altDom = Math.max(0, 100 - btcDom - ethDom - stableDom);

                        this.marketOverview = {
                            regime: regime,
                            fearGreed: nested.fear_greed_value ?? '--',
                            fearGreedLabel: nested.fear_greed_label || 'Loading',
                            totalMarketCap: this.formatCurrency(marketCap),
                            volume24h: this.formatCurrency(volume),
                            trendStrength: (result.trend_strength || nested.trend_strength || 0).toFixed(1),
                            volatility: (nested.volatility || nested.market_dispersion || result.current_volatility || 0).toFixed(2),
                            btcDom: btcDom.toFixed(1),
                            ethDom: ethDom.toFixed(1),
                            stableDom: stableDom.toFixed(1),
                            altDom: altDom.toFixed(1),
                            risingCount: risingCount,
                            fallingCount: fallingCount,
                            bullishPct: parseFloat(bullishPct)
                        };
                    } catch (error) {
                        console.error('Error loading market overview:', error);
                        // Preserve existing data on error
                    }
                },
                async loadBetaChart() {
                    try {
                        const response = await fetch(`/api/dashboard/beta-chart?timeframe=${this.betaTimeframe}`);
                        const data = await response.json();

                        // Wait for DOM to be ready
                        await this.$nextTick();
                        await new Promise(resolve => setTimeout(resolve, 1000));

                        // Use correct container based on fullscreen state
                        const containerId = this.betaFullscreen ? 'betaChartFullscreen' : 'betaChartContainer';
                        const container = document.getElementById(containerId);
                        if (!container) {
                            console.log('Beta chart container not found:', containerId);
                            return;
                        }

                        // Get container dimensions
                        const rect = container.getBoundingClientRect();
                        const width = rect.width || container.clientWidth || 500;
                        const height = rect.height || container.clientHeight || 250;

                        if (width < 50 || height < 50) {
                            console.log('Beta chart container too small:', width, height);
                            return;
                        }

                        // Clear existing chart if exists (for refreshes)
                        if (this.betaChart) {
                            this.betaChart.remove();
                            this.betaChart = null;
                            this.betaSeriesMap = {};
                        }

                        // Create new chart
                        this.betaChart = LightweightCharts.createChart(container, {
                            layout: {
                                background: { color: '#161616' },
                                textColor: '#a8a8a8',
                            },
                            grid: {
                                vertLines: { color: 'rgba(255, 255, 255, 0.05)' },
                                horzLines: { color: 'rgba(255, 255, 255, 0.05)' },
                            },
                            width: width,
                            height: height,
                            crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
                            rightPriceScale: { borderColor: 'rgba(255, 255, 255, 0.1)' },
                            timeScale: { borderColor: 'rgba(255, 255, 255, 0.1)', timeVisible: true },
                        });

                        // Color palette for multiple lines
                        const colorPalette = [
                            '#00FF7F', '#FF1493', '#00CED1', '#FFD700', '#FF6347',
                            '#7B68EE', '#FF69B4', '#20B2AA', '#9370DB', '#32CD32'
                        ];

                        // Update chart with data - API returns {chart_data: {BTC: [...], ETH: [...], ...}, performance_order: [...]}
                        if (data.chart_data) {
                            const chartDataDict = data.chart_data;
                            const performanceOrder = data.performance_order || Object.keys(chartDataDict);
                            let colorIndex = 0;
                            let allTimePoints = [];
                            this.betaSeriesMap = {};

                            // Add line series for each symbol
                            performanceOrder.forEach(symbol => {
                                const dataPoints = chartDataDict[symbol];
                                if (!dataPoints || dataPoints.length === 0) return;

                                // Convert timestamp from ms to seconds
                                const seriesData = dataPoints.map(p => ({
                                    time: Math.floor(p.timestamp / 1000),
                                    value: p.value
                                })).filter(d => !isNaN(d.time) && d.value !== undefined);

                                if (seriesData.length === 0) return;

                                // Collect time points for zero line
                                seriesData.forEach(d => {
                                    if (!allTimePoints.includes(d.time)) allTimePoints.push(d.time);
                                });

                                // BTC gets special styling (orange, thicker)
                                const color = symbol === 'BTC' ? '#FFA500' : colorPalette[colorIndex % colorPalette.length];
                                if (symbol !== 'BTC') colorIndex++;

                                const lineSeries = this.betaChart.addLineSeries({
                                    color: color,
                                    lineWidth: symbol === 'BTC' ? 2.5 : 1.2,
                                    lastValueVisible: false,  // Disabled to prevent overlapping
                                    priceLineVisible: false,
                                    title: symbol
                                });

                                lineSeries.setData(seriesData);
                                this.betaSeriesMap[symbol] = { series: lineSeries, color: color, finalValue: seriesData[seriesData.length - 1]?.value || 0 };
                            });

                            // Add zero reference line
                            if (allTimePoints.length > 0) {
                                allTimePoints.sort((a, b) => a - b);
                                const zeroLine = this.betaChart.addLineSeries({
                                    color: 'rgba(136, 136, 136, 0.5)',
                                    lineWidth: 1,
                                    lineStyle: LightweightCharts.LineStyle.Dashed,
                                    lastValueVisible: false,
                                    priceLineVisible: false
                                });
                                zeroLine.setData(allTimePoints.map(t => ({ time: t, value: 0 })));
                            }

                            this.betaChart.timeScale().fitContent();

                            // Render stacked legend
                            this.renderBetaLegend();
                        }
                    } catch (error) {
                        console.error('Error loading beta chart:', error);
                    }
                },
                async loadConfluenceData() {
                    try {
                        const response = await fetch('/api/dashboard/mobile-data');
                        const data = await response.json();

                        // Mobile data contains confluence scores
                        if (data.confluence && Array.isArray(data.confluence)) {
                            this.confluenceData = data.confluence;
                            this.updateMomentumCards();
                            this.updatePriceTicker(data.confluence);
                        } else if (data.symbols && Array.isArray(data.symbols)) {
                            this.confluenceData = data.symbols;
                            this.updateMomentumCards();
                            this.updatePriceTicker(data.symbols);
                        } else if (data.confluence_scores && Array.isArray(data.confluence_scores)) {
                            // Try confluence_scores key as well
                            this.confluenceData = data.confluence_scores;
                            this.updateMomentumCards();
                            this.updatePriceTicker(data.confluence_scores);
                        }
                    } catch (error) {
                        console.error('Error loading confluence data:', error);
                    }
                },
                updateMomentumCards() {
                    const validScores = this.confluenceData.filter(s => s && s.symbol && !s.symbol.includes('SYSTEM'));

                    if (validScores.length === 0) {
                        this.momentumCardsHtml = '<div style="text-align: center; color: var(--text-muted); padding: 24px;">No data available</div>';
                        return;
                    }

                    this.momentumCardsHtml = validScores.slice(0, 20).map((score, index) => {
                        const change = score.change_24h || score.price_change_24h || score.change || 0;
                        const confluenceScore = score.score || score.confluence_score || 50;
                        const direction = confluenceScore >= 60 ? 'LONG' : confluenceScore <= 40 ? 'SHORT' : 'NEUTRAL';
                        const signalClass = confluenceScore >= 60 ? 'bullish' : confluenceScore <= 40 ? 'bearish' : 'neutral';
                        const symbol = score.symbol.replace('USDT', '');
                        const fullSymbol = score.symbol;
                        const cardId = `alpha_pulse_desktop_${symbol}_${index}`;

                        const sparkline = this.createSparkline(score.score_history);
                        const circumference = 2 * Math.PI * 17;
                        const offset = circumference - (confluenceScore / 100) * circumference;
                        const trendArrow = change >= 0 ?
                            '<span class="momentum-trend-arrow" style="color: #34d399;">&#9650;</span>' :
                            '<span class="momentum-trend-arrow" style="color: #f87171;">&#9660;</span>';

                        // Calculate pulse intensity
                        const intensity = Math.abs(confluenceScore - 50);
                        const pulseLevels = [
                            { threshold: 45, duration: 0.5 },
                            { threshold: 40, duration: 0.7 },
                            { threshold: 35, duration: 0.9 },
                            { threshold: 28, duration: 1.2 },
                            { threshold: 20, duration: 1.6 },
                            { threshold: 12, duration: 2.2 },
                            { threshold: 5, duration: 3.0 },
                            { threshold: 0, duration: 4.5 }
                        ];
                        const pulseDuration = pulseLevels.find(l => intensity >= l.threshold).duration;

                        // Extract component scores
                        const components = score.components || score.results || {};
                        const componentScores = {
                            technical: components.technical || 50,
                            volume: components.volume || 50,
                            orderflow: components.orderflow || 50,
                            orderbook: components.orderbook || 50,
                            position: components.position || 50,
                            sentiment: components.sentiment || 50
                        };

                        // Generate component bars HTML
                        const getBarColor = (s) => s >= 60 ? 'var(--accent-positive)' : s <= 40 ? 'var(--accent-negative)' : 'var(--accent-warning)';
                        const componentBarsHtml = Object.entries(componentScores).map(([comp, s]) => {
                            const height = Math.max(6, (s / 100) * 20);
                            return `<div class="momentum-component-bar"><div class="momentum-component-bar-fill" style="height: ${height}px; background: ${getBarColor(s)};"></div></div>`;
                        }).join('');

                        // Generate breakdown HTML
                        const breakdownHtml = Object.entries(componentScores).map(([comp, s]) => {
                            const color = getBarColor(s);
                            const name = comp.charAt(0).toUpperCase() + comp.slice(1);
                            return `<div class="momentum-breakdown-row">
                                <span class="momentum-breakdown-label">${name}</span>
                                <div style="display: flex; align-items: center;">
                                    <div class="momentum-breakdown-bar"><div style="width: ${s}%; height: 100%; background: ${color};"></div></div>
                                    <span class="momentum-breakdown-value" style="color: ${color};">${Math.round(s)}</span>
                                </div>
                            </div>`;
                        }).join('');

                        return `
                            <div class="momentum-card ${signalClass}" style="--pulse-duration: ${pulseDuration}s; overflow: visible;" id="${cardId}" onclick="window.toggleAlphaPulseDesktop('${cardId}')">
                                <div class="card-pulse-ring"></div>
                                <div class="momentum-card-inner">
                                    <div class="momentum-card-content">
                                        <div class="momentum-symbol-block">
                                            <div class="momentum-symbol">${symbol}</div>
                                            <span class="momentum-signal-badge ${direction}">${direction}</span>
                                        </div>
                                        <div class="momentum-metrics">
                                            <div class="momentum-metric">
                                                <div class="momentum-metric-label">Price</div>
                                                <div class="momentum-metric-value">${this.formatPrice(score.price || 0)}</div>
                                            </div>
                                            <div class="momentum-metric">
                                                <div class="momentum-metric-label">24h</div>
                                                <div class="momentum-metric-value ${change >= 0 ? 'positive' : 'negative'}">
                                                    ${this.formatChange(change)}${trendArrow}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="momentum-score-container">
                                        ${sparkline}
                                        <div class="momentum-score-circle">
                                            <div class="momentum-pulse-ring"></div>
                                            <svg class="momentum-score-ring" width="44" height="44" viewBox="0 0 44 44">
                                                <circle class="momentum-score-ring-bg" cx="22" cy="22" r="17"/>
                                                <circle class="momentum-score-ring-progress"
                                                    cx="22" cy="22" r="17"
                                                    stroke-dasharray="${circumference}"
                                                    stroke-dashoffset="${offset}"/>
                                            </svg>
                                            <div class="momentum-score-inner">
                                                <div class="momentum-score-value">${Math.round(confluenceScore)}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Mini component bars -->
                                <div class="momentum-component-bars">${componentBarsHtml}</div>
                                <!-- Expand indicator -->
                                <div class="momentum-card-expand-indicator">
                                    <i data-lucide="chevron-down" style="width: 12px; height: 12px; transition: transform 0.2s;" id="${cardId}_chevron"></i>
                                </div>
                                <!-- Expanded content -->
                                <div class="momentum-card-expanded" id="${cardId}_expanded">
                                    <div style="font-size: 10px; font-weight: 600; color: var(--text-primary); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">Component Breakdown</div>
                                    ${breakdownHtml}
                                    <div class="momentum-action-buttons">
                                        <button class="momentum-action-btn primary" onclick="event.stopPropagation(); window.location.href='/api/dashboard/confluence-analysis-page?symbol=${fullSymbol}'">
                                            <i data-lucide="chart-line" style="width: 11px; height: 11px;"></i>
                                            Analyze
                                        </button>
                                        <button class="momentum-action-btn secondary" onclick="event.stopPropagation(); alert('Alerts for ${fullSymbol}')">
                                            <i data-lucide="bell" style="width: 11px; height: 11px;"></i>
                                            Alerts
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');

                    // Re-init Lucide icons after HTML update
                    this.$nextTick(() => {
                        if (typeof lucide !== 'undefined') {
                            lucide.createIcons();
                        }
                    });
                },
                createSparkline(scoreHistory, width = 70, height = 28) {
                    // Use score history if available, otherwise return empty
                    if (!scoreHistory || scoreHistory.length < 2) {
                        return '';
                    }

                    // Take last 12 data points for a clean sparkline
                    const data = scoreHistory.slice(-12);

                    const min = Math.min(...data);
                    const max = Math.max(...data);
                    const range = max - min || 1;
                    const padding = 2; // padding from edges

                    const points = data.map((val, i) => {
                        const x = padding + (i / (data.length - 1)) * (width - padding * 2);
                        const y = padding + (height - padding * 2) - ((val - min) / range) * (height - padding * 2);
                        return `${x.toFixed(1)},${y.toFixed(1)}`;
                    });

                    return `<svg class="momentum-sparkline" viewBox="0 0 ${width} ${height}" preserveAspectRatio="none">
                        <path class="sparkline-path" d="M${points.join(' L')}"/>
                    </svg>`;
                },
                sortConfluence() {
                    // Sort confluence data based on selected criteria
                    const sortKey = this.confluenceSort;
                    this.confluenceData.sort((a, b) => {
                        if (sortKey === 'score') {
                            return (b.score || 0) - (a.score || 0);
                        } else if (sortKey === 'change') {
                            return (b.change_24h || 0) - (a.change_24h || 0);
                        } else {
                            return a.symbol.localeCompare(b.symbol);
                        }
                    });
                    this.updateMomentumCards();
                },
                async loadTopMovers() {
                    try {
                        const response = await fetch('/api/dashboard/mobile-data');
                        const data = await response.json();

                        // Extract movers from mobile-data
                        const gainers = data.top_gainers || data.gainers || [];
                        const losers = data.top_losers || data.losers || [];

                        // Check if data is from cache warmer initialization (empty arrays)
                        const hasData = gainers.length > 0 || losers.length > 0;

                        // Check if this is first load (no existing data)
                        const isFirstLoad = !this.topMovers ||
                                          (!this.topMovers.gainers || this.topMovers.gainers.length === 0);

                        // Preserve last good data if we have empty arrays (unless first load)
                        if (!hasData && !isFirstLoad) {
                            console.log('Preserving last good top movers data during cache warm-up');
                            return;
                        }

                        this.topMovers = {
                            gainers: gainers.slice(0, 8).map(m => ({
                                symbol: (m.symbol || '').replace('USDT', ''),
                                price: m.price || m.last_price || 0,
                                change: m.change || m.price_change_pct || m.change_24h || 0
                            })),
                            losers: losers.slice(0, 8).map(m => ({
                                symbol: (m.symbol || '').replace('USDT', ''),
                                price: m.price || m.last_price || 0,
                                change: m.change || m.price_change_pct || m.change_24h || 0
                            }))
                        };

                        // Re-init Lucide icons
                        this.$nextTick(() => {
                            if (typeof lucide !== 'undefined') {
                                lucide.createIcons();
                            }
                        });
                    } catch (error) {
                        console.error('Error loading top movers:', error);
                        // Preserve existing data on error
                    }
                },
                async loadPerpsPulse() {
                    try {
                        // Use dedicated perpetuals-pulse endpoint
                        const response = await fetch('/api/dashboard/perpetuals-pulse');
                        const data = await response.json();

                        // Check if API returned error (from proxy timeout/failure)
                        if (data.status === 'error') {
                            console.warn('Perps pulse service error:', data.error);
                            // Preserve existing data instead of showing defaults
                            return;
                        }

                        // Derive L/S label from ratio
                        const longPct = data.long_pct || 50;
                        const shortPct = data.short_pct || 50;
                        let lsLabel = 'BALANCED';
                        if (longPct > 60) lsLabel = 'LONG HEAVY';
                        else if (shortPct > 60) lsLabel = 'SHORT HEAVY';

                        // Format basis percentage with sign
                        const basisPct = data.basis_pct || 0;
                        const basisStr = (basisPct >= 0 ? '+' : '') + (basisPct * 100).toFixed(2) + '%';

                        this.perpsPulse = {
                            fundingRate: ((data.funding_rate || 0) * 100).toFixed(3) + '%',
                            fundingSentiment: data.funding_sentiment || 'NEUTRAL',
                            longPct: Math.round(longPct),
                            shortPct: Math.round(shortPct),
                            lsLabel: lsLabel,
                            basisStatus: data.basis_status || 'NEUTRAL',
                            basisPct: basisStr,
                            openInterest: this.formatCurrency(data.total_open_interest || 0, 'B'),
                            volume: this.formatCurrency(data.total_volume_24h || 0, 'B'),
                            cexPct: Math.round(data.cex_pct || 90),
                            exchangeCount: data.exchange_count || 8,
                            // Phase 2 Advanced Metrics
                            fundingZScore: data.funding_zscore || 0.0,
                            lsEntropy: data.ls_entropy || 0.5,
                            signalCount: data.signal_count || 0,
                            signals: data.signals || []
                        };
                    } catch (error) {
                        console.error('Error loading perps pulse:', error);
                        // Preserve existing data on error
                    }
                },
                async loadAlertedSignals() {
                    try {
                        const response = await fetch('/api/dashboard/alerts?limit=50');
                        const data = await response.json();

                        // API returns array directly OR {alerts: [...]}
                        const allAlerts = Array.isArray(data) ? data : (data.alerts || []);

                        // Filter confluence/signal alerts
                        const signalAlerts = allAlerts
                            .filter(a => a.type === 'confluence' || a.type === 'signal')
                            .slice(0, 10);

                        this.alertedSignals = signalAlerts.map(s => ({
                            symbol: (s.symbol || '').replace('USDT', ''),
                            direction: s.details?.signal_type || s.direction || 'LONG',
                            score: Math.round(s.details?.confluence_score || s.score || 70),
                            time: this.formatTime((s.unix_timestamp || s.timestamp) * 1000),
                            timestamp: s.unix_timestamp || s.timestamp  // Preserve original for report URL
                        }));
                    } catch (error) {
                        console.error('Error loading alerted signals:', error);
                    }
                },
                async loadRecentAlerts() {
                    try {
                        const response = await fetch('/api/dashboard/alerts?limit=50');
                        const data = await response.json();

                        // API returns array directly OR {alerts: [...]}
                        const allAlerts = Array.isArray(data) ? data : (data.alerts || []);

                        this.recentAlerts = allAlerts.slice(0, 20).map(alert => ({
                            id: alert.id,
                            type: alert.type || 'signal',
                            icon: this.getAlertIcon(alert.type),
                            title: alert.message || alert.title || 'Alert',
                            subtitle: (alert.symbol || '').replace('USDT', ''),
                            value: alert.details?.confluence_score ? Math.round(alert.details.confluence_score) + '%' : '',
                            time: this.formatTime((alert.unix_timestamp || alert.timestamp) * 1000)
                        }));

                        // Re-init Lucide icons
                        this.$nextTick(() => {
                            if (typeof lucide !== 'undefined') {
                                lucide.createIcons();
                            }
                        });
                    } catch (error) {
                        console.error('Error loading recent alerts:', error);
                    }
                },
                getAlertIcon(type) {
                    const iconMap = {
                        'whale_trade': 'fish',
                        'liquidation_cascade': 'droplets',
                        'signal': 'target',
                        'confluence': 'target',
                        'regime_change': 'activity',
                        'warning': 'alert-triangle',
                        'info': 'info'
                    };
                    return iconMap[type] || 'bell';
                },
                renderBetaLegend() {
                    // Use correct legend container based on fullscreen state
                    const legendId = this.betaFullscreen ? 'betaChartLegendFullscreen' : 'betaChartLegend';
                    const legendContainer = document.getElementById(legendId);
                    if (!legendContainer || !this.betaSeriesMap) return;

                    // Sort by performance (finalValue)
                    const sorted = Object.entries(this.betaSeriesMap)
                        .filter(([symbol]) => symbol !== 'zero')
                        .sort((a, b) => b[1].finalValue - a[1].finalValue);

                    // Create compact stacked legend HTML
                    let html = '<div class="beta-legend">';
                    sorted.forEach(([symbol, data]) => {
                        const change = data.finalValue;
                        const changeClass = change >= 0 ? 'positive' : 'negative';
                        const changeStr = (change >= 0 ? '+' : '') + change.toFixed(1) + '%';
                        html += `
                            <div class="beta-legend-item">
                                <span class="legend-color" style="background: ${data.color};"></span>
                                <span class="legend-symbol">${symbol}</span>
                                <span class="legend-change ${changeClass}">${changeStr}</span>
                            </div>
                        `;
                    });
                    html += '</div>';
                    legendContainer.innerHTML = html;
                },
                formatPrice(price) {
                    if (price >= 1000) return '$' + price.toLocaleString('en-US', { maximumFractionDigits: 0 });
                    if (price >= 1) return '$' + price.toFixed(2);
                    if (price >= 0.01) return '$' + price.toFixed(4);
                    return '$' + price.toFixed(6);
                },
                formatChange(change) {
                    return (change >= 0 ? '+' : '') + change.toFixed(2) + '%';
                },
                formatCurrency(value, suffix = '') {
                    if (value >= 1e12) return '$' + (value / 1e12).toFixed(2) + 'T';
                    if (value >= 1e9) return '$' + (value / 1e9).toFixed(2) + (suffix || 'B');
                    if (value >= 1e6) return '$' + (value / 1e6).toFixed(2) + 'M';
                    if (value >= 1e3) return '$' + (value / 1e3).toFixed(2) + 'K';
                    return '$' + value.toFixed(2);
                },
                formatTime(timestamp) {
                    if (!timestamp) return '';
                    const date = new Date(timestamp);
                    const now = new Date();
                    const diff = Math.floor((now - date) / 1000);

                    if (diff < 60) return diff + 's ago';
                    if (diff < 3600) return Math.floor(diff / 60) + 'm ago';
                    if (diff < 86400) return Math.floor(diff / 3600) + 'h ago';
                    return Math.floor(diff / 86400) + 'd ago';
                },
                formatTimestampForFile(timestamp) {
                    // Convert timestamp to YYYYMMDD_HHMMSS format for report filenames
                    // Use UTC to match server-side Python report generation
                    if (!timestamp) return '';
                    const date = new Date(timestamp);

                    const year = date.getUTCFullYear();
                    const month = String(date.getUTCMonth() + 1).padStart(2, '0');
                    const day = String(date.getUTCDate()).padStart(2, '0');
                    const hours = String(date.getUTCHours()).padStart(2, '0');
                    const minutes = String(date.getUTCMinutes()).padStart(2, '0');
                    const seconds = String(date.getUTCSeconds()).padStart(2, '0');

                    return `${year}${month}${day}_${hours}${minutes}${seconds}`;
                },
                // Calculator Preset Methods
                applyPreset(presetName) {
                    const presets = {
                        conservative: {
                            riskPercent: 2,
                            leverage: 5
                        },
                        moderate: {
                            riskPercent: 3,
                            leverage: 10
                        },
                        aggressive: {
                            riskPercent: 5,
                            leverage: 20
                        }
                    };

                    const preset = presets[presetName];
                    if (preset) {
                        this.calculator.riskPercent = preset.riskPercent;
                        this.calculator.leverage = preset.leverage;
                    }
                },
                openSignalReport(signal) {
                    // Construct report URL and open in new window
                    // Format: {symbol}_{direction}_{score}p{decimal}_{timestamp}.html
                    // Example: btcusdt_LONG_72p5_20251203_123424.html

                    if (!signal || !signal.timestamp) {
                        console.warn('Cannot open report: missing signal data or timestamp', signal);
                        return;
                    }

                    // Format symbol (add back USDT if not present)
                    const symbol = signal.symbol.toLowerCase().includes('usdt')
                        ? signal.symbol.toLowerCase()
                        : signal.symbol.toLowerCase() + 'usdt';

                    // Format score as XXpX (e.g., 72 -> 72p0, 56.9 -> 56p9)
                    // Use .toFixed(1) to match Python report generator and avoid rounding overflow
                    const scoreStr = signal.score.toFixed(1).replace('.', 'p');

                    // Format timestamp
                    const timestampStr = this.formatTimestampForFile(signal.timestamp);

                    // Construct filename pattern (we'll use wildcard since exact score might vary slightly)
                    // Try exact match first
                    const filename = `${symbol}_${signal.direction}_${scoreStr}_${timestampStr}.html`;
                    const reportUrl = `/reports/html/${filename}`;

                    console.log('Opening signal report:', reportUrl);
                    window.open(reportUrl, '_blank');
                },
                // Price Ticker - uses confluence data
                updatePriceTicker(scores) {
                    if (!scores || scores.length === 0) return;

                    // Filter valid scores and sort by volume
                    const validScores = scores.filter(s =>
                        s && s.symbol && s.price &&
                        s.symbol !== 'SYSTEM_STATUS' &&
                        !s.symbol.includes('SYSTEM')
                    ).sort((a, b) => (b.volume_24h || 0) - (a.volume_24h || 0));

                    if (validScores.length === 0) return;

                    // Create ticker items HTML
                    const createTickerItem = (score) => {
                        const symbol = score.symbol.replace('USDT', '');
                        const price = parseFloat(score.price);
                        const change = parseFloat(score.change_24h || score.price_change_24h || 0);
                        const changeClass = change >= 0 ? 'positive' : 'negative';
                        const changePrefix = change >= 0 ? '+' : '';

                        // Format price based on magnitude
                        let priceStr;
                        if (price >= 1000) priceStr = price.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
                        else if (price >= 1) priceStr = price.toFixed(2);
                        else if (price >= 0.01) priceStr = price.toFixed(4);
                        else priceStr = price.toFixed(6);

                        return `
                            <div class="ticker-item">
                                <span class="ticker-symbol">${symbol}</span>
                                <span class="ticker-price">$${priceStr}</span>
                                <span class="ticker-change ${changeClass}">${changePrefix}${change.toFixed(1)}%</span>
                            </div>
                            <span class="ticker-separator"></span>
                        `;
                    };

                    // Generate ticker content (duplicate for seamless loop)
                    const tickerContent = validScores.map(createTickerItem).join('');
                    this.priceTickerHtml = tickerContent + tickerContent;

                    // Adjust animation speed after DOM update
                    this.$nextTick(() => {
                        const track = this.$refs.tickerTrack;
                        if (track) {
                            const contentWidth = track.scrollWidth / 2;
                            const speed = Math.max(10, contentWidth / 80);
                            track.style.animationDuration = `${speed}s`;
                        }
                    });
                },
                // News Ticker - fetches crypto news
                async loadNewsTicker() {
                    try {
                        const response = await fetch('/api/dashboard/news?limit=30');
                        if (!response.ok) throw new Error('Failed to fetch news');

                        const data = await response.json();
                        const news = data.news || [];

                        if (news.length === 0) {
                            this.newsTickerHtml = '<span class="news-item">No news available</span>';
                            return;
                        }

                        const createNewsItem = (item) => {
                            const title = item.title || '';
                            const link = item.link || '#';
                            const timeAgo = item.timestamp ? this.formatTime(item.timestamp * 1000) : '';

                            return `
                                <div class="news-item">
                                    <a href="${link}" target="_blank" rel="noopener">${title}</a>
                                    <span class="news-source">${timeAgo}</span>
                                </div>
                                <span class="news-separator"></span>
                            `;
                        };

                        // Generate news content (duplicate for seamless loop)
                        const newsContent = news.map(createNewsItem).join('');
                        this.newsTickerHtml = newsContent + newsContent;

                        // Adjust animation speed after DOM update
                        this.$nextTick(() => {
                            const track = this.$refs.newsTrack;
                            if (track) {
                                const contentWidth = track.scrollWidth / 2;
                                const speed = Math.max(15, contentWidth / 60);
                                track.style.animationDuration = `${speed}s`;
                            }
                        });

                    } catch (error) {
                        console.error('Error loading news:', error);
                        this.newsTickerHtml = '<span class="news-item">News feed unavailable</span>';
                    }
                },
                // View switching
                switchView(view) {
                    this.currentView = view;
                    console.log('Switched to view:', view);

                    // Load analytics data when switching to analytics view
                    if (view === 'analytics') {
                        this.loadAnalyticsData();
                    }

                    // Re-init icons after view change
                    this.$nextTick(() => {
                        this.initLucideIcons();
                    });
                },
                // Analytics Data Loading
                async loadAnalyticsData() {
                    console.log('Loading analytics data...');
                    await Promise.all([
                        this.loadRegimeAnalytics(),
                        this.loadSignalAnalytics(),
                        this.loadLiquidationAnalytics(),
                        this.loadCorrelationData()
                    ]);
                },
                async loadRegimeAnalytics() {
                    this.analyticsLoading.regime = true;
                    this.analyticsError.regime = null;

                    try {
                        // Fetch regime summary and trading bias
                        const [summaryRes, biasRes, changesRes] = await Promise.all([
                            fetch('/api/regime/summary'),
                            fetch('/api/regime/trading-bias'),
                            fetch('/api/regime/changes?limit=10')
                        ]);

                        const summary = await summaryRes.json();
                        const bias = await biasRes.json();
                        const changes = await changesRes.json();

                        // Map regime colors
                        const regimeColors = {
                            'strong_uptrend': '#00ff41',
                            'moderate_uptrend': '#4ade80',
                            'ranging': '#fbbf24',
                            'moderate_downtrend': '#fb923c',
                            'strong_downtrend': '#ef4444',
                            'high_volatility': '#a855f7',
                            'low_liquidity': '#6b7280'
                        };

                        // Process distribution data
                        const distribution = [];
                        const regimeData = summary.regime_distribution || summary.distribution || {};

                        Object.entries(regimeData).forEach(([regime, count]) => {
                            if (count > 0) {
                                distribution.push({
                                    name: regime.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
                                    percentage: Math.round((count / Object.values(regimeData).reduce((a, b) => a + b, 0)) * 100),
                                    count: count,
                                    color: regimeColors[regime] || '#888888'
                                });
                            }
                        });

                        // Sort by percentage descending
                        distribution.sort((a, b) => b.percentage - a.percentage);

                        // Create pie chart segments
                        let cumulativeOffset = 0;
                        const pieSegments = distribution.map(item => {
                            const segment = {
                                color: item.color,
                                percentage: item.percentage,
                                offset: -cumulativeOffset
                            };
                            cumulativeOffset += item.percentage * 2.51327;
                            return segment;
                        });

                        // Process recent changes
                        const recentChanges = (changes.changes || changes.recent_changes || []).map(change => ({
                            timestamp: change.timestamp * 1000 || Date.now(),
                            from: (change.from_regime || change.from || '').replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
                            to: (change.to_regime || change.to || '').replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
                            color: regimeColors[change.to_regime || change.to] || '#fbbf24'
                        }));

                        this.regimeAnalytics = {
                            currentRegime: (summary.current_regime || 'N/A').replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
                            tradingBias: bias.bias || bias.trading_bias || 'NEUTRAL',
                            distribution: distribution,
                            pieSegments: pieSegments,
                            recentChanges: recentChanges
                        };

                    } catch (error) {
                        console.error('Error loading regime analytics:', error);
                        this.analyticsError.regime = 'Failed to load regime data';
                    } finally {
                        this.analyticsLoading.regime = false;
                    }
                },
                async loadSignalAnalytics() {
                    this.analyticsLoading.signals = true;
                    this.analyticsError.signals = null;

                    try {
                        const response = await fetch('/api/analytics/signal-performance');
                        const data = await response.json();

                        // Calculate win rate
                        const totalSignals = data.total_signals || 0;
                        const winRate = totalSignals > 0 ? Math.round((data.winning_signals || 0) / totalSignals * 100) : 0;

                        // Process score distribution
                        const scoreBuckets = data.score_distribution || {};
                        const scoreDistribution = [
                            { range: '90-100', count: scoreBuckets['90-100'] || 0, color: '#00ff41' },
                            { range: '80-89', count: scoreBuckets['80-89'] || 0, color: '#4ade80' },
                            { range: '70-79', count: scoreBuckets['70-79'] || 0, color: '#10b981' },
                            { range: '60-69', count: scoreBuckets['60-69'] || 0, color: '#fbbf24' },
                            { range: '50-59', count: scoreBuckets['50-59'] || 0, color: '#f59e0b' },
                            { range: '40-49', count: scoreBuckets['40-49'] || 0, color: '#fb923c' },
                            { range: '<40', count: scoreBuckets['<40'] || 0, color: '#ef4444' }
                        ];

                        // Calculate percentages
                        const maxCount = Math.max(...scoreDistribution.map(b => b.count), 1);
                        scoreDistribution.forEach(bucket => {
                            bucket.percentage = Math.round((bucket.count / maxCount) * 100);
                        });

                        // Process component contribution
                        const components = data.component_scores || data.component_contribution || {};
                        const componentContribution = Object.entries(components).map(([name, score]) => ({
                            name: name.charAt(0).toUpperCase() + name.slice(1),
                            score: Math.round(score)
                        }));

                        this.signalAnalytics = {
                            winRate: winRate,
                            totalSignals: totalSignals,
                            avgScore: Math.round(data.average_score || 0),
                            scoreDistribution: scoreDistribution,
                            componentContribution: componentContribution
                        };

                    } catch (error) {
                        console.error('Error loading signal analytics:', error);
                        this.analyticsError.signals = 'Failed to load signal data';
                    } finally {
                        this.analyticsLoading.signals = false;
                    }
                },
                async loadLiquidationAnalytics() {
                    this.analyticsLoading.liquidation = true;
                    this.analyticsError.liquidation = null;

                    try {
                        const [stressRes, cascadeRes, summaryRes] = await Promise.all([
                            fetch('/api/liquidation/stress-indicators'),
                            fetch('/api/liquidation/cascade-risk'),
                            fetch('/api/liquidation/summary')
                        ]);

                        const stress = await stressRes.json();
                        const cascade = await cascadeRes.json();
                        const summary = await summaryRes.json();

                        // Determine stress level and status
                        const stressLevel = Math.round(stress.stress_index || stress.overall_stress || 0);
                        let stressStatus = 'CALM';
                        let stressColor = '#00d68f';

                        if (stressLevel >= 80) {
                            stressStatus = 'EXTREME';
                            stressColor = '#ef4444';
                        } else if (stressLevel >= 60) {
                            stressStatus = 'HIGH';
                            stressColor = '#fb923c';
                        } else if (stressLevel >= 40) {
                            stressStatus = 'ELEVATED';
                            stressColor = '#fbbf24';
                        }

                        // Process stress factors
                        const factors = stress.factors || stress.stress_factors || {};
                        const stressFactors = Object.entries(factors).map(([name, value]) => {
                            const normalizedValue = Math.min(Math.round(value * 100), 100);
                            let color = '#00d68f';
                            if (normalizedValue >= 80) color = '#ef4444';
                            else if (normalizedValue >= 60) color = '#fb923c';
                            else if (normalizedValue >= 40) color = '#fbbf24';

                            return {
                                name: name.charAt(0).toUpperCase() + name.slice(1),
                                value: normalizedValue,
                                color: color
                            };
                        });

                        // Process cascade alerts
                        const cascadeAlerts = [];
                        const zones = cascade.zones || cascade.risk_zones || [];
                        zones.forEach(zone => {
                            if (zone.risk_level === 'high' || zone.severity === 'high') {
                                cascadeAlerts.push(`${zone.symbol}: $${this.formatNumber(zone.volume)} at ${zone.price_level}`);
                            }
                        });

                        this.liquidationAnalytics = {
                            stressLevel: stressLevel,
                            stressStatus: stressStatus,
                            stressColor: stressColor,
                            stressFactors: stressFactors,
                            cascadeAlerts: cascadeAlerts,
                            volume24h: summary.total_volume_24h || summary.volume_24h || 0,
                            eventCount: summary.event_count || summary.total_events || 0
                        };

                    } catch (error) {
                        console.error('Error loading liquidation analytics:', error);
                        this.analyticsError.liquidation = 'Failed to load liquidation data';
                    } finally {
                        this.analyticsLoading.liquidation = false;
                    }
                },
                async loadCorrelationData(timeframe = null) {
                    const tf = timeframe || this.correlationTimeframe;
                    this.correlationTimeframe = tf;
                    this.analyticsLoading.correlation = true;
                    this.analyticsError.correlation = null;

                    try {
                        const response = await fetch('/api/correlation/matrix');
                        const data = await response.json();

                        // Extract data
                        const matrix = data.correlation_matrix || {};
                        const symbols = data.symbols || Object.keys(matrix);
                        const timeframeLabel = data.timeframe || tf;

                        // Calculate metrics
                        const { diversificationScore, averageCorrelation } = this.calculateCorrelationMetrics(matrix, symbols);
                        const strongestPairs = this.findStrongestPairs(matrix, symbols);
                        const weakestPairs = this.findWeakestPairs(matrix, symbols);

                        this.correlationData = {
                            matrix: matrix,
                            symbols: symbols,
                            timeframe: timeframeLabel,
                            diversificationScore: diversificationScore,
                            averageCorrelation: averageCorrelation,
                            strongestPairs: strongestPairs,
                            weakestPairs: weakestPairs
                        };

                        // Set loading false first to trigger v-else block
                        this.analyticsLoading.correlation = false;

                        // Render heatmap after DOM updates (double nextTick ensures v-else is rendered)
                        this.$nextTick(() => {
                            this.$nextTick(() => {
                                this.renderCorrelationHeatmap();
                                this.initLucideIcons();
                            });
                        });

                    } catch (error) {
                        console.error('Error loading correlation data:', error);
                        this.analyticsError.correlation = 'Failed to load correlation matrix';
                        this.analyticsLoading.correlation = false;
                    }
                },
                calculateCorrelationMetrics(matrix, symbols) {
                    let totalCorrelation = 0;
                    let count = 0;

                    symbols.forEach((symbol1, i) => {
                        symbols.forEach((symbol2, j) => {
                            // Skip diagonal (self-correlation = 1.0)
                            if (i !== j && matrix[symbol1] && matrix[symbol1][symbol2] !== undefined) {
                                totalCorrelation += Math.abs(matrix[symbol1][symbol2]);
                                count++;
                            }
                        });
                    });

                    const avgAbsCorrelation = count > 0 ? totalCorrelation / count : 0;
                    const averageCorrelation = (avgAbsCorrelation).toFixed(2);

                    // Diversification score: 100 = perfectly diversified (0 correlation)
                    // 0 = perfectly correlated (1.0 correlation)
                    const diversificationScore = Math.round((1 - avgAbsCorrelation) * 100);

                    return { diversificationScore, averageCorrelation };
                },
                findStrongestPairs(matrix, symbols) {
                    const pairs = [];

                    symbols.forEach((symbol1, i) => {
                        symbols.forEach((symbol2, j) => {
                            // Only upper triangle (avoid duplicates)
                            if (i < j && matrix[symbol1] && matrix[symbol1][symbol2] !== undefined) {
                                const correlation = matrix[symbol1][symbol2];
                                // Only include significant positive correlations (ignore diagonal and weak)
                                if (correlation > 0.3) {
                                    pairs.push({
                                        label: `${symbol1.replace('USDT', '')}-${symbol2.replace('USDT', '')}`,
                                        value: correlation.toFixed(2),
                                        rawValue: correlation
                                    });
                                }
                            }
                        });
                    });

                    // Sort by correlation (descending) and take top 5
                    return pairs.sort((a, b) => b.rawValue - a.rawValue).slice(0, 5);
                },
                findWeakestPairs(matrix, symbols) {
                    const pairs = [];

                    symbols.forEach((symbol1, i) => {
                        symbols.forEach((symbol2, j) => {
                            // Only upper triangle (avoid duplicates)
                            if (i < j && matrix[symbol1] && matrix[symbol1][symbol2] !== undefined) {
                                const correlation = matrix[symbol1][symbol2];
                                pairs.push({
                                    label: `${symbol1.replace('USDT', '')}-${symbol2.replace('USDT', '')}`,
                                    value: correlation.toFixed(2),
                                    rawValue: Math.abs(correlation) // Use absolute for sorting weakest
                                });
                            }
                        });
                    });

                    // Sort by absolute correlation (ascending) and take top 5
                    return pairs.sort((a, b) => a.rawValue - b.rawValue).slice(0, 5);
                },
                renderCorrelationHeatmap() {
                    const { matrix, symbols } = this.correlationData;

                    if (!symbols || symbols.length === 0) {
                        console.warn('No correlation data to render');
                        return;
                    }

                    // Prepare data for Highcharts heatmap
                    const cleanSymbols = symbols.map(s => s.replace('USDT', ''));
                    const data = [];

                    symbols.forEach((symbol1, i) => {
                        symbols.forEach((symbol2, j) => {
                            const value = matrix[symbol1] && matrix[symbol1][symbol2] !== undefined
                                ? matrix[symbol1][symbol2]
                                : 0;
                            data.push([j, i, value]);
                        });
                    });

                    // Create Highcharts heatmap
                    Highcharts.chart('correlationHeatmap', {
                        chart: {
                            type: 'heatmap',
                            backgroundColor: 'transparent',
                            height: 800,
                            marginTop: 40,
                            marginBottom: 100
                        },
                        title: {
                            text: null
                        },
                        xAxis: {
                            categories: cleanSymbols,
                            labels: {
                                rotation: -45,
                                style: {
                                    color: '#f5f5f5',
                                    fontSize: '9px',
                                    fontFamily: 'IBM Plex Mono, monospace'
                                }
                            },
                            lineColor: '#222222',
                            tickColor: '#222222'
                        },
                        yAxis: {
                            categories: cleanSymbols,
                            title: null,
                            labels: {
                                style: {
                                    color: '#f5f5f5',
                                    fontSize: '9px',
                                    fontFamily: 'IBM Plex Mono, monospace'
                                }
                            },
                            lineColor: '#222222',
                            gridLineColor: '#222222'
                        },
                        colorAxis: {
                            min: -1,
                            max: 1,
                            stops: [
                                [0, '#3b82f6'],      // -1.0: Blue (perfect negative)
                                [0.25, '#60a5fa'],   // -0.5: Light blue
                                [0.5, '#6b7280'],    // 0: Gray (no correlation)
                                [0.75, '#f87171'],   // +0.5: Light red
                                [1, '#ef4444']       // +1.0: Red (perfect positive)
                            ],
                            labels: {
                                style: {
                                    color: '#f5f5f5',
                                    fontSize: '10px'
                                }
                            }
                        },
                        legend: {
                            align: 'right',
                            layout: 'vertical',
                            verticalAlign: 'middle',
                            symbolHeight: 300,
                            itemStyle: {
                                color: '#f5f5f5',
                                fontSize: '11px'
                            },
                            title: {
                                text: 'Correlation',
                                style: {
                                    color: '#f5f5f5',
                                    fontSize: '11px'
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: '#1a1a1a',
                            borderColor: '#333333',
                            style: {
                                color: '#f5f5f5',
                                fontSize: '11px'
                            },
                            formatter: function() {
                                return `<b>${this.series.yAxis.categories[this.point.y]} - ${this.series.xAxis.categories[this.point.x]}</b><br/>Correlation: ${this.point.value.toFixed(2)}`;
                            }
                        },
                        series: [{
                            name: 'Correlation',
                            borderWidth: 1,
                            borderColor: '#0a0a0a',
                            data: data,
                            dataLabels: {
                                enabled: false
                            }
                        }],
                        credits: {
                            enabled: false
                        },
                        exporting: {
                            enabled: true,
                            buttons: {
                                contextButton: {
                                    menuItems: ['downloadPNG', 'downloadJPEG', 'downloadPDF', 'downloadSVG'],
                                    theme: {
                                        fill: '#1a1a1a',
                                        states: {
                                            hover: {
                                                fill: '#333333'
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    });
                },
                formatNumber(num) {
                    if (num >= 1e6) return (num / 1e6).toFixed(1) + 'M';
                    if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
                    return num.toFixed(0);
                },
                initLucideIcons() {
                    if (typeof lucide !== 'undefined') {
                        lucide.createIcons();
                    }
                }
            },
            mounted() {
                // Valid widget IDs (must match templates)
                const validWidgets = ['marketOverview', 'betaChart', 'confluence', 'topMovers', 'perpsPulse', 'alerts', 'alertedSignals', 'btcPrediction'];

                // Load saved layout
                const savedLayout = localStorage.getItem('dashboardLayoutV2');
                if (savedLayout) {
                    try {
                        let parsed = JSON.parse(savedLayout);
                        // Filter out any removed widgets (e.g., 'signals')
                        parsed = parsed.filter(item => validWidgets.includes(item.i));
                        this.layout = parsed;
                        console.log('Loaded saved layout from localStorage');
                    } catch (error) {
                        console.error('Error loading saved layout:', error);
                    }
                }

                // Initialize Lucide icons
                this.$nextTick(() => {
                    this.initLucideIcons();

                    // Re-initialize icons after any DOM update
                    setInterval(() => {
                        this.initLucideIcons();
                    }, 1000);
                });

                // Load all data
                this.loadMarketOverview();
                this.loadBetaChart();
                this.loadConfluenceData();
                this.loadTopMovers();
                this.loadPerpsPulse();
                this.loadAlertedSignals();
                this.loadRecentAlerts();
                this.loadNewsTicker();

                // Initialize Bitcoin Prediction widget
                this.$nextTick(() => {
                    initBitcoinPredictionWidget();
                });

                // Auto-refresh every 30 seconds
                setInterval(() => {
                    this.loadMarketOverview();
                    this.loadConfluenceData();
                    this.loadTopMovers();
                    this.loadPerpsPulse();
                    this.loadAlertedSignals();
                    this.loadRecentAlerts();
                    this.loadBetaChart();  // Live beta chart updates
                }, 30000);

                // Refresh news ticker every 5 minutes
                setInterval(() => {
                    this.loadNewsTicker();
                }, 300000);

                // Update system stats every 5 seconds
                setInterval(() => {
                    this.cpu = 40 + Math.random() * 20;
                    this.memory = 55 + Math.random() * 15;
                }, 5000);
            }
        });

        // Bitcoin Prediction Widget Initialization
        let btcPredChartInstance = null;

        function initBitcoinPredictionWidget() {
            const CONFIG = {
                updateInterval: 5000, // 5 seconds
                endpoints: {
                    status: '/api/bitcoin-prediction/status',
                    analysis: '/api/bitcoin-prediction/analyze/all'
                }
            };

            // Fetch data from API
            async function fetchData(endpoint) {
                try {
                    const response = await fetch(endpoint);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    return await response.json();
                } catch (error) {
                    console.error(`[BTC Prediction Widget] Error fetching ${endpoint}:`, error);
                    return null;
                }
            }

            // Update progress bar
            function updateProgress(current, required) {
                const percentage = Math.min((current / required) * 100, 100);
                const progressBar = document.getElementById('btc-pred-progress-bar');
                const progressText = document.getElementById('btc-pred-progress-text');
                const readyMessage = document.getElementById('btc-pred-ready-message');

                if (progressBar) progressBar.style.width = `${percentage}%`;
                if (progressText) progressText.textContent = `${current}/${required}`;
                if (readyMessage) readyMessage.style.display = current >= required ? 'block' : 'none';
            }

            // Update status indicator
            function updateStatusIndicator(ready) {
                const indicator = document.getElementById('btc-pred-status-indicator');
                if (indicator) {
                    indicator.style.background = ready ? 'var(--accent-positive)' : 'var(--text-secondary)';
                    indicator.style.boxShadow = ready ? '0 0 10px var(--accent-positive)' : '0 0 8px var(--text-secondary)';
                }
            }

            // Update summary metrics
            function updateSummary(summary) {
                const activeCount = document.getElementById('btc-pred-active-count');
                const avgConfidence = document.getElementById('btc-pred-avg-confidence');
                const totalSymbols = document.getElementById('btc-pred-total-symbols');

                if (activeCount) activeCount.textContent = summary.active_signals || 0;
                if (avgConfidence) avgConfidence.textContent = `${Math.round((summary.avg_confidence || 0) * 100)}%`;
                if (totalSymbols) totalSymbols.textContent = summary.total_symbols || 0;
            }

            // Render prediction item
            function renderPrediction(pred) {
                const directionColor = pred.direction === 'long' ? 'var(--accent-positive)' : '#ef4444';
                const directionIcon = pred.direction === 'long' ? 'trending-up' : 'trending-down';

                return `
                    <div style="background: rgba(251, 191, 36, 0.03); border: 1px solid rgba(251, 191, 36, 0.1); border-radius: 6px; padding: 0.75rem;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span style="color: var(--text-primary); font-weight: 600; font-size: 0.85rem;">${pred.symbol}</span>
                                <i data-lucide="${directionIcon}" style="width: 14px; height: 14px; color: ${directionColor};"></i>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <span style="color: var(--neon-amber); font-size: 0.75rem; font-weight: 600;">${Math.round(pred.confidence * 100)}%</span>
                                <span style="color: var(--text-secondary); font-size: 0.7rem;">+${pred.boost_points}pts</span>
                            </div>
                        </div>
                        <div style="position: relative; height: 4px; background: rgba(251, 191, 36, 0.1); border-radius: 2px; overflow: hidden; margin-bottom: 0.5rem;">
                            <div style="position: absolute; left: 0; top: 0; height: 100%; width: ${pred.confidence * 100}%; background: linear-gradient(90deg, var(--neon-amber), #f59e0b); box-shadow: 0 0 6px var(--neon-amber);"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--text-secondary);">
                            <span>Move: <span style="color: ${directionColor};">${pred.expected_move_pct > 0 ? '+' : ''}${pred.expected_move_pct.toFixed(2)}%</span></span>
                            <span>Lag: ${pred.lag_minutes}m</span>
                            <span>: ${pred.beta.toFixed(2)}</span>
                            <span>Stability: ${pred.stability_score}</span>
                        </div>
                    </div>
                `;
            }

            // Update predictions list
            function updatePredictions(predictions) {
                const listContainer = document.getElementById('btc-pred-predictions-list');
                if (!listContainer) return;

                if (!predictions || predictions.length === 0) {
                    listContainer.innerHTML = `
                        <div style="text-align: center; padding: 1.5rem; color: var(--text-secondary); font-size: 0.8rem;">
                            No active predictions
                        </div>
                    `;
                    return;
                }

                const topPredictions = predictions
                    .filter(p => p.active)
                    .sort((a, b) => b.confidence - a.confidence)
                    .slice(0, 5);

                if (topPredictions.length === 0) {
                    listContainer.innerHTML = `
                        <div style="text-align: center; padding: 1.5rem; color: var(--text-secondary); font-size: 0.8rem;">
                            No active predictions
                        </div>
                    `;
                    return;
                }

                listContainer.innerHTML = topPredictions.map(renderPrediction).join('');
                if (typeof lucide !== 'undefined') lucide.createIcons();
            }

            // Initialize confidence distribution chart
            function initChart() {
                const canvas = document.getElementById('btc-pred-confidence-chart');
                if (!canvas) return;

                const ctx = canvas.getContext('2d');
                btcPredChartInstance = { canvas, ctx };
            }

            // Update confidence distribution chart
            function updateChart(predictions) {
                if (!btcPredChartInstance) return;

                const { canvas, ctx } = btcPredChartInstance;
                const width = canvas.width = canvas.offsetWidth * window.devicePixelRatio;
                const height = canvas.height = canvas.offsetHeight * window.devicePixelRatio;

                ctx.clearRect(0, 0, width, height);

                if (!predictions || predictions.length === 0) return;

                const bins = [0, 0, 0, 0, 0];
                predictions.forEach(pred => {
                    const binIndex = Math.min(Math.floor(pred.confidence * 5), 4);
                    bins[binIndex]++;
                });

                const maxBin = Math.max(...bins, 1);
                const barWidth = width / bins.length;
                const padding = 2 * window.devicePixelRatio;

                bins.forEach((count, i) => {
                    const barHeight = (count / maxBin) * (height - padding * 2);
                    const x = i * barWidth + padding;
                    const y = height - barHeight - padding;

                    ctx.fillStyle = 'rgba(251, 191, 36, 0.6)';
                    ctx.fillRect(x, y, barWidth - padding * 2, barHeight);

                    ctx.shadowBlur = 10 * window.devicePixelRatio;
                    ctx.shadowColor = '#fbbf24';
                    ctx.fillStyle = 'rgba(251, 191, 36, 0.3)';
                    ctx.fillRect(x, y, barWidth - padding * 2, barHeight);
                    ctx.shadowBlur = 0;
                });
            }

            // Main update function
            async function updateWidget() {
                const [statusData, analysisData] = await Promise.all([
                    fetchData(CONFIG.endpoints.status),
                    fetchData(CONFIG.endpoints.analysis)
                ]);

                if (statusData) {
                    updateProgress(statusData.btc_history_length, statusData.min_required);
                    updateStatusIndicator(statusData.ready);
                }

                if (analysisData) {
                    updateSummary(analysisData.summary);
                    updatePredictions(analysisData.predictions);
                    updateChart(analysisData.predictions);
                }
            }

            // Initialize
            initChart();
            updateWidget();
            setInterval(updateWidget, CONFIG.updateInterval);
        }

        // Alpha Pulse card toggle function
        window.toggleAlphaPulseDesktop = function(cardId) {
            const expandedContent = document.getElementById(`${cardId}_expanded`);
            const chevron = document.getElementById(`${cardId}_chevron`);

            if (!expandedContent) return;

            if (expandedContent.style.display === 'none' || !expandedContent.style.display) {
                // Expand
                expandedContent.style.display = 'block';
                if (chevron) chevron.style.transform = 'rotate(180deg)';

                // Smooth animation
                expandedContent.style.opacity = '0';
                expandedContent.style.maxHeight = '0';
                setTimeout(() => {
                    expandedContent.style.transition = 'all 0.3s ease';
                    expandedContent.style.opacity = '1';
                    expandedContent.style.maxHeight = '300px';
                }, 10);

                // Re-init Lucide icons for the expanded content
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            } else {
                // Collapse
                expandedContent.style.opacity = '0';
                expandedContent.style.maxHeight = '0';
                if (chevron) chevron.style.transform = 'rotate(0deg)';

                setTimeout(() => {
                    expandedContent.style.display = 'none';
                    expandedContent.style.transition = '';
                }, 300);
            }
        };

        app.mount('#app');
    </script>
</body>
</html>
