<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NERVE - Market Sentiment Widget</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: #050505;
            color: #f5f5f5;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 800px;
            padding: 40px;
        }

        .widget-card {
            background: linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%);
            border: 1px solid #333;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .widget-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .widget-title {
            font-size: 32px;
            font-weight: 900;
            letter-spacing: 4px;
            color: #fff;
            margin-bottom: 8px;
        }

        .widget-subtitle {
            font-size: 14px;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #nerveWidget {
            min-height: 320px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.9;
            }
        }

        .status-bar {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #6b7280;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        .loading .status-dot {
            background: #f59e0b;
        }

        .error .status-dot {
            background: #ef4444;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="widget-card">
            <div class="widget-header">
                <div class="widget-title">NERVE</div>
                <div class="widget-subtitle">The Anti-Dashboard • Market Psychology</div>
            </div>

            <div id="nerveWidget">
                <div style="text-align: center; color: #6b7280;">
                    <div style="font-size: 18px;">Loading...</div>
                </div>
            </div>

            <div class="status-bar">
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span id="statusText">Connecting...</span>
                </div>
                <div>
                    Last Update: <span id="lastUpdate">Never</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api';
        const UPDATE_INTERVAL = 10000; // 10 seconds

        function renderNERVE(element, marketData) {
            const gainers = marketData.market_overview?.gainers || 0;
            const losers = marketData.market_overview?.losers || 0;
            const sentiment = gainers > losers * 1.5 ? 'GREED' : losers > gainers * 1.5 ? 'FEAR' : 'NEUTRAL';
            const color = sentiment === 'GREED' ? '#10b981' : sentiment === 'FEAR' ? '#ef4444' : '#f59e0b';

            element.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; height: 320px;">
                    <div style="text-align: center;">
                        <div style="font-size: 72px; font-weight: 900; color: ${color}; animation: pulse 2s infinite; letter-spacing: 8px;">
                            ${sentiment}
                        </div>
                        <div style="font-size: 14px; color: #6b7280; margin-top: 16px;">
                            ${gainers} gainers | ${losers} losers
                        </div>
                    </div>
                </div>
            `;
        }

        async function updateWidget() {
            try {
                const statusText = document.getElementById('statusText');
                const statusBar = document.querySelector('.status-indicator');

                statusBar.className = 'status-indicator loading';
                statusText.textContent = 'Updating...';

                const response = await fetch(`${API_BASE}/api/market/overview`);
                const data = await response.json();

                const element = document.getElementById('nerveWidget');
                renderNERVE(element, data);

                statusBar.className = 'status-indicator';
                statusText.textContent = 'Live';

                const now = new Date();
                document.getElementById('lastUpdate').textContent = now.toLocaleTimeString();

            } catch (error) {
                console.error('Error updating NERVE:', error);
                const statusBar = document.querySelector('.status-indicator');
                statusBar.className = 'status-indicator error';
                document.getElementById('statusText').textContent = 'Error';

                document.getElementById('nerveWidget').innerHTML = `
                    <div style="text-align: center; color: #ef4444;">
                        <div style="font-size: 18px;">⚠️ Failed to load data</div>
                        <div style="font-size: 12px; margin-top: 8px; color: #6b7280;">${error.message}</div>
                    </div>
                `;
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            updateWidget();
            setInterval(updateWidget, UPDATE_INTERVAL);
        });
    </script>
</body>
</html>
